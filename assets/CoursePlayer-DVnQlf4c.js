var Ne=Object.defineProperty,be=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var E=(s,r,a)=>r in s?Ne(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,$=(s,r)=>{for(var a in r||(r={}))we.call(r,a)&&E(s,a,r[a]);if(D)for(var a of D(r))ye.call(r,a)&&E(s,a,r[a]);return s},z=(s,r)=>be(s,ve(r));import{d as Ce,u as ke,ai as Se,r as c,j as e,a2 as V,ap as Pe,bc as Me,bl as Le,bi as Te,p as Ie,m as Be,n as $e,t as ze,ao as Ue,c as Fe,b3 as Ae,ak as Qe,ab as Re,b4 as De,b5 as Ee,b6 as Ve,h as _e,b9 as Ge,aP as qe}from"./vendor-react-GSJsE769.js";import{c as N}from"./admin-courses-8eYVdzC7.js";import{c as He}from"./admin-secondary-BM_OfuCE.js";import"./supabase-CqkleIqs.js";import"./vendor-BQbvXGuC.js";import"./vendor-react-dom-CAPOXzwn.js";const Oe=s=>{if(s.chapters&&s.chapters.length>0)return s;const r=s.modules||[];if(r.length===0)return s;const a=r.map((x,h)=>{var n;const l=x.id||`module-${h}`,g=((n=x.lessons)==null?void 0:n.map((o,i)=>z($({},o),{chapterId:l,order:typeof o.order=="number"?o.order:i})))||[],b=g.reduce((o,i)=>{if(i.estimatedDuration)return o+i.estimatedDuration;const u=typeof i.duration=="string"?parseInt(i.duration,10):0;return o+(Number.isFinite(u)?u:0)},0);return{id:l,courseId:s.id,title:x.title,description:x.description,order:typeof x.order=="number"?x.order:h,estimatedDuration:b,lessons:g,isLocked:!1}});return z($({},s),{chapters:a})},is=()=>{const{courseId:s,lessonId:r}=Ce(),a=ke(),[x]=Se(),h=x.get("preview")==="true",l=t=>{if(!s)return"/lms/courses";const m=`/lms/course/${s}/lesson/${t}`;return h?`${m}?preview=true`:m},[g,b]=c.useState(null),[n,o]=c.useState(null),[i,u]=c.useState(null),[k,w]=c.useState(!0),d=c.useRef(null),[v,p]=c.useState(!1),[y,P]=c.useState(0),[U,_]=c.useState(0),[G,q]=c.useState(1),[L,F]=c.useState(!1),[H,O]=c.useState(1),[X,es]=c.useState(!0),[J,K]=c.useState(!1),[A,W]=c.useState(!1),[Q,Y]=c.useState(!1),[Z,ee]=c.useState(!1),[S,se]=c.useState(!1),[te,ae]=c.useState(!1),[T,R]=c.useState(""),[re,ne]=c.useState([]),[oe,le]=c.useState([]);c.useEffect(()=>{if(!s)return;let t=null;const m=N.getCourse(s);if(m){t=m;const f=N.getLearnerProgress("user-123",s);u(f)}else if(h){const f=He.getCourse(s);f&&(t=Oe(f),u(null))}if(t){b(t);const f=r?ie(t,r):null;if(f)o(f);else{const j=ce(t);j?(o(j),a(l(j.id),{replace:!0})):o(null)}I()}else b(null),o(null);w(!1)},[s,r,a,h]);const ie=(t,m)=>{for(const f of t.chapters||[]){const j=f.lessons.find(C=>C.id===m);if(j)return j}return null},ce=t=>{var m;return((m=(t.chapters||[])[0])==null?void 0:m.lessons[0])||null},I=()=>{if(!s)return;const t=N.getUserNotes("user-123",s),m=N.getUserBookmarks("user-123",s);ne(t),le(m)},de=()=>{d.current&&(v?d.current.pause():d.current.play(),p(!v))},xe=()=>{if(d.current&&(P(d.current.currentTime),n&&s)){const t=d.current.currentTime/d.current.duration*100;N.updateLessonProgress("user-123",s,n.id,{progress:t})}},M=t=>{d.current&&(d.current.currentTime=t,P(t))},me=t=>{d.current&&(d.current.volume=t,q(t),F(t===0))},ue=()=>{d.current&&(d.current.muted=!L,F(!L))},he=t=>{d.current&&(d.current.playbackRate=t,O(t))},ge=t=>{if(d.current){const m=Math.max(0,Math.min(U,y+t));M(m)}},B=t=>{if(!g||!n||!s)return;const m=(g.chapters||[]).flatMap(C=>C.lessons),f=m.findIndex(C=>C.id===n.id);let j;if(t==="next"?j=f+1:j=f-1,j>=0&&j<m.length){const C=m[j];a(l(C.id))}},pe=()=>{if(n&&s){N.markLessonComplete("user-123",s,n.id);const t=N.getLearnerProgress("user-123",s);u(t),B("next")}},fe=()=>{if(n&&s){const t=Math.floor(y);N.addBookmark("user-123",s,{lessonId:n.id,position:t,note:"Video bookmark"}),I()}},je=()=>{if(T.trim()&&n&&s){const t=Math.floor(y);N.addNote("user-123",s,{lessonId:n.id,content:T,position:t}),R(""),I()}};return k?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):!g||!n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Course not found"}),e.jsx("button",{onClick:()=>a("/lms/courses"),className:"text-orange-600 hover:text-orange-800",children:"Return to courses"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex",children:[e.jsxs("div",{className:`${S?"w-16":"w-80"} bg-gray-800 transition-all duration-300 flex flex-col`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a("/lms/courses"),className:"flex items-center text-gray-300 hover:text-white",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),!S&&"Back to Courses"]}),e.jsx("button",{onClick:()=>se(!S),className:"text-gray-300 hover:text-white",children:S?e.jsx(Pe,{className:"w-4 h-4"}):e.jsx(Me,{className:"w-4 h-4"})})]}),!S&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h1",{className:"font-semibold text-white",children:g.title}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(((i==null?void 0:i.overallProgress)||0)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:`${((i==null?void 0:i.overallProgress)||0)*100}%`}})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Xe,{course:g,currentLesson:n,progress:i,collapsed:S,onLessonSelect:t=>a(l(t.id))})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[n.type==="video"&&e.jsxs("div",{className:"relative bg-black",children:[e.jsx("video",{ref:d,src:n.content.videoUrl,className:"w-full h-auto max-h-96",onTimeUpdate:xe,onLoadedMetadata:()=>{var t;return _(((t=d.current)==null?void 0:t.duration)||0)},onPlay:()=>p(!0),onPause:()=>p(!1)}),e.jsx(Je,{isPlaying:v,currentTime:y,duration:U,volume:G,isMuted:L,playbackSpeed:H,showControls:X,onPlayPause:de,onSeek:M,onVolumeChange:me,onToggleMute:ue,onSpeedChange:he,onSkip:ge,onFullscreen:()=>K(!J),onSettings:()=>ee(!Z)})]}),e.jsx("div",{className:"flex-1 bg-white text-gray-900",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:n.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:n.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:fe,className:"p-2 text-gray-600 hover:text-orange-600",title:"Add bookmark",children:e.jsx(Le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Y(!Q),className:"p-2 text-gray-600 hover:text-orange-600",title:"Toggle notes",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>W(!A),className:"p-2 text-gray-600 hover:text-orange-600",title:"Toggle transcript",children:e.jsx(Ie,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(Ke,{lesson:n,onComplete:pe,showQuizModal:te,onShowQuizModal:ae}),A&&n.content.transcript&&e.jsx(We,{transcript:n.content.transcript,currentTime:y,onSeek:M})]}),e.jsxs("div",{className:"space-y-6",children:[Q&&e.jsx(Ye,{notes:re.filter(t=>t.lessonId===n.id),bookmarks:oe.filter(t=>t.lessonId===n.id),noteText:T,onNoteTextChange:R,onAddNote:je,onSeek:M}),e.jsx(Ze,{onPrevious:()=>B("prev"),onNext:()=>B("next"),canGoPrevious:!0,canGoNext:!0})]})]})]})})]})]})},Xe=({course:s,currentLesson:r,progress:a,collapsed:x,onLessonSelect:h})=>{const[l,g]=c.useState(new Set),b=o=>{const i=new Set(l);i.has(o)?i.delete(o):i.add(o),g(i)},n=o=>a==null?void 0:a.lessonProgress.find(i=>i.lessonId===o);return x?e.jsx("div",{className:"p-2",children:(s.chapters||[]).map(o=>e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"w-3 h-3 bg-gray-600 rounded-full mx-auto"})},o.id))}):e.jsx("div",{className:"p-4 space-y-2",children:(s.chapters||[]).map((o,i)=>e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>b(o.id),className:"w-full flex items-center justify-between p-2 text-left text-gray-300 hover:text-white hover:bg-gray-700 rounded",children:[e.jsxs("span",{className:"font-medium",children:[i+1,". ",o.title]}),l.has(o.id)?e.jsx(Be,{className:"w-4 h-4"}):e.jsx($e,{className:"w-4 h-4"})]}),l.has(o.id)&&e.jsx("div",{className:"ml-4 mt-2 space-y-1",children:o.lessons.map((u,k)=>{const w=n(u.id),d=(w==null?void 0:w.isCompleted)||!1,v=u.id===r.id;return e.jsxs("button",{onClick:()=>h(u),className:`w-full flex items-center p-2 text-left text-sm rounded transition-colors ${v?"bg-orange-600 text-white":"text-gray-400 hover:text-gray-200 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"mr-3",children:d?e.jsx(ze,{className:"w-4 h-4 text-green-400"}):e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[k+1,". ",u.title]}),e.jsxs("div",{className:"flex items-center text-xs opacity-75",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),u.estimatedDuration," min"]})]})]},u.id)})})]},o.id))})},Je=({isPlaying:s,currentTime:r,duration:a,volume:x,isMuted:h,playbackSpeed:l,showControls:g,onPlayPause:b,onSeek:n,onVolumeChange:o,onToggleMute:i,onSpeedChange:u,onSkip:k,onFullscreen:w,onSettings:d})=>{const v=p=>{const y=Math.floor(p/60),P=Math.floor(p%60);return`${y}:${P.toString().padStart(2,"0")}`};return g?e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"range",min:"0",max:a,value:r,onChange:p=>n(Number(p.target.value)),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>k(-10),className:"text-white hover:text-orange-400",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:b,className:"text-white hover:text-orange-400",children:s?e.jsx(Qe,{className:"w-6 h-6"}):e.jsx(Re,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>k(10),className:"text-white hover:text-orange-400",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:i,className:"text-white hover:text-orange-400",children:h?e.jsx(Ee,{className:"w-5 h-5"}):e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:x,onChange:p=>o(Number(p.target.value)),className:"w-16 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})]}),e.jsxs("div",{className:"text-white text-sm",children:[v(r)," / ",v(a)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:l,onChange:p=>u(Number(p.target.value)),className:"bg-transparent text-white text-sm",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:.75,children:"0.75x"}),e.jsx("option",{value:1,children:"1x"}),e.jsx("option",{value:1.25,children:"1.25x"}),e.jsx("option",{value:1.5,children:"1.5x"}),e.jsx("option",{value:2,children:"2x"})]}),e.jsx("button",{onClick:d,className:"text-white hover:text-orange-400",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:w,className:"text-white hover:text-orange-400",children:e.jsx(Ge,{className:"w-5 h-5"})})]})]})]}):null},Ke=({lesson:s,onComplete:r,showQuizModal:a,onShowQuizModal:x})=>s.type==="text"?e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:s.content.textContent||""}}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsx("button",{onClick:r,className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:"Mark as Complete"})})]}):s.type==="quiz"?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Quiz: ",s.title]}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.description}),e.jsx("button",{onClick:()=>x(!0),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:"Start Quiz"})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Interactive content will be displayed here."})}),We=({transcript:s})=>e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Transcript"}),e.jsx("div",{className:"prose text-sm",children:s})]}),Ye=({notes:s,bookmarks:r,noteText:a,onNoteTextChange:x,onAddNote:h})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Notes & Bookmarks"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("textarea",{value:a,onChange:l=>x(l.target.value),placeholder:"Add a note...",className:"w-full p-2 border border-gray-300 rounded resize-none",rows:3}),e.jsx("button",{onClick:h,className:"bg-orange-600 text-white px-4 py-1 rounded text-sm hover:bg-orange-700",children:"Add Note"})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[r.map(l=>e.jsxs("div",{className:"p-2 bg-white rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Bookmark"}),e.jsxs("span",{className:"text-gray-500",children:[Math.floor(l.position/60),":",(l.position%60).toString().padStart(2,"0")]})]}),e.jsx("p",{className:"text-gray-600",children:l.note||"No note"})]},l.id)),s.map(l=>e.jsxs("div",{className:"p-2 bg-white rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Note"}),e.jsx("span",{className:"text-gray-500",children:l.position?`${Math.floor(l.position/60)}:${(l.position%60).toString().padStart(2,"0")}`:""})]}),e.jsx("p",{className:"text-gray-700",children:l.content})]},l.id))]})]}),Ze=({onPrevious:s,onNext:r,canGoPrevious:a,canGoNext:x})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Navigation"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:s,disabled:!a,className:"flex-1 flex items-center justify-center px-4 py-2 border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsxs("button",{onClick:r,disabled:!x,className:"flex-1 flex items-center justify-center px-4 py-2 bg-orange-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700",children:["Next",e.jsx(qe,{className:"w-4 h-4 ml-2"})]})]})]});export{is as default};
