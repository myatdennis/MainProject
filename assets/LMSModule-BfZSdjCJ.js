var Vt=Object.defineProperty,Ut=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var St=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var kt=(n,h,f)=>h in n?Vt(n,h,{enumerable:!0,configurable:!0,writable:!0,value:f}):n[h]=f,me=(n,h)=>{for(var f in h||(h={}))Bt.call(h,f)&&kt(n,f,h[f]);if(St)for(var f of St(h))Yt.call(h,f)&&kt(n,f,h[f]);return n},he=(n,h)=>Ut(n,qt(h));var ne=(n,h,f)=>new Promise((B,Q)=>{var I=$=>{try{F(f.next($))}catch(W){Q(W)}},V=$=>{try{F(f.throw($))}catch(W){Q(W)}},F=$=>$.done?B($.value):Promise.resolve($.value).then(I,V);F((f=f.apply(n,h)).next())});import{r as t,ae as H,j as e,ac as _t,al as Kt,b3 as Gt,b4 as Wt,b5 as Jt,b6 as Ht,b7 as Xt,h as Zt,b8 as es,b9 as ts,ba as ss,bb as qe,c as Be,bc as rs,aq as ns,Z as Tt,b as Lt,t as le,a8 as nt,g as Ye,f as Ke,aQ as Ge,aH as as,aI as os,K as ls,q as is,D as et,bd as cs,R as at,d as ds,u as us,N as Xe,a3 as st,ai as Ze,e as ms,ad as xs,P as gs,T as hs,A as $t,p as Et,X as fs,be as ps,V as bs,at as Rt}from"./vendor-react-DvkU9ZSQ.js";import{b as Ie,s as De,c as rt}from"./admin-secondary-BDE6J84T.js";import"./supabase-CqkleIqs.js";import"./vendor-Dox2Yl3q.js";import"./vendor-react-dom-Dki47u2n.js";import"./admin-courses-Othof8Q0.js";const vs=["course_assigned","course_updated","user_progress","user_enrolled","user_completed","notification_created","survey_response","analytics_updated"],js=(n,h,f)=>({type:n,payload:h,timestamp:Date.now(),userId:f}),ys=n=>{var h,f,B,Q,I,V,F,$,W,X,M,j,E,T;switch(n.type){case"course_assigned":{const l=((f=(h=n.payload)==null?void 0:h.assignment)==null?void 0:f.course_name)||((Q=(B=n.payload)==null?void 0:B.course)==null?void 0:Q.title)||"course";H.success(`New course assigned: ${l}`);break}case"course_updated":{const l=((V=(I=n.payload)==null?void 0:I.course)==null?void 0:V.title)||((F=n.payload)==null?void 0:F.course_name)||"Course";H(`Course updated: ${l}`,{icon:"ℹ️"});break}case"user_enrolled":{const l=((W=($=n.payload)==null?void 0:$.enrollment)==null?void 0:W.course_name)||"course";H.success(`Enrolled in ${l}`);break}case"user_completed":{const l=((X=n.payload)==null?void 0:X.courseId)||((j=(M=n.payload)==null?void 0:M.enrollment)==null?void 0:j.course_name)||"course";H.success(`Course completed: ${l}`);break}case"notification_created":{H(((T=(E=n.payload)==null?void 0:E.notification)==null?void 0:T.title)||"New notification received",{icon:"🔔"});break}case"survey_response":{H.success("New survey response received");break}}},Ns=(n={})=>{const{userId:h,organizationId:f,events:B=vs,onEvent:Q,onError:I,enabled:V=!0}=n,[F,$]=t.useState(V),[W,X]=t.useState(Ie.getSyncStatus().connection),M=t.useRef([]),j=t.useRef("");t.useEffect(()=>{$(V)},[V]),t.useEffect(()=>{if(!F){M.current.forEach(g=>g()),M.current=[],H.dismiss("realtime-status"),H.dismiss("realtime-reconnect");return}const L=JSON.stringify([...B].sort());L===j.current||(M.current.forEach(g=>g()),M.current=[],j.current=L),Ie.configureContext({userId:h,organizationId:f});const v=g=>{const Z=Ie.subscribe(g,Y=>{const ee=js(g,Y,h);try{Q==null||Q(ee),ys(ee)}catch(y){console.error("[useRealtimeSync] Event handler error:",y),I==null||I(y)}});M.current.push(Z)};B.forEach(v);const A=Ie.subscribe("connection_status",g=>{if(X(g),!g.online){H.error("You appear to be offline. Realtime updates paused.",{id:"realtime-offline",duration:4e3});return}g.connected?(H.dismiss("realtime-reconnect"),H.success("Real-time sync connected",{id:"realtime-status",duration:2e3})):H.loading("Reconnecting to realtime sync...",{id:"realtime-reconnect"})});return M.current.push(A),()=>{M.current.forEach(g=>g()),M.current=[],H.dismiss("realtime-status"),H.dismiss("realtime-reconnect"),H.dismiss("realtime-offline")}},[F,h,f,JSON.stringify(B),Q,I]);const E=t.useCallback(()=>{$(!0)},[]),T=t.useCallback(()=>{$(!1)},[]),l=t.useCallback((L,v,A)=>{try{Ie.logSyncEvent({type:L,data:v,timestamp:Date.now(),scope:A,userId:h})}catch(g){console.error("[useRealtimeSync] Broadcast failed",g),I==null||I(g)}},[h,I]);return{connect:E,disconnect:T,broadcastUpdate:l,isConnected:W.connected,connectionStatus:W}},ws=(n={})=>{const{userId:h="demo-user",enabled:f=!0,saveInterval:B=3e4,maxRetries:Q=3,onSaveSuccess:I,onSaveError:V,debounceMs:F=1500}=n,[$,W]=t.useState(!1),[X,M]=t.useState(null),[j,E]=t.useState(0),[T,l]=t.useState(navigator.onLine),L=t.useRef([]),v=t.useRef(),A=t.useRef(new Map),g=t.useRef(new Map);t.useEffect(()=>{const m=()=>{l(!0),x()},k=()=>{l(!1)};return window.addEventListener("online",m),window.addEventListener("offline",k),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",k)}},[]);const Z=t.useCallback(m=>`${m.courseId}_${m.moduleId}_${m.lessonId}`,[]),Y=t.useCallback(m=>{try{const k=`autosave_${h}_${Z(m)}`,J=he(me({},m),{lastAccessed:m.lastAccessed.toISOString()});localStorage.setItem(k,JSON.stringify(J)),console.log("[AutoSave] Saved to local storage:",k)}catch(k){console.error("[AutoSave] Failed to save to local storage:",k)}},[h,Z]),ee=t.useCallback((m,k,J)=>{try{const se=`autosave_${h}_${m}_${k}_${J}`,a=localStorage.getItem(se);if(a){const z=JSON.parse(a);return he(me({},z),{lastAccessed:new Date(z.lastAccessed)})}}catch(se){console.error("[AutoSave] Failed to load from local storage:",se)}return null},[h]),y=t.useCallback((m,k,J)=>{try{const se=`autosave_${h}_${m}_${k}_${J}`;localStorage.removeItem(se),console.log("[AutoSave] Cleared stored progress:",se)}catch(se){console.error("[AutoSave] Failed to clear stored progress:",se)}},[h]),N=t.useCallback(m=>ne(void 0,null,function*(){if(!De)return console.warn("[AutoSave] Supabase not available"),!1;try{const{error:k}=yield De.from("user_progress").upsert({user_id:h,course_id:m.courseId,module_id:m.moduleId,lesson_id:m.lessonId,progress:m.progress,time_spent:m.timeSpent,completed:m.completed,reflection:m.reflection,quiz_scores:m.quizScores,video_progress:m.videoProgress,last_accessed:m.lastAccessed.toISOString(),updated_at:new Date().toISOString()},{onConflict:"user_id,course_id,module_id,lesson_id"});return k?(console.error("[AutoSave] Database save error:",k),!1):(console.log("[AutoSave] Successfully saved to database:",Z(m)),!0)}catch(k){return console.error("[AutoSave] Database save exception:",k),!1}}),[h,Z]),x=t.useCallback(()=>ne(void 0,null,function*(){if(!T||L.current.length===0||$)return;W(!0);const m=[...L.current];L.current=[];for(const k of m)try{(yield N(k.data))?(I==null||I(k.data),y(k.data.courseId,k.data.moduleId,k.data.lessonId)):k.attempts<Q?L.current.push(he(me({},k),{attempts:k.attempts+1})):(console.error("[AutoSave] Max retries exceeded for:",k.id),V==null||V(new Error("Max retries exceeded"),k.data))}catch(J){console.error("[AutoSave] Queue processing error:",J),V==null||V(J,k.data)}W(!1),M(new Date)}),[T,$,N,Q,I,V,y]),p=t.useCallback(m=>{const k=Z(m);L.current=L.current.filter(J=>J.id!==k),L.current.push({id:k,data:m,timestamp:Date.now(),attempts:0}),T||H("Progress saved offline. Will sync when connection restored.",{icon:"💾",id:"offline-save"})},[Z,T]),d=t.useCallback(m=>{(m!=null?m:Array.from(A.current.keys())).forEach(J=>{const se=g.current.get(J);se&&(clearTimeout(se),g.current.delete(J));const a=A.current.get(J);a&&p(a)})},[p]),D=t.useCallback(m=>{if(!f)return;const k=Z(m);if(A.current.set(k,m),E(A.current.size),Y(m),!T){p(m);return}const J=()=>{g.current.delete(k),p(m)};if(F<=0){J();return}const se=g.current.get(k);se&&clearTimeout(se);const a=window.setTimeout(J,F);g.current.set(k,a)},[f,Z,Y,T,p,F]),U=t.useCallback(m=>ne(void 0,null,function*(){return m&&(D(m),d([Z(m)])),T?(m||d(),yield x(),L.current.length===0):(H.error("Cannot save - you are offline"),!1)}),[D,d,Z,T,x]);return t.useEffect(()=>{if(!(!f||!T))return v.current=setInterval(()=>{A.current.size>0&&x()},B),()=>{v.current&&clearInterval(v.current)}},[f,T,B,x]),t.useEffect(()=>{T&&L.current.length>0&&x()},[T,x]),t.useEffect(()=>()=>{v.current&&clearInterval(v.current),g.current.forEach(m=>clearTimeout(m)),g.current.clear()},[]),{scheduleProgressSave:D,forceSave:U,loadFromStorage:ee,clearStoredProgress:y,isSaving:$,isOnline:T,lastSaved:X,pendingChanges:j,queueLength:L.current.length}},Cs=(n={})=>{const{maxRetries:h=3,retryDelay:f=2e3,maxQueueSize:B=100,onSync:Q,onSyncError:I,onQueueFull:V}=n,[F,$]=t.useState(navigator.onLine),[W,X]=t.useState(!1),[M,j]=t.useState(0),[E,T]=t.useState(null),l=t.useRef([]),L=t.useRef(!1),v=t.useRef();t.useEffect(()=>{try{const p=localStorage.getItem("offline_progress_queue");if(p){const d=JSON.parse(p);l.current=d.filter(D=>{const U=Date.now()-6048e5;return D.timestamp>U}),j(l.current.length),console.log(`[OfflineQueue] Loaded ${l.current.length} items from storage`)}}catch(p){console.error("[OfflineQueue] Failed to load queue from storage:",p),l.current=[]}},[]);const A=t.useCallback(()=>{try{localStorage.setItem("offline_progress_queue",JSON.stringify(l.current))}catch(p){console.error("[OfflineQueue] Failed to save queue to storage:",p)}},[]);t.useEffect(()=>{const p=()=>{$(!0),H.success("Connection restored. Syncing progress...",{duration:3e3,id:"connection-restored"}),setTimeout(()=>Y(),1e3)},d=()=>{$(!1),H("You're offline. Progress will be saved locally.",{icon:"💾",duration:4e3,id:"connection-lost"})};return window.addEventListener("online",p),window.addEventListener("offline",d),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",d)}},[]);const g=t.useCallback(()=>`queue_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),Z=t.useCallback(p=>{l.current.length>=B&&(console.warn("[OfflineQueue] Queue size limit reached"),V==null||V(),l.current=l.current.filter(D=>D.priority!=="low").slice(-(B-1)));const d=he(me({},p),{id:g(),timestamp:Date.now(),attempts:0});return l.current=l.current.filter(D=>!(D.userId===p.userId&&D.courseId===p.courseId&&D.lessonId===p.lessonId&&D.action===p.action)),l.current.push(d),l.current.sort((D,U)=>{const m={high:3,medium:2,low:1};return m[U.priority]-m[D.priority]||D.timestamp-U.timestamp}),j(l.current.length),A(),console.log("[OfflineQueue] Added item to queue:",d.id,d.action),F?setTimeout(()=>Y(),500):H("Progress saved offline",{icon:"💾",duration:2e3,id:"offline-save"}),d.id},[B,F,g,A,V]),Y=t.useCallback(()=>ne(void 0,null,function*(){if(!F||L.current||l.current.length===0)return;L.current=!0,X(!0),console.log(`[OfflineQueue] Processing ${l.current.length} queued items`);const p=[...l.current],d=[],D=[];for(const U of p){try{(yield ee(U))?(d.push(U.id),Q==null||Q(U),console.log("[OfflineQueue] Successfully synced:",U.id,U.action)):U.attempts<h?D.push(he(me({},U),{attempts:U.attempts+1})):(console.error("[OfflineQueue] Max retries exceeded:",U.id),I==null||I(U,new Error("Max retries exceeded")))}catch(m){console.error("[OfflineQueue] Sync error for item:",U.id,m),U.attempts<h?D.push(he(me({},U),{attempts:U.attempts+1})):I==null||I(U,m)}yield new Promise(m=>setTimeout(m,100))}l.current=l.current.filter(U=>!d.includes(U.id)).concat(D),j(l.current.length),A(),L.current=!1,X(!1),T(new Date),d.length>0&&H.success(`Synced ${d.length} progress updates`,{duration:3e3}),D.length>0&&(H("Some items will retry later",{icon:"⚠️",duration:2e3}),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{Y()},f)),console.log("[OfflineQueue] Processing complete. Remaining items:",l.current.length)}),[F,h,f,Q,I,A]),ee=p=>ne(void 0,null,function*(){try{if(yield new Promise(D=>setTimeout(D,200+Math.random()*300)),!(Math.random()>.1))throw new Error("Simulated API error");switch(p.action){case"user_progress":break;case"lesson_complete":break;case"quiz_submit":break;case"reflection_save":break}return!0}catch(d){return console.error(`[OfflineQueue] Failed to sync ${p.action}:`,d),!1}}),y=t.useCallback(()=>{l.current=[],j(0),A(),console.log("[OfflineQueue] Queue cleared")},[A]),N=t.useCallback(p=>{l.current=l.current.filter(d=>d.id!==p),j(l.current.length),A()},[A]),x=t.useCallback(()=>({total:l.current.length,byPriority:{high:l.current.filter(d=>d.priority==="high").length,medium:l.current.filter(d=>d.priority==="medium").length,low:l.current.filter(d=>d.priority==="low").length},byAction:l.current.reduce((d,D)=>(d[D.action]=(d[D.action]||0)+1,d),{}),oldestTimestamp:l.current.length>0?Math.min(...l.current.map(d=>d.timestamp)):null,failedItems:l.current.filter(d=>d.attempts>0).length}),[]);return t.useEffect(()=>{if(F&&l.current.length>0){const p=setTimeout(()=>Y(),2e3);return()=>clearTimeout(p)}},[F,Y]),t.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]),{addToQueue:Z,processQueue:Y,clearQueue:y,removeItem:N,getQueueStats:x,isOnline:F,isProcessing:W,queueSize:M,lastSync:E,queue:l.current}},Ss=(n,h={})=>{const{userId:f="demo-user",enableAutoSave:B=!0,enableRealtime:Q=!0,autoSaveInterval:I=3e4}=h,[V,F]=t.useState(null),[$,W]=t.useState({}),[X,M]=t.useState({}),[j,E]=t.useState(!0),[T,l]=t.useState(null),[L,v]=t.useState("synced"),[A,g]=t.useState(null),Z=t.useRef(new Date),Y=t.useRef(new Set),ee=ws({userId:f,enabled:B,saveInterval:I,onSaveSuccess:a=>{console.log("[CourseProgress] Auto-save successful:",a),v("synced"),Y.current.delete(`${a.courseId}_${a.lessonId}`)},onSaveError:(a,z)=>{console.error("[CourseProgress] Auto-save failed:",a,z),v("error")}}),y=Cs({onSync:a=>{console.log("[CourseProgress] Offline item synced:",a),H.success(`Progress synced: ${a.action}`)},onSyncError:(a,z)=>{console.error("[CourseProgress] Offline sync failed:",a,z),H.error("Failed to sync some progress data")}}),N=t.useCallback(a=>{var z,_,q,ae,te,K,ie,xe,ce;if(a.type==="course_updated"){(((_=(z=a.payload)==null?void 0:z.course)==null?void 0:_.id)||((q=a.payload)==null?void 0:q.courseId))===n&&(console.log("[CourseProgress] Course updated via realtime:",a.payload),p());return}if(a.type==="user_progress"){if((((ae=a.payload)==null?void 0:ae.courseId)||((K=(te=a.payload)==null?void 0:te.progress)==null?void 0:K.course_id))!==n)return;console.log("[CourseProgress] Progress sync event:",a.payload),a.userId&&a.userId!==f&&m(a.payload.progress);return}a.type==="user_completed"&&(((ie=a.payload)==null?void 0:ie.courseId)||((ce=(xe=a.payload)==null?void 0:xe.progress)==null?void 0:ce.course_id))===n&&(console.log("[CourseProgress] Completion event received:",a.payload),p())},[n,f,p,m]),x=Ns({userId:f,events:["course_updated","user_progress","user_completed","analytics_updated"],enabled:Q,onEvent:N,onError:a=>{console.error("[CourseProgress] Realtime error:",a)}}),p=t.useCallback(()=>ne(void 0,null,function*(){try{if(E(!0),l(null),!""||!""){console.log("[CourseProgress] Running in demo mode");const oe={id:`enrollment_demo_${Date.now()}`,user_id:f,course_id:n,enrolled_at:new Date().toISOString(),progress_percentage:0,completed_at:void 0,last_accessed_at:new Date().toISOString()};F(oe),W({}),M({}),E(!1);return}const{data:{user:_}}=yield De.auth.getUser(),q=(_==null?void 0:_.id)||f,{data:ae,error:te}=yield De.from("user_course_enrollments").select("*").eq("user_id",q).eq("course_id",n).limit(1);if(te){console.error("Error loading enrollment:",te),l("Failed to load enrollment data");return}if(ae&&ae.length>0)F(ae[0]);else{const oe={id:`enrollment_${Date.now()}`,user_id:q,course_id:n,enrolled_at:new Date().toISOString(),progress_percentage:0,last_accessed_at:new Date().toISOString(),completed_at:void 0};F(oe)}const{data:K,error:ie}=yield De.from("user_lesson_progress").select("*").eq("user_id",q).eq("course_id",n);if(ie&&console.error("Error loading progress:",ie),K){const oe=K.reduce((pe,be)=>(pe[be.lesson_id]=be,pe),{});W(oe)}const{data:xe,error:ce}=yield De.from("user_reflections").select("*").eq("user_id",q).eq("course_id",n);if(ce&&console.error("Error loading reflections:",ce),xe){const oe=xe.reduce((pe,be)=>(pe[be.lesson_id]=be,pe),{});M(oe)}}catch(a){console.error("Error in loadProgressData:",a),l("Failed to load progress data")}finally{E(!1)}}),[n,f]),d=t.useCallback((a,z,_)=>ne(void 0,null,function*(){try{const q="",ae="",te=$[a]||{},K=me(he(me({},te),{id:te.id||`progress_${Date.now()}`,user_id:f,lesson_id:a,time_spent:te.time_spent||0,completed:te.completed||!1,progress_percentage:te.progress_percentage||0,last_accessed_at:new Date().toISOString(),completed_at:te.completed_at}),_);if(W(xe=>he(me({},xe),{[a]:K})),!q||!ae){console.log("[CourseProgress] Demo mode - progress updated locally only"),v("synced");return}const ie=`${n}_${a}`;Y.current.add(ie),v("pending"),Z.current=new Date,B&&ee.scheduleProgressSave({courseId:n,lessonId:a,moduleId:z,progress:K.progress_percentage,timeSpent:K.time_spent,completed:K.completed,lastAccessed:new Date(K.last_accessed_at),quizScores:void 0,videoProgress:K.progress_percentage}),navigator.onLine||y.addToQueue({userId:f,courseId:n,lessonId:a,moduleId:z,action:"user_progress",data:K,priority:"medium"}),navigator.onLine&&Q&&x.isConnected&&(yield x.broadcastUpdate("user_progress",{progress:he(me({},K),{course_id:n,lesson_id:a,user_id:f,updated_at:new Date().toISOString()}),courseId:n,lessonId:a,userId:f,timestamp:Date.now()}))}catch(q){console.error("Error updating lesson progress:",q),l("Failed to update progress"),v("error")}}),[n,f,$,B,Q,ee,y,x]),D=t.useCallback((a,z,_)=>ne(void 0,null,function*(){const q={completed:!0,completed_at:new Date().toISOString(),progress_percentage:100,last_accessed_at:new Date().toISOString()};yield d(a,z,q),y.addToQueue({userId:f,courseId:n,lessonId:a,moduleId:z,action:"lesson_complete",data:{lesson_id:a,completed_at:q.completed_at,quiz_score:_},priority:"high"}),H.success("Lesson completed!",{duration:3e3})}),[d,y,f,n]),U=t.useCallback((a,z)=>ne(void 0,null,function*(){var _,q;try{const ae="",te="",K={id:((_=X[a])==null?void 0:_.id)||`reflection_${Date.now()}`,user_id:f,lesson_id:a,content:z,created_at:((q=X[a])==null?void 0:q.created_at)||new Date().toISOString(),updated_at:new Date().toISOString()};if(M(ie=>he(me({},ie),{[a]:K})),!ae||!te){console.log("[CourseProgress] Demo mode - reflection saved locally only");return}y.addToQueue({userId:f,courseId:n,lessonId:a,moduleId:"reflection",action:"reflection_save",data:K,priority:"low"}),H.success("Reflection saved")}catch(ae){console.error("Error saving reflection:",ae),H.error("Failed to save reflection")}}),[n,f,X,y]),m=t.useCallback(a=>{var K,ie,xe;const z=(a==null?void 0:a.lesson_id)||(a==null?void 0:a.lessonId);if(!z)return;const _=a!=null&&a.progress?a.progress:a,q=typeof(_==null?void 0:_.progress)=="number"?_.progress:(ie=(K=_==null?void 0:_.progress_percentage)!=null?K:_==null?void 0:_.percentage)!=null?ie:0,ae=typeof(_==null?void 0:_.completed)=="boolean"?_.completed:(xe=a==null?void 0:a.completed)!=null?xe:!1,te=(_==null?void 0:_.updated_at)||(_==null?void 0:_.last_accessed_at)||(a==null?void 0:a.timestamp)||new Date().toISOString();W(ce=>{const oe=ce[z]||{},pe=new Date(te),be=new Date(oe.last_accessed_at||oe.updated_at||0);return pe>be?he(me({},ce),{[z]:he(me(me({},oe),_),{progress_percentage:q,completed:ae,last_accessed_at:te})}):ce})},[]),k=t.useCallback(()=>{const a=Object.values($);if(a.length===0)return 0;const z=a.reduce((_,q)=>_+q.progress_percentage,0);return Math.round(z/a.length)},[$]),J=t.useCallback(()=>{const a=Object.values($).filter(_=>_.completed),z=Object.keys($).length;return{completed:a.length,total:z,percentage:z>0?Math.round(a.length/z*100):0}},[$]);t.useEffect(()=>{p()},[p]);const se=t.useCallback(a=>{g(a),a&&$[a]&&d(a,"module_1",{last_accessed_at:new Date().toISOString()})},[$,d]);return{enrollmentData:V,lessonProgress:$,reflections:X,loading:j,error:T,updateLessonProgress:d,markLessonComplete:D,saveReflection:U,setActiveLessonTracking:se,calculateCourseProgress:k,getCompletionStats:J,syncStatus:L,isOnline:y.isOnline,isSaving:ee.isSaving,isProcessingQueue:y.isProcessing,pendingChanges:ee.pendingChanges,queueSize:y.queueSize,lastSaved:ee.lastSaved,forceSave:ee.forceSave,processQueue:y.processQueue,loadFromStorage:ee.loadFromStorage,reloadData:p,isRealtimeConnected:x.isConnected,reconnectRealtime:x.connect,activeLesson:A}},ks=({src:n,title:h,thumbnail:f,onProgress:B,onComplete:Q,initialTime:I=0,className:V="",autoPlay:F=!1,showTranscript:$=!1,transcript:W="",captions:X=[],resumeKey:M,onTimeUpdate:j})=>{const E=t.useRef(null),T=t.useRef(null),l=t.useRef(null),L=t.useMemo(()=>M?`video-progress-${M}`:`video-progress-${encodeURIComponent(n)}`,[M,n]),[v,A]=t.useState(!1),[g,Z]=t.useState(!0),[Y,ee]=t.useState(0),[y,N]=t.useState(0),[x,p]=t.useState(1),[d,D]=t.useState(!1),[U,m]=t.useState(1),[k,J]=t.useState(!1),[se,a]=t.useState(!0),[z,_]=t.useState(!1),[q,ae]=t.useState(!1),[te]=t.useState(!1),[K,ie]=t.useState(!1),[xe]=t.useState(0),[ce,oe]=t.useState(0),[pe,be]=t.useState(""),_e=t.useRef(),ge=t.useRef(0),$e=t.useRef(0),we=t.useCallback(o=>{const w=E.current;if(!w)return;const G=w.duration||y||0;if(!Number.isFinite(G)||G<=0)return;const ue=Math.max(0,Math.min(G,o));try{const Ce={time:ue,currentTime:ue,duration:G,updatedAt:Date.now()};localStorage.setItem(L,JSON.stringify(Ce)),ge.current=ue,$e.current=Date.now()}catch(Ce){console.warn("[EnhancedVideoPlayer] Failed to persist video progress",Ce)}},[y,L]);t.useEffect(()=>{const o=E.current;if(!o)return;const w=()=>Z(!0),G=()=>{Z(!1),I>0&&ge.current===0&&(o.currentTime=I)},ue=()=>{N(o.duration)},Ce=()=>{const re=o.currentTime;ee(re);const ve=o.duration||y||0;if(!te&&B&&ve>0&&B(re/ve*100),ve>0){const Se=re/ve*100;j==null||j({currentTime:re,duration:ve,percent:Se});const je=Date.now();(Math.abs(re-ge.current)>=5||je-$e.current>=1e4||Se>=99.5)&&(we(re),$e.current=je)}if(X.length>0&&q){const Se=X.find(je=>re>=je.start&&re<=je.end);be(Se?Se.text:"")}},Qe=()=>{if(o.buffered.length>0){const re=o.buffered.end(o.buffered.length-1);oe(re/o.duration*100)}},Ae=()=>{A(!1);const re=o.duration||y||0;ee(re),Q&&Q(),we(re),localStorage.removeItem(L),ge.current=0,$e.current=0,j==null||j({currentTime:re,duration:re,percent:100})},Re=()=>{A(!0),ie(!0)},Oe=()=>{A(!1);const re=o.duration||y||0,ve=o.currentTime;if(ve>0&&we(ve),re>0){const Se=re?ve/re*100:0;j==null||j({currentTime:ve,duration:re,percent:Se})}};return o.addEventListener("loadstart",w),o.addEventListener("canplay",G),o.addEventListener("loadedmetadata",ue),o.addEventListener("timeupdate",Ce),o.addEventListener("progress",Qe),o.addEventListener("ended",Ae),o.addEventListener("play",Re),o.addEventListener("pause",Oe),()=>{o.removeEventListener("loadstart",w),o.removeEventListener("canplay",G),o.removeEventListener("loadedmetadata",ue),o.removeEventListener("timeupdate",Ce),o.removeEventListener("progress",Qe),o.removeEventListener("ended",Ae),o.removeEventListener("play",Re),o.removeEventListener("pause",Oe)}},[I,B,Q,te,y,X,q,we,L,j]),t.useEffect(()=>{const o=localStorage.getItem(L);if(!(!o||!E.current))try{const w=JSON.parse(o),G=typeof w=="number"?w:typeof(w==null?void 0:w.time)=="number"?w.time:typeof(w==null?void 0:w.currentTime)=="number"?w.currentTime:parseFloat(w);!Number.isNaN(G)&&G>0&&(E.current.currentTime=G,ee(G),ge.current=G)}catch(w){const G=parseFloat(o);!Number.isNaN(G)&&G>0&&(E.current.currentTime=G,ee(G),ge.current=G)}},[L]),t.useEffect(()=>{let o;return v&&!te&&(o=setInterval(()=>{console.log(`Watch time: ${xe+1}s`)},1e3)),()=>{o&&clearInterval(o)}},[v,te]),t.useEffect(()=>{const o=()=>{document.visibilityState==="hidden"&&E.current&&we(E.current.currentTime||0)},w=()=>{E.current&&we(E.current.currentTime||0)};return document.addEventListener("visibilitychange",o),window.addEventListener("beforeunload",w),()=>{document.removeEventListener("visibilitychange",o),window.removeEventListener("beforeunload",w)}},[we]);const Ee=t.useCallback(()=>{_e.current&&clearTimeout(_e.current),a(!0),v&&(_e.current=setTimeout(()=>{a(!1)},3e3))},[v]),Me=()=>{const o=E.current;o&&(v?o.pause():o.play())},Pe=o=>{const w=E.current;if(!w||!y)return;const G=o/100*y;w.currentTime=G,ee(G)},c=o=>{const w=E.current;w&&(w.currentTime=Math.max(0,Math.min(y,Y+o)))},Fe=o=>{const w=E.current;w&&(w.volume=o,p(o),D(o===0))},C=()=>{const o=E.current;o&&(d?(o.volume=x||.5,D(!1)):(o.volume=0,D(!0)))},r=o=>{const w=E.current;w&&(w.playbackRate=o,m(o),_(!1))},We=()=>ne(void 0,null,function*(){const o=T.current;o&&(k?document.exitFullscreen&&(yield document.exitFullscreen()):o.requestFullscreen&&(yield o.requestFullscreen()))});t.useEffect(()=>{const o=()=>{J(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const ze=o=>{const w=l.current;if(!w||!y)return;const G=w.getBoundingClientRect(),ue=(o.clientX-G.left)/G.width*100;Pe(Math.max(0,Math.min(100,ue)))};t.useEffect(()=>{const o=w=>{if(K)switch(w.key){case" ":w.preventDefault(),Me();break;case"ArrowLeft":w.preventDefault(),c(-10);break;case"ArrowRight":w.preventDefault(),c(10);break;case"ArrowUp":w.preventDefault(),Fe(Math.min(1,x+.1));break;case"ArrowDown":w.preventDefault(),Fe(Math.max(0,x-.1));break;case"m":w.preventDefault(),C();break;case"f":w.preventDefault(),We();break;case"c":w.preventDefault(),ae(!q);break}};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[K,x,q]);const de=o=>{const w=Math.floor(o/60),G=Math.floor(o%60);return`${w}:${G.toString().padStart(2,"0")}`};return e.jsxs("div",{ref:T,className:`relative bg-black rounded-lg overflow-hidden ${V}`,onMouseMove:Ee,onMouseLeave:()=>v&&a(!1),children:[e.jsx("video",{ref:E,src:n,poster:f,className:"w-full h-full",autoPlay:F,playsInline:!0,preload:"metadata",onClick:Me}),g&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),!v&&!g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("button",{onClick:Me,className:"bg-orange-500 bg-opacity-90 hover:bg-opacity-100 rounded-full p-6 transition-all duration-200 transform hover:scale-105",children:e.jsx(_t,{className:"h-8 w-8 text-white ml-1",fill:"white"})})}),q&&pe&&e.jsx("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded max-w-md text-center",children:pe}),e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black to-transparent p-4 transition-opacity duration-300 ${se?"opacity-100":"opacity-0"}`,children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{ref:l,className:"w-full h-2 bg-gray-600 rounded-full cursor-pointer relative overflow-hidden",onClick:ze,children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-400 rounded-full",style:{width:`${ce}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-orange-500 rounded-full transition-all duration-100",style:{width:`${Y/y*100}%`}}),e.jsx("div",{className:"absolute top-1/2 transform -translate-y-1/2 w-4 h-4 bg-orange-500 rounded-full border-2 border-white shadow-lg transition-all duration-100",style:{left:`${Y/y*100}%`,marginLeft:"-8px"}})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:Me,className:"text-white hover:text-orange-400 transition-colors duration-200",children:v?e.jsx(Kt,{className:"h-6 w-6"}):e.jsx(_t,{className:"h-6 w-6"})}),e.jsx("button",{onClick:()=>c(-10),className:"text-white hover:text-orange-400 transition-colors duration-200",children:e.jsx(Gt,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>c(10),className:"text-white hover:text-orange-400 transition-colors duration-200",children:e.jsx(Wt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:C,className:"text-white hover:text-orange-400 transition-colors duration-200",children:d||x===0?e.jsx(Jt,{className:"h-5 w-5"}):e.jsx(Ht,{className:"h-5 w-5"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:d?0:x,onChange:o=>Fe(parseFloat(o.target.value)),className:"w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer slider"})]}),e.jsxs("div",{className:"text-white text-sm font-medium",children:[de(Y)," / ",de(y)]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[X.length>0&&e.jsx("button",{onClick:()=>ae(!q),className:`transition-colors duration-200 ${q?"text-orange-400":"text-white hover:text-orange-400"}`,children:e.jsx(Xt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>_(!z),className:"text-white hover:text-orange-400 transition-colors duration-200",children:e.jsx(Zt,{className:"h-5 w-5"})}),z&&e.jsxs("div",{className:"absolute bottom-8 right-0 bg-black bg-opacity-90 rounded-lg p-3 min-w-[120px]",children:[e.jsx("div",{className:"text-white text-sm font-medium mb-2",children:"Playback Speed"}),[.5,.75,1,1.25,1.5,2].map(o=>e.jsxs("button",{onClick:()=>r(o),className:`block w-full text-left px-2 py-1 text-sm rounded transition-colors ${U===o?"bg-orange-500 text-white":"text-gray-300 hover:bg-gray-700"}`,children:[o,"x"]},o))]})]}),e.jsx("button",{onClick:We,className:"text-white hover:text-orange-400 transition-colors duration-200",children:k?e.jsx(es,{className:"h-5 w-5"}):e.jsx(ts,{className:"h-5 w-5"})})]})]})]}),h&&se&&e.jsx("div",{className:"absolute top-4 left-4 text-white font-medium text-lg bg-black bg-opacity-50 px-3 py-1 rounded",children:h}),Y>=y-1&&y>0&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("button",{onClick:()=>Pe(0),className:"bg-orange-500 bg-opacity-90 hover:bg-opacity-100 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all duration-200",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Restart"})]})}),$&&W&&e.jsxs("div",{className:"absolute right-0 top-0 bottom-0 w-80 bg-white bg-opacity-95 overflow-y-auto p-4 text-sm",children:[e.jsx("h3",{className:"font-semibold mb-4 text-gray-900",children:"Transcript"}),e.jsx("div",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:W})]})]})},_s=({currentProgress:n,totalLessons:h,completedLessons:f,currentLessonTitle:B,onPrevious:Q,onNext:I,hasPrevious:V=!1,hasNext:F=!1,estimatedTimeRemaining:$,visible:W=!0,className:X=""})=>{const[M,j]=t.useState(!1),[E,T]=t.useState(n),[l,L]=t.useState(!1);t.useEffect(()=>{n>E&&[25,50,75,100].find(Y=>E<Y&&n>=Y)&&(j(!0),setTimeout(()=>j(!1),3e3)),T(n)},[n,E]),t.useEffect(()=>{const g=()=>{L(window.scrollY>100)};return window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)},[]);const v=()=>n>=100?"🎉 Congratulations! Course completed!":n>=75?"🚀 Almost there! You're doing great!":n>=50?"💪 Halfway through! Keep it up!":n>=25?"⭐ Great progress! You're on track!":"",A=()=>n>=100?"from-green-400 to-emerald-500":n>=75?"from-blue-400 to-indigo-500":n>=50?"from-purple-400 to-pink-500":n>=25?"from-yellow-400 to-orange-500":"from-orange-400 to-red-500";return W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 translate-y-0 ${X}`,children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-4 min-w-[400px] max-w-2xl backdrop-blur-sm bg-opacity-95",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full bg-gradient-to-r ${A()}`}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[f," of ",h," lessons"]})]}),n===100&&e.jsx(qe,{className:"h-5 w-5 text-yellow-500 animate-pulse"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[$&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),$," left"]}),e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:[Math.round(n),"%"]})]})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${A()} transition-all duration-500 relative`,style:{width:`${n}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"})})}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-3 flex justify-between items-center",children:[25,50,75,100].map(g=>e.jsx("div",{className:`w-1 h-5 -mt-1 rounded-full transition-colors duration-300 ${n>=g?"bg-white shadow-md":"bg-gray-300"}`,style:{marginLeft:"25%"}},g))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:B}),M&&e.jsx("div",{className:"text-xs text-green-600 font-medium animate-bounce mt-1",children:v()})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:Q,disabled:!V,className:`p-2 rounded-lg transition-all duration-200 ${V?"text-gray-600 hover:text-gray-900 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,title:"Previous lesson",children:e.jsx(rs,{className:"h-5 w-5"})}),e.jsx("button",{onClick:I,disabled:!F,className:`p-2 rounded-lg transition-all duration-200 ${F?"text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 shadow-lg":"text-gray-300 cursor-not-allowed bg-gray-200"}`,title:F?"Next lesson":"Course complete",children:n>=100?e.jsx(qe,{className:"h-5 w-5"}):e.jsx(ns,{className:"h-5 w-5"})})]})]})]})}),M&&n>=100&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl p-8 max-w-md mx-4 text-center animate-bounce-in",children:[e.jsx("div",{className:"mb-6",children:e.jsx(qe,{className:"h-16 w-16 text-yellow-500 mx-auto animate-pulse"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"🎉 Congratulations!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You've successfully completed the course! Your certificate is ready for download."}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg",children:"Download Certificate"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-600 hover:text-gray-900 px-6 py-3 font-medium",children:"Continue"})]})]})}),l&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-40",children:e.jsx("div",{className:`h-1 bg-gradient-to-r ${A()} transition-all duration-300`,style:{width:`${n}%`}})}),M&&n<100&&e.jsx("div",{className:"fixed top-6 right-6 z-50 animate-slide-in-right",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl border border-gray-200 p-4 max-w-sm",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:n>=75?e.jsx(Tt,{className:"h-8 w-8 text-blue-500"}):n>=50?e.jsx(Lt,{className:"h-8 w-8 text-purple-500"}):e.jsx(le,{className:"h-8 w-8 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:"Milestone Reached!"}),e.jsx("div",{className:"text-xs text-gray-600",children:v()})]})]})})})]}):null},$s=({course:n,completionData:h,keyTakeaways:f=[],nextSteps:B=[],recommendedCourses:Q=[],onClose:I,onCertificateDownload:V,onShareComplete:F,className:$=""})=>{var ee,y;const[W,X]=t.useState(!0),[M,j]=t.useState("summary"),[E,T]=t.useState(""),[l,L]=t.useState(!1);t.useEffect(()=>{const N=`${window.location.origin}/course/${n.id}/completed`;T(N);const x=setTimeout(()=>X(!1),5e3);return()=>clearTimeout(x)},[n.id]);const v=N=>{const x=Math.floor(N/60),p=N%60;return x>0?`${x}h ${p}m`:`${p}m`},A=N=>{switch(N==null?void 0:N.toUpperCase()){case"A":case"A+":case"A-":return"text-green-600 bg-green-50";case"B":case"B+":case"B-":return"text-blue-600 bg-blue-50";case"C":case"C+":case"C-":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},g=N=>ne(void 0,null,function*(){const x=`Just completed "${n.title}"! 🎓 #Learning #ProfessionalDevelopment`;switch(N){case"linkedin":window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(E)}&summary=${encodeURIComponent(x)}`,"_blank");break;case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(x)}&url=${encodeURIComponent(E)}`,"_blank");break;case"email":window.open(`mailto:?subject=${encodeURIComponent(`Course Completion: ${n.title}`)}&body=${encodeURIComponent(`${x}

${E}`)}`,"_blank");break;case"copy":try{yield navigator.clipboard.writeText(E),L(!0),setTimeout(()=>L(!1),2e3)}catch(p){console.error("Failed to copy link:",p)}break}F&&F(N)}),Z=((ee=n.modules)==null?void 0:ee.reduce((N,x)=>N+x.lessons.length,0))||0,Y=((y=n.modules)==null?void 0:y.reduce((N,x)=>N+x.lessons.filter(p=>p.completed).length,0))||0;return e.jsxs("div",{className:`min-h-screen bg-gradient-to-br from-orange-50 via-red-50 to-pink-50 ${$}`,children:[W&&e.jsx("div",{className:"fixed inset-0 pointer-events-none z-10",children:e.jsx("div",{className:"confetti-animation",children:Array.from({length:50}).map((N,x)=>e.jsx("div",{className:"confetti-piece",style:{left:`${Math.random()*100}%`,animationDelay:`${Math.random()*3}s`,backgroundColor:["#FF8895","#D72638","#3A7FFF","#2D9B66"][Math.floor(Math.random()*4)]}},x))})}),e.jsxs("div",{className:"container mx-auto px-4 py-12 relative z-20",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"mb-6",children:e.jsx(qe,{className:"h-20 w-20 text-yellow-500 mx-auto animate-bounce"})}),e.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-4",children:"Congratulations!"}),e.jsxs("p",{className:"text-xl text-gray-600 mb-6 max-w-2xl mx-auto",children:["You've successfully completed ",e.jsxs("span",{className:"font-semibold text-gray-900",children:['"',n.title,'"']})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsxs("span",{children:["Completed in ",v(h.timeSpent)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:[Y,"/",Z," lessons"]})]}),h.grade&&e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-1 rounded-full ${A(h.grade)}`,children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsxs("span",{className:"font-medium",children:["Grade: ",h.grade]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Lt,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:["Completed ",h.completedAt.toLocaleDateString()]})]})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"bg-white rounded-xl p-1 shadow-lg border border-gray-200",children:[{id:"summary",label:"Summary",icon:Ye},{id:"certificate",label:"Certificate",icon:Ke},{id:"next-steps",label:"Next Steps",icon:Ge}].map(({id:N,label:x,icon:p})=>e.jsxs("button",{onClick:()=>j(N),className:`px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2 ${M===N?"bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{children:x})]},N))})}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[M==="summary"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Course Summary"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[n.thumbnail&&e.jsx("img",{src:n.thumbnail,alt:n.title,className:"w-16 h-16 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:n.title}),n.instructor&&e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",n.instructor]}),n.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:n.description})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y}),e.jsx("div",{className:"text-sm text-green-600",children:"Lessons Completed"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:v(h.timeSpent)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Time Invested"})]})]}),h.score&&e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[h.score,"%"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Overall Score"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Key Takeaways"}),f.length>0?e.jsx("ul",{className:"space-y-4",children:f.map((N,x)=>e.jsxs("li",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-gradient-to-r from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white text-sm font-bold",children:x+1}),e.jsx("span",{className:"text-gray-700",children:N})]},x))}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(Ye,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No specific takeaways recorded for this course."})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Share Your Achievement"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>g("linkedin"),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{children:"LinkedIn"})]}),e.jsxs("button",{onClick:()=>g("twitter"),className:"flex items-center space-x-2 px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition-colors",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsx("span",{children:"Twitter"})]}),e.jsxs("button",{onClick:()=>g("email"),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{children:"Email"})]}),e.jsxs("button",{onClick:()=>g("copy"),className:"flex items-center space-x-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("span",{children:l?"Copied!":"Copy Link"})]})]})]})]})]}),M==="certificate"&&e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200 text-center",children:[e.jsx(Ke,{className:"h-16 w-16 text-yellow-500 mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your Certificate"}),h.certificateUrl?e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600",children:"Congratulations! Your certificate is ready for download."}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200",children:[e.jsx("div",{className:"font-semibold text-gray-900 mb-2",children:"Certificate of Completion"}),e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:n.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Certificate ID: ",h.certificateId]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("button",{onClick:V,className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all duration-200 shadow-lg flex items-center space-x-2",children:[e.jsx(et,{className:"h-5 w-5"}),e.jsx("span",{children:"Download Certificate"})]}),e.jsxs("a",{href:h.certificateUrl,target:"_blank",rel:"noopener noreferrer",className:"bg-white border border-gray-300 text-gray-700 px-8 py-3 rounded-xl font-medium hover:bg-gray-50 transition-all duration-200 flex items-center space-x-2",children:[e.jsx(cs,{className:"h-5 w-5"}),e.jsx("span",{children:"View Certificate"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600",children:"Your certificate is being generated. Please check back in a few minutes."}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-3 rounded-xl font-semibold hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-lg flex items-center space-x-2 mx-auto",children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{children:"Check Again"})]})]})]}),M==="next-steps"&&e.jsxs("div",{className:"space-y-8",children:[B.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Recommended Next Steps"}),e.jsx("div",{className:"grid gap-6",children:B.map((N,x)=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-orange-400 to-red-500 rounded-full flex items-center justify-center text-white font-bold",children:x+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:N.title}),e.jsx("p",{className:"text-gray-600 mb-3",children:N.description}),(N.action||N.href)&&e.jsxs("button",{onClick:N.action,className:"text-orange-600 hover:text-orange-700 font-medium text-sm flex items-center space-x-1",children:[e.jsx("span",{children:"Get Started"}),e.jsx(Ge,{className:"h-4 w-4"})]})]})]},x))})]}),Q.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-lg border border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Continue Learning"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Q.map(N=>e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("img",{src:N.thumbnail,alt:N.title,className:"w-full h-32 object-cover"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:N.title}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-4",children:[e.jsx("span",{children:N.duration}),e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded",children:N.difficulty})]}),e.jsx("button",{className:"w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-200",children:"Start Course"})]})]},N.id))})]})]})]}),e.jsx("div",{className:"text-center mt-12",children:e.jsx("div",{className:"space-y-4",children:e.jsx("button",{onClick:I,className:"bg-white text-gray-700 border border-gray-300 px-8 py-3 rounded-xl font-medium hover:bg-gray-50 transition-all duration-200",children:"Return to Courses"})})})]}),e.jsx("style",{children:`
        .confetti-animation {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          overflow: hidden;
        }
        
        .confetti-piece {
          position: absolute;
          width: 8px;
          height: 8px;
          animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
          0% {
            transform: translateY(-100vh) rotate(0deg);
            opacity: 1;
          }
          100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
          }
        }
        
        @keyframes bounce-in {
          0% {
            transform: scale(0.3);
            opacity: 0;
          }
          50% {
            transform: scale(1.05);
            opacity: 1;
          }
          70% {
            transform: scale(0.9);
          }
          100% {
            transform: scale(1);
          }
        }
        
        .animate-bounce-in {
          animation: bounce-in 0.6s ease-out;
        }
      `})]})},Os=()=>{var ct,dt,ut;const[n,h]=t.useState({clicks:0,timeSpent:0,interactions:0,completionPrediction:0}),[f,B]=t.useState([]),[Q,I]=t.useState(!1),[V,F]=t.useState(null),$=t.useRef(),W=t.useCallback(s=>ne(void 0,null,function*(){$.current&&clearTimeout($.current),$.current=setTimeout(()=>ne(void 0,null,function*(){I(!0);try{F(new Date)}catch(u){}finally{I(!1)}}),2e3)}),[]),[X]=t.useState(Date.now()),M=t.useCallback((s,u)=>{h(i=>he(me({},i),{clicks:i.clicks+(s==="click"?1:0),interactions:i.interactions+1,timeSpent:Date.now()-X}))},[X]),{moduleId:j,lessonId:E}=ds(),T=us(),[l,L]=t.useState(0),[v,A]=t.useState(0),[g,Z]=t.useState(""),[Y,ee]=t.useState(0),[y,N]=t.useState({}),[x,p]=t.useState(!1),[d,D]=t.useState(null),[U,m]=t.useState({}),[k,J]=t.useState(!1),[se,a]=t.useState(0),[z,_]=t.useState(0),[q,ae]=t.useState(!0),te=t.useRef(null),K=t.useRef(),ie=t.useRef(null),xe=t.useRef(0),ce=t.useRef({currentTime:0,duration:0,percent:0}),[oe,pe]=t.useState(!1),[be,_e]=t.useState(Date.now()),[ge,$e]=t.useState(!1),[we,Ee]=t.useState(!1),[Me,Pe]=t.useState(!1),c=t.useMemo(()=>{const s=j?rt.getCourse(j):null;return console.log("📖 Loading course data for ID:",j,"Found:",!!s,"Refresh time:",be),s},[j,be]),Fe=s=>{var i;if(!s)return{isValid:!1,issues:["Course not found"]};const u=[];return(!s.modules||s.modules.length===0)&&u.push("No modules found"),s.title||u.push("Course title missing"),(i=s.modules)==null||i.forEach((P,S)=>{var R;(!P.lessons||P.lessons.length===0)&&u.push(`Module ${S+1} has no lessons`),(R=P.lessons)==null||R.forEach((fe,Le)=>{var Ve;fe.type==="video"&&!((Ve=fe.content)!=null&&Ve.videoUrl)&&u.push(`Module ${S+1}, Lesson ${Le+1}: Video lesson missing videoUrl`),fe.title||u.push(`Module ${S+1}, Lesson ${Le+1}: Missing title`)})}),{isValid:u.length===0,issues:u}},C=(ct=c==null?void 0:c.modules)==null?void 0:ct[l],r=C==null?void 0:C.lessons[v],We=Fe(c);console.log("🔍 Course Data Validation:",We),console.log("📚 LMS Module Debug:",{moduleIdParam:j,lessonIdParam:E,course:c,courseModules:c==null?void 0:c.modules,currentModuleIndex:l,currentLessonIndex:v,currentModule:C,currentLessonData:r}),t.useEffect(()=>{const s=()=>{ae(!0),K.current=setInterval(()=>{_(i=>i+1)},1e3)},u=()=>{ae(!1),K.current&&clearInterval(K.current)};return window.addEventListener("focus",s),window.addEventListener("blur",u),s(),()=>{window.removeEventListener("focus",s),window.removeEventListener("blur",u),K.current&&clearInterval(K.current)}},[]),t.useEffect(()=>{j&&!c&&(console.log("🔄 Course not found, forcing store refresh for ID:",j),window.location.reload())},[j,c]);const ze=t.useCallback(()=>ne(void 0,null,function*(){if(!ge){$e(!0);try{console.log("🔄 Manually refreshing course data..."),yield rt.init(),_e(Date.now()),setTimeout(()=>{$e(!1),Ee(!0),console.log("✅ Course data refreshed successfully"),setTimeout(()=>{Ee(!1)},3e3)},1e3)}catch(s){console.error("❌ Failed to refresh course data:",s),$e(!1)}}}),[ge]);t.useEffect(()=>{const s=setInterval(()=>ne(void 0,null,function*(){!ge&&document.visibilityState==="visible"&&(console.log("🔄 Auto-refreshing course data..."),yield rt.init(),_e(Date.now()))}),3e4);return()=>clearInterval(s)},[ge]),t.useEffect(()=>{const s=Ie.subscribeToCourseUpdates(i=>{console.log("🔄 Real-time course update received:",i),(i.courseId===j||i.manual)&&(_e(Date.now()),i.manual&&(Ee(!0),setTimeout(()=>Ee(!1),3e3)))}),u=Ie.subscribeToRefresh(i=>{console.log("🔄 Global refresh received:",i),_e(Date.now()),i.manual&&(Ee(!0),setTimeout(()=>Ee(!1),3e3))});return()=>{s(),u()}},[j]),t.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&!ge&&(console.log("👁️ Page became visible, checking for course updates..."),ze())};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[ze,ge]);const{lessonProgress:de,reflections:o,loading:w,error:G,updateLessonProgress:ue,markLessonComplete:Ce,saveReflection:Qe,setActiveLessonTracking:Ae}=Ss(j||"",{enableAutoSave:!0,enableRealtime:!0,autoSaveInterval:3e4});t.useEffect(()=>{r!=null&&r.id&&o[r.id]?Z(o[r.id].content):Z("")},[l,v,o,r]),t.useEffect(()=>{r!=null&&r.id&&Ae&&Ae(r.id)},[r==null?void 0:r.id,Ae]),t.useEffect(()=>{if(c&&E)for(let s=0;s<(c.modules||[]).length;s++){const i=(c.modules||[])[s].lessons.findIndex(P=>P.id===E);if(i!==-1){L(s),A(i);return}}},[E,c]);const Re=t.useCallback(()=>ne(void 0,null,function*(){const s=de[(r==null?void 0:r.id)||""];if(!((s==null?void 0:s.completed)||!1)&&r&&C&&(yield Ce(r.id,C.id)),C&&v<C.lessons.length-1){const i=v+1;A(i),T(`/lms/module/${j}/lesson/${C.lessons[i].id}`)}else if(c&&l<(c.modules||[]).length-1){const i=l+1;L(i),A(0),T(`/lms/module/${j}/lesson/${(c.modules||[])[i].lessons[0].id}`)}N({}),p(!1),D(null),m({}),J(!1)}),[v,l,c,C,r,de,Ce,j,T]),Oe=t.useCallback(()=>{if(C&&v>0){const s=v-1;A(s),T(`/lms/module/${j}/lesson/${C.lessons[s].id}`)}else if(c&&l>0){const s=l-1,u=(c.modules||[])[s];L(s),A(u.lessons.length-1),T(`/lms/module/${j}/lesson/${u.lessons[u.lessons.length-1].id}`)}N({}),p(!1),D(null),m({}),J(!1)},[v,l,c,C,j,T]),re=t.useCallback(s=>ne(void 0,null,function*(){if(!(!r||!C))return ue(r.id,C.id,s)}),[r,C,ue]),ve=t.useCallback(()=>ne(void 0,null,function*(){if(!(!g.trim()||!r))try{yield Qe(r.id,g)}catch(s){console.error("Error saving reflection:",s)}}),[g,r,Qe]),Se=t.useCallback(()=>{if(!C||!r)return;const s=[],u=de[r.id],i=(u==null?void 0:u.completed)||!1;se<50&&n.timeSpent>3e5&&s.push({type:"speed",title:"Try adjusting video speed",description:"Consider increasing playback speed to 1.25x for better engagement",action:()=>{te.current&&(te.current.playbackRate=1.25)}}),i&&v<((C==null?void 0:C.lessons.length)||0)-1&&s.push({type:"next",title:"Continue momentum",description:"You're doing great! Ready for the next lesson?",action:Re}),g.length>0&&g.length<50&&s.push({type:"reflect",title:"Expand your reflection",description:"Add more details to deepen your learning experience",action:()=>{var P;return(P=document.querySelector("textarea"))==null?void 0:P.focus()}}),B(s)},[se,n,v,C,g,de,r,Re]);t.useEffect(()=>{n.interactions>0&&Se()},[n.interactions,Se]);const je=t.useMemo(()=>{var R;if(!c||n.timeSpent<6e4)return null;const s=((R=c.modules)==null?void 0:R.reduce((fe,Le)=>fe+Le.lessons.length,0))||0,u=Object.values(de).filter(fe=>fe.completed).length,i=n.timeSpent/Math.max(u,1),P=s-u,S=P*i;return{totalLessons:s,completedLessons:u,remainingLessons:P,estimatedTimeRemaining:S,completionPercentage:Math.round(u/s*100)}},[c,de,n.timeSpent]),Te=(()=>{var P;const u=((P=c==null?void 0:c.modules)!=null?P:[]).reduce((S,R)=>S+R.lessons.length,0),i=Object.values(de).filter(S=>S.completed).length;return u>0?Math.round(i/u*100):0})();t.useEffect(()=>{Te>=100&&Pe(!0)},[Te]);const O=r?de[r.id]:void 0,ot=(O==null?void 0:O.completed)||!1,lt=!!C&&!(l===0&&v===0),Je=!!C&&(v<((dt=C==null?void 0:C.lessons.length)!=null?dt:0)-1||l<((c==null?void 0:c.modules)||[]).length-1),Mt=["flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-300",Je?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-200 text-gray-500 cursor-not-allowed"].join(" "),At=t.useCallback(()=>{pe(!0)},[]),tt=t.useCallback(()=>{pe(!1),window.setTimeout(()=>{var s;(s=ie.current)==null||s.focus()},0)},[]);t.useEffect(()=>{var s;r&&(xe.current=0,ce.current={currentTime:(O==null?void 0:O.time_spent)||0,duration:ce.current.duration,percent:(O==null?void 0:O.progress_percentage)||0},(s=ie.current)==null||s.focus())},[r,O==null?void 0:O.time_spent,O==null?void 0:O.progress_percentage]);const Ot=t.useCallback(s=>{if(!r||!C||!s.duration)return;const u=ce.current;ce.current=s,a(s.percent);const i=Date.now(),P=Math.abs(s.currentTime-u.currentTime);if(s.percent<99.5&&i-xe.current<4e3&&P<2)return;const S=Math.min(100,Math.max((O==null?void 0:O.progress_percentage)||0,s.percent)),R=Math.max((O==null?void 0:O.time_spent)||0,Math.round(s.currentTime));xe.current=i,ue(r.id,C.id,{progress_percentage:S,time_spent:R,last_accessed_at:new Date().toISOString()})},[r,O==null?void 0:O.progress_percentage,O==null?void 0:O.time_spent,C,ue]);if(!c)return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Course Not Found"}),e.jsx(Xe,{to:"/lms/courses",className:"text-orange-500 hover:text-orange-600",children:"← Back to Courses"})]});if(w)return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Loading course..."})]});if(G)return e.jsx("div",{className:"p-6 max-w-4xl mx-auto text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-900 mb-2",children:"Unable to Load Course"}),e.jsx("p",{className:"text-red-700 mb-4",children:"Please make sure you're logged in and try again."}),e.jsx(Xe,{to:"/lms/login",className:"inline-flex items-center bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Go to Login"})]})});if(!C||!r)return e.jsx("div",{className:"p-6",children:"Loading..."});const it=()=>ne(void 0,null,function*(){if(!r.content.questions)return;const s=r.content.questions;let u=0;const i=s.length;s.forEach(R=>{y[R.id]===R.correctAnswerIndex&&u++});const S=Math.round(u/i*100)>=(r.content.passingScore||80);D({score:u,maxScore:i,passed:S}),p(!0)}),Dt=()=>{J(!0),Object.entries(U).some(([u,i])=>{var S,R;if(!i)return!1;const P=(R=(S=r.content)==null?void 0:S.options)==null?void 0:R[parseInt(u)];return P==null?void 0:P.isCorrect})&&re({completed:!0,progress_percentage:100})},Pt=s=>{switch(s){case"video":return e.jsx(bs,{className:"h-5 w-5"});case"interactive":return e.jsx(Ze,{className:"h-5 w-5"});case"quiz":return e.jsx(le,{className:"h-5 w-5"});case"download":return e.jsx(et,{className:"h-5 w-5"});case"text":return e.jsx(Ye,{className:"h-5 w-5"});default:return e.jsx(Ye,{className:"h-5 w-5"})}},Ft=()=>{var s,u;return e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg",children:[(s=r.content.questions)==null?void 0:s.map((i,P)=>e.jsxs("div",{className:"mb-8 last:mb-6",children:[e.jsxs("h4",{className:"font-medium text-orange-900 mb-4 text-lg",children:["Question ",P+1,": ",i.text]}),e.jsx("div",{className:"space-y-3",children:i.options.map((S,R)=>e.jsx("button",{onClick:()=>{x||N(fe=>he(me({},fe),{[i.id]:R}))},disabled:x,className:`w-full text-left p-4 border-2 rounded-lg transition-all duration-200 ${x?R===i.correctAnswerIndex?"border-green-500 bg-green-50":y[i.id]===R?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50":y[i.id]===R?"border-orange-500 bg-orange-50":"border-orange-200 hover:border-orange-300 hover:bg-orange-50"} ${x?"cursor-default":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${x?R===i.correctAnswerIndex?"border-green-500 bg-green-500":y[i.id]===R?"border-red-500 bg-red-500":"border-gray-300":y[i.id]===R?"border-orange-500 bg-orange-500":"border-orange-300"}`,children:(x&&R===i.correctAnswerIndex||!x&&y[i.id]===R)&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})}),e.jsx("span",{className:"text-orange-900",children:S})]})},R))}),x&&i.explanation&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"Explanation:"}),e.jsx("p",{className:"text-blue-800 text-sm",children:i.explanation})]})]},i.id)),!x&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:it,disabled:Object.keys(y).length!==((u=r.content.questions)==null?void 0:u.length),className:"bg-orange-600 text-white px-8 py-3 rounded-lg hover:bg-orange-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center mx-auto space-x-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),e.jsx("span",{children:"Submit Quiz"})]})}),x&&d&&e.jsx("div",{className:`mt-6 p-6 rounded-lg border-2 ${d.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold mb-2 ${d.passed?"text-green-600":"text-red-600"}`,children:[Math.round(d.score/d.maxScore*100),"%"]}),e.jsx("p",{className:`text-lg font-medium mb-2 ${d.passed?"text-green-800":"text-red-800"}`,children:d.passed?"Congratulations! You passed!":"Keep studying and try again"}),e.jsxs("p",{className:`text-sm ${d.passed?"text-green-700":"text-red-700"}`,children:["You scored ",d.score," out of ",d.maxScore," questions correctly"]}),d.passed&&e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-2 text-green-700",children:[e.jsx(Ke,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Lesson completed!"})]})]})})]})},zt=()=>{var S,R,fe,Le,Ve,mt,xt,gt,ht,ft,pt,bt,vt,jt,yt,Nt,wt;if(console.log("🎥 Rendering lesson content:",{lessonData:r,type:r.type,content:r.content,videoUrl:(S=r.content)==null?void 0:S.videoUrl}),console.log("🔍 Video Debug Details:",{lessonType:r.type,content:r.content,videoUrl:(R=r.content)==null?void 0:R.videoUrl,videoSourceType:(fe=r.content)==null?void 0:fe.videoSourceType,hasContent:!!r.content}),((Le=r.content)==null?void 0:Le.videoUrl)||r.type==="video"||r.type==="video"){const b=(Ve=r.content)==null?void 0:Ve.videoUrl;console.log("🎯 Current Lesson Debug:",{lessonId:r.id,lessonTitle:r.title,lessonType:r.type,courseId:c==null?void 0:c.id,courseTitle:c==null?void 0:c.title,moduleId:C==null?void 0:C.id,moduleTitle:C==null?void 0:C.title,contentKeys:Object.keys(r.content||{}),videoUrl:b});const ke=b&&b.trim()!==""&&b!=="undefined"&&b!=="null"&&!b.includes("placeholder")&&(b.startsWith("http")||b.startsWith("blob:")||b.startsWith("data:"));(b==null?void 0:b.startsWith("blob:"))&&console.log("⚠️ Warning: Blob URL detected - this may not work after page reload:",b),console.log("🔍 Video URL Validation:",{rawVideoUrl:b,isValidVideoUrl:ke,urlLength:b==null?void 0:b.length,trimmed:b==null?void 0:b.trim()});const He=ke?b:"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",Ue=!ke,Qt=b==null?void 0:b.startsWith("uploaded:");return console.log("🎬 Video URL Decision:",{videoUrl:b,finalVideoUrl:He,isUsingFallback:Ue}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ks,{src:He,title:r.title,onProgress:Ne=>{a(Ne),(Ne===25||Ne===50||Ne===75)&&M("progress_milestone",{milestone:Ne})},onComplete:()=>{M("video_complete"),ue(r.id,C.id,{completed:!0,progress_percentage:100,time_spent:Math.max((O==null?void 0:O.time_spent)||0,Math.round(ce.current.duration||ce.current.currentTime||0))});const Ne=new CustomEvent("show-notification",{detail:{type:"success",message:"🎉 Lesson completed! Great job!",duration:3e3}});window.dispatchEvent(Ne)},initialTime:(O==null?void 0:O.time_spent)||0,autoPlay:!1,showTranscript:!!((mt=r.content)!=null&&mt.transcript),transcript:((xt=r.content)==null?void 0:xt.transcript)||"",captions:((ht=(gt=r.content)==null?void 0:gt.captions)==null?void 0:ht.map(Ne=>({start:Ne.startTime||0,end:Ne.endTime||0,text:Ne.text||""})))||[],resumeKey:`${(c==null?void 0:c.id)||j||"module"}-${r.id}`,onTimeUpdate:Ot,className:"aspect-video"}),Ue&&e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"🚧 Demo Video:"})," Using fallback video for demonstration."]})}),!Ue&&e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("p",{className:"text-green-800 text-sm",children:[e.jsx("strong",{children:"✅ Course Video:"})," Playing actual lesson video content."]})}),Ue&&e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("p",{className:"text-yellow-800 text-sm",children:Qt?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"🚧 Demo Video (File Upload):"})," You uploaded a video file (",b==null?void 0:b.replace("uploaded:",""),"), but file uploads require cloud storage setup. Playing demo video for now."]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"🚧 Demo Video:"})," No valid video URL found in lesson content. Playing fallback video for demonstration."]})}),e.jsx("div",{className:"mt-3 text-xs text-yellow-700 bg-yellow-100 p-2 rounded",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("strong",{children:"Debug Info:"}),e.jsx("br",{}),"Course ID: ",(c==null?void 0:c.id)||"undefined",e.jsx("br",{}),"Lesson ID: ",(r==null?void 0:r.id)||"undefined",e.jsx("br",{}),"Lesson Type: ",(r==null?void 0:r.type)||"undefined",e.jsx("br",{}),"Video URL: ",b||"undefined",e.jsx("br",{}),"Content Keys: ",Object.keys((r==null?void 0:r.content)||{}).join(", ")||"none"]}),e.jsxs("div",{className:"ml-4 flex flex-col space-y-1",children:[e.jsx("button",{onClick:()=>{console.log("🔄 Force refreshing course data..."),window.location.reload()},className:"bg-yellow-600 text-white px-2 py-1 rounded text-xs hover:bg-yellow-700",children:"Refresh"}),e.jsx("button",{onClick:()=>{console.log("🔍 Course Data:",c),console.log("📊 Current Lesson:",r),alert("Check browser console for detailed course data")},className:"bg-blue-600 text-white px-2 py-1 rounded text-xs hover:bg-blue-700",children:"Debug"})]})]})})]}),!Ue&&e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("p",{className:"text-green-800 text-sm",children:[e.jsx("strong",{children:"✅ Course Video:"})," Playing actual lesson video content."]})}),((ft=r.content)==null?void 0:ft.transcript)&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Transcript"}),e.jsx("p",{className:"text-gray-700 text-sm whitespace-pre-wrap",children:r.content.transcript})]}),((pt=r.content)==null?void 0:pt.notes)&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Key Notes"}),e.jsx("p",{className:"text-blue-800 text-sm",children:r.content.notes})]})]})}const u=((bt=r.content)==null?void 0:bt.questions)&&r.content.questions.length>0,i=((vt=r.content)==null?void 0:vt.content)||((jt=r.content)==null?void 0:jt.textContent),P=[];if(u&&P.push(e.jsx("div",{className:"mt-8",children:e.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-6 flex items-center",children:[e.jsx(le,{className:"h-6 w-6 mr-2 text-orange-500"}),"Knowledge Check"]}),Ft()]})},"quiz-section")),i&&P.push(e.jsx("div",{className:"mt-8",children:e.jsx("div",{className:"border-t border-gray-200 pt-8",children:e.jsx("div",{className:"prose max-w-none",children:e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-900 mb-4",children:r.content.title||"Additional Reading"}),e.jsx("div",{className:"text-blue-800 whitespace-pre-wrap",children:r.content.content||r.content.textContent})]})})})},"text-section")),P.length>0)return e.jsx("div",{className:"space-y-6",children:P});switch(r.type){case"interactive":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-green-900 mb-4",children:"Interactive Exercise"}),e.jsx("p",{className:"text-green-800 text-lg mb-6",children:r.content.scenarioText}),r.content.instructions&&e.jsx("div",{className:"bg-green-100 p-4 rounded-lg mb-6",children:e.jsx("p",{className:"text-green-800 text-sm font-medium",children:r.content.instructions})}),e.jsx("div",{className:"space-y-3",children:(yt=r.content.options)==null?void 0:yt.map((b,ke)=>e.jsxs("button",{onClick:()=>{m({[ke]:!0}),k||J(!0)},className:`w-full text-left p-4 border-2 rounded-lg transition-all duration-200 ${U[ke]?b.isCorrect?"border-green-500 bg-green-50":"border-red-500 bg-red-50":"border-green-200 hover:border-green-300 hover:bg-green-50"}`,children:[e.jsx("p",{className:"font-medium text-green-900 mb-2",children:b.text}),k&&U[ke]&&e.jsxs("div",{className:`mt-3 p-3 rounded-lg ${b.isCorrect?"bg-green-100":"bg-red-100"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[b.isCorrect?e.jsx(le,{className:"h-5 w-5 text-green-600"}):e.jsx($t,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:`font-medium ${b.isCorrect?"text-green-800":"text-red-800"}`,children:b.isCorrect?"Correct!":"Not quite right"})]}),e.jsx("p",{className:`text-sm ${b.isCorrect?"text-green-700":"text-red-700"}`,children:b.feedback})]})]},ke))}),k&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:Dt,className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center mx-auto space-x-2",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:"Complete Exercise"})]})})]})});case"quiz":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-orange-900 mb-6",children:"Knowledge Check"}),(Nt=r.content.questions)==null?void 0:Nt.map((b,ke)=>e.jsxs("div",{className:"mb-8 last:mb-6",children:[e.jsxs("h4",{className:"font-medium text-orange-900 mb-4 text-lg",children:["Question ",ke+1,": ",b.text]}),e.jsx("div",{className:"space-y-3",children:b.options.map((Ct,ye)=>e.jsx("button",{onClick:()=>{x||N(He=>he(me({},He),{[b.id]:ye}))},disabled:x,className:`w-full text-left p-4 border-2 rounded-lg transition-all duration-200 ${x?ye===b.correctAnswerIndex?"border-green-500 bg-green-50":y[b.id]===ye?"border-red-500 bg-red-50":"border-gray-200 bg-gray-50":y[b.id]===ye?"border-orange-500 bg-orange-50":"border-orange-200 hover:border-orange-300 hover:bg-orange-50"} ${x?"cursor-default":"cursor-pointer"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${x?ye===b.correctAnswerIndex?"border-green-500 bg-green-500":y[b.id]===ye?"border-red-500 bg-red-500":"border-gray-300":y[b.id]===ye?"border-orange-500 bg-orange-500":"border-orange-300"}`,children:(x&&ye===b.correctAnswerIndex||!x&&y[b.id]===ye)&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})}),e.jsx("span",{className:"text-orange-900",children:Ct})]})},ye))}),x&&b.explanation&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"Explanation:"}),e.jsx("p",{className:"text-blue-800 text-sm",children:b.explanation})]})]},b.id)),!x&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:it,disabled:Object.keys(y).length!==((wt=r.content.questions)==null?void 0:wt.length),className:"bg-orange-600 text-white px-8 py-3 rounded-lg hover:bg-orange-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center mx-auto space-x-2",children:[e.jsx(Rt,{className:"h-5 w-5"}),e.jsx("span",{children:"Submit Quiz"})]})}),x&&d&&e.jsx("div",{className:`mt-6 p-6 rounded-lg border-2 ${d.passed?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold mb-2 ${d.passed?"text-green-600":"text-red-600"}`,children:[Math.round(d.score/d.maxScore*100),"%"]}),e.jsx("p",{className:`text-lg font-medium mb-2 ${d.passed?"text-green-800":"text-red-800"}`,children:d.passed?"Congratulations! You passed!":"Keep studying and try again"}),e.jsxs("p",{className:`text-sm ${d.passed?"text-green-700":"text-red-700"}`,children:["You scored ",d.score," out of ",d.maxScore," questions correctly"]}),d.passed&&e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-2 text-green-700",children:[e.jsx(Ke,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Lesson completed!"})]})]})})]})});case"document":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-900 mb-4",children:r.content.title||r.title}),e.jsx("p",{className:"text-blue-800 mb-6",children:r.content.description||"Download the resource below to continue your learning."}),r.content.fileUrl&&r.content.fileUrl.trim()?e.jsx("div",{className:"text-center",children:e.jsxs("a",{href:r.content.fileUrl,download:r.content.fileName,onClick:()=>{ue(r.id,C.id,{completed:!0,progress_percentage:100})},target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition-colors duration-200 space-x-3 text-lg font-medium",children:[e.jsx(et,{className:"h-6 w-6"}),e.jsxs("span",{children:["Download ",r.content.fileName||"Resource"]}),r.content.fileSize&&e.jsxs("span",{className:"text-blue-200",children:["(",r.content.fileSize,")"]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Et,{className:"h-12 w-12 text-blue-400 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-700",children:"Resource is being prepared"}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:"Please check back later or contact your instructor"})]}),r.content.instructions&&e.jsxs("div",{className:"mt-6 bg-blue-100 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Instructions"}),e.jsx("p",{className:"text-blue-800 text-sm",children:r.content.instructions})]})]})});case"text":return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-indigo-50 p-6 rounded-lg",children:e.jsxs("div",{className:"prose max-w-none",children:[r.content.content&&e.jsx("div",{className:"text-gray-900 leading-relaxed whitespace-pre-wrap mb-6",children:r.content.content}),r.content.allowReflection&&r.content.reflectionPrompt&&e.jsxs("div",{className:"mt-8 bg-indigo-100 p-6 rounded-lg border border-indigo-200",children:[e.jsxs("h4",{className:"font-medium text-indigo-900 mb-4 flex items-center",children:[e.jsx(Ze,{className:"h-5 w-5 mr-2"}),"Reflection",r.content.requireReflection&&e.jsx("span",{className:"ml-2 text-sm text-indigo-700 bg-indigo-200 px-2 py-1 rounded",children:"Required"})]}),e.jsx("p",{className:"text-indigo-800 mb-4",children:r.content.reflectionPrompt}),e.jsx("textarea",{rows:6,className:"w-full p-4 border border-indigo-200 rounded-lg resize-vertical focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Share your thoughts and reflections here...",onChange:b=>{b.target.value.length>50&&ue(r.id,C.id,{progress_percentage:Math.max((O==null?void 0:O.progress_percentage)||0,75),time_spent:((O==null?void 0:O.time_spent)||0)+1})}}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-indigo-600",children:"Take your time to reflect on the content above."}),e.jsxs("button",{onClick:()=>{ue(r.id,C.id,{completed:!0,progress_percentage:100})},className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Complete Reflection"})]})]})]}),!r.content.allowReflection&&e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("button",{onClick:()=>{ue(r.id,C.id,{completed:!0,progress_percentage:100})},className:"bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center mx-auto space-x-2",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:"Mark as Complete"})]})})]})})});default:return e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg text-center",children:[e.jsx(Ye,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:r.title}),e.jsx("p",{className:"text-gray-600",children:"Content for this lesson type is not yet available."})]})}};return e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"#lesson-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:rounded-md focus:bg-white focus:px-4 focus:py-2 focus:text-sm focus:shadow-lg",children:"Skip to lesson content"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",style:{minHeight:"100vh"},children:[e.jsx(_s,{currentProgress:Te,totalLessons:(c.modules||[]).reduce((s,u)=>s+u.lessons.length,0),completedLessons:Object.values(de).filter(s=>s.completed).length,currentLessonTitle:r.title,onPrevious:Oe,onNext:Re,hasPrevious:lt,hasNext:Je,estimatedTimeRemaining:je?`${Math.round(je.estimatedTimeRemaining/(1e3*60*60*24))} days`:void 0,visible:!0}),we&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 animate-fade-in",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:"Course content refreshed successfully!"})]}),Te>=100&&Me&&e.jsx($s,{course:{id:c.id,title:c.title,description:c.description||"",instructor:c.instructorName||"Course Instructor",duration:c.duration,modules:(ut=c.modules)==null?void 0:ut.map(s=>({id:s.id,title:s.title,lessons:s.lessons.map(u=>{var i;return{id:u.id,title:u.title,completed:((i=de[u.id])==null?void 0:i.completed)||!1}})}))},completionData:{completedAt:new Date,timeSpent:Math.round(z/60),score:85,grade:"A",certificateId:`cert-${c.id}-${Date.now()}`,certificateUrl:`/certificates/${c.id}`},keyTakeaways:c.keyTakeaways||["Enhanced leadership skills through practical application","Improved understanding of team dynamics and communication","Developed strategic thinking and decision-making abilities"],nextSteps:[{title:"Advanced Leadership Course",description:"Continue your leadership journey with advanced concepts",href:"/lms/courses/advanced-leadership"},{title:"Mentorship Program",description:"Apply your skills by mentoring other learners",href:"/lms/mentorship"}],onClose:()=>{Pe(!1),T("/lms/courses")},onCertificateDownload:()=>ne(void 0,null,function*(){M("certificate_downloaded")}),onShareComplete:s=>{M("achievement_shared",{platform:s})}}),e.jsxs("div",{className:"mb-6",children:[e.jsxs(Xe,{to:"/lms/courses",className:"inline-flex items-center text-orange-500 hover:text-orange-600 mb-4",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Back to Courses"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:c.title}),e.jsx("p",{className:"text-gray-600",children:c.description}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Module ",l+1," of ",(c.modules||[]).length,": ",C.title]}),e.jsxs("button",{onClick:ze,disabled:ge,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh course content",children:[e.jsx(at,{className:`h-4 w-4 mr-1 ${ge?"animate-spin":""}`}),ge?"Refreshing...":"Refresh Content"]})]})]}),we&&e.jsxs("div",{className:"fixed top-4 right-4 z-50 bg-green-100 border border-green-400 text-green-800 px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2",children:[e.jsx(le,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Course content updated successfully!"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[c&&c.modules&&c.modules.length>0&&e.jsx("div",{className:"lg:w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Course Progress"}),e.jsx("div",{className:"space-y-4",children:(c.modules||[]).map((s,u)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-3 bg-gray-50 border-b border-gray-200",children:e.jsx("h4",{className:"font-medium text-gray-900",children:s.title})}),e.jsx("div",{className:"p-2 space-y-1",children:s.lessons.map((i,P)=>{const S=de[i.id],R=u===l&&P===v;return e.jsx("button",{onClick:()=>{L(u),A(P),N({}),p(!1),D(null),T(`/lms/module/${s.id}/lesson/${i.id}`)},className:`w-full text-left p-2 rounded-lg transition-colors duration-200 ${R?"bg-orange-50 border border-orange-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-1 rounded ${R?"text-orange-500":S!=null&&S.completed?"text-green-500":"text-gray-400"}`,children:S!=null&&S.completed?e.jsx(le,{className:"h-5 w-5"}):e.jsx(Be,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium text-sm ${R?"text-orange-900":"text-gray-900"}`,children:i.title}),e.jsx("p",{className:"text-xs text-gray-600",children:i.duration})]})]}),(S==null?void 0:S.completed)&&e.jsx(le,{className:"h-4 w-4 text-green-500"})]})},i.id)})})]},s.id))})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),r.duration]}),e.jsx("span",{className:"capitalize",children:r.type}),ot&&e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Completed"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:Oe,disabled:!lt,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Go to previous lesson",children:e.jsx(st,{className:"h-5 w-5"})}),e.jsx("button",{onClick:Re,disabled:!Je,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Go to next lesson",children:e.jsx(Ge,{className:"h-5 w-5"})}),!ot&&r.type!=="quiz"&&e.jsxs("button",{onClick:()=>Ce(r.id,C.id),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Mark Complete"})]})]})]})}),e.jsx("div",{id:"lesson-content",ref:ie,tabIndex:-1,className:"p-6 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white","aria-label":`${r.title} lesson content`,children:zt()})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center",children:[e.jsx(Ze,{className:"h-5 w-5 mr-2 text-blue-500"}),"Reflection & Notes"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Q&&e.jsxs("div",{className:"flex items-center text-orange-600 text-sm",children:[e.jsx(at,{className:"h-4 w-4 mr-1 animate-spin"}),"Auto-saving..."]}),V&&e.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Saved ",V.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:g,onChange:s=>{Z(s.target.value),M("reflection_edit"),W({lessonId:r.id,moduleId:C.id,progress:{reflection:s.target.value}})},onFocus:()=>M("reflection_focus"),placeholder:"What are your key takeaways from this lesson? How will you apply these concepts in your leadership role?",className:"w-full h-32 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none transition-all duration-200"}),e.jsx("div",{className:"absolute bottom-2 right-2 flex items-center space-x-2",children:e.jsxs("div",{className:`text-xs px-2 py-1 rounded ${g.length>200?"bg-green-100 text-green-600":g.length>50?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-600"}`,children:[g.length," chars"]})})]}),g.length<50&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium mb-2",children:"💡 Writing Prompts:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• What surprised you most about this content?"}),e.jsx("li",{children:"• How does this relate to your current leadership challenges?"}),e.jsx("li",{children:"• What specific action will you take this week?"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:o[r.id]?`Previously saved: ${new Date(o[r.id].updated_at).toLocaleString()}`:"Notes are auto-saved as you type"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[g.length>=100&&e.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(qe,{className:"h-4 w-4 mr-1"}),"Great reflection!"]}),e.jsxs("button",{onClick:ve,disabled:!g.trim(),className:"bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{children:"Save Now"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Key Takeaways"}),e.jsx("ul",{className:"space-y-3",children:(c.keyTakeaways||[]).map((s,u)=>e.jsxs("li",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-400 rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:s})]},u))})]})]}),e.jsxs("div",{className:"lg:w-80 flex-shrink-0 space-y-6",children:[f.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-sm border border-blue-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-900 mb-4 flex items-center",children:[e.jsx(xs,{className:"h-5 w-5 mr-2 text-yellow-500"}),"Smart Recommendations"]}),e.jsx("div",{className:"space-y-3",children:f.map((s,u)=>e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-4 border border-blue-200/50 hover:bg-white/90 transition-all duration-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:s.title}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:s.description}),e.jsxs("button",{onClick:s.action,className:"inline-flex items-center px-3 py-1.5 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors duration-200",children:[e.jsx(Tt,{className:"h-3 w-3 mr-1"}),"Apply"]})]}),e.jsxs("div",{className:"ml-3",children:[s.type==="speed"&&e.jsx(gs,{className:"h-5 w-5 text-blue-500"}),s.type==="next"&&e.jsx(Ge,{className:"h-5 w-5 text-green-500"}),s.type==="reflect"&&e.jsx(Ze,{className:"h-5 w-5 text-orange-500"})]})]})},u))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(hs,{className:"h-5 w-5 mr-2 text-green-500"}),"Your Progress Today"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round(z/60)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Minutes Focused"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.interactions}),e.jsx("div",{className:"text-xs text-gray-600",children:"Interactions"})]})]}),je&&e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"text-sm font-medium text-purple-900 mb-1",children:"Completion Prediction"}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:[Math.round(je.estimatedTimeRemaining/(1e3*60*60*24))," days"]}),e.jsxs("div",{className:"text-xs text-purple-700",children:[je.remainingLessons," lessons remaining"]})]}),!q&&e.jsxs("div",{className:"mt-3 flex items-center text-amber-600 text-sm",children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),"Focus to continue tracking progress"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Course Progress"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{children:[Te,"%"]})]}),e.jsxs("div",{className:"w-full bg-gray-200 rounded-full h-3 relative overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-red-500 h-3 rounded-full transition-all duration-700 ease-out relative",style:{width:`${Te}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})}),[25,50,75].map(s=>e.jsx("div",{className:`absolute top-0 bottom-0 w-0.5 transition-colors duration-300 ${Te>=s?"bg-green-400":"bg-gray-300"}`,style:{left:`${s}%`}},s))]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:Object.values(de).filter(s=>s.completed).length})," of"," ",e.jsx("span",{className:"font-medium",children:(c.modules||[]).reduce((s,u)=>s+u.lessons.length,0)})," lessons completed"]}),Te===100&&e.jsxs("div",{className:"mt-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg text-center relative overflow-hidden animate-pulse",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-100/0 via-green-100/50 to-green-100/0 animate-pulse"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"h-10 w-10 text-green-600 mx-auto mb-3 animate-bounce"}),e.jsxs("div",{className:"flex items-center justify-center space-x-1 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🎉"}),e.jsx("p",{className:"font-bold text-green-800 text-lg",children:"Course Completed!"}),e.jsx("span",{className:"text-2xl",children:"🎉"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Congratulations! You've successfully completed all lessons."}),e.jsxs("div",{className:"flex justify-center space-x-4 text-xs text-green-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(le,{className:"h-3 w-3"}),e.jsxs("span",{children:[Object.values(de).filter(s=>s.completed).length," Lessons"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Be,{className:"h-3 w-3"}),e.jsx("span",{children:c.duration})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(nt,{className:"h-3 w-3"}),e.jsx("span",{children:"100% Complete"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Course Content"}),e.jsx("div",{className:"space-y-4",children:(c.modules||[]).map((s,u)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"p-3 bg-gray-50 border-b border-gray-200",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.lessons.length," lessons • ",s.duration]})]}),e.jsx("div",{className:"p-2 space-y-1",children:s.lessons.map((i,P)=>{const S=de[i.id],R=u===l&&P===v;return e.jsxs("button",{onClick:()=>{L(u),A(P),N({}),p(!1),D(null),m({}),J(!1),T(`/lms/module/${j}/lesson/${i.id}`)},className:`w-full text-left p-2 rounded-lg transition-colors duration-200 ${R?"bg-orange-50 border border-orange-200":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-1 rounded ${R?"text-orange-500":S!=null&&S.completed?"text-green-500":"text-gray-400"}`,children:S!=null&&S.completed?e.jsx(le,{className:"h-5 w-5"}):Pt(i.type)}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium text-sm ${R?"text-orange-900":"text-gray-900"}`,children:i.title}),e.jsx("p",{className:"text-xs text-gray-600",children:i.duration})]})]}),(S==null?void 0:S.completed)&&e.jsx(le,{className:"h-4 w-4 text-green-500"})]}),S&&S.progress_percentage>0&&S.progress_percentage<100&&e.jsx("div",{className:"mt-2 ml-8",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-orange-400 h-1 rounded-full",style:{width:`${S.progress_percentage}%`}})})})]},i.id)})})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Module Resources"}),e.jsxs("div",{className:"space-y-3",children:[(C.resources||[]).map((s,u)=>e.jsxs("a",{href:s.downloadUrl,className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Et,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.type," • ",s.size]})]})]}),e.jsx(et,{className:"h-5 w-5 text-gray-400"})]},u)),(C.resources||[]).length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No additional resources for this module"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Rate This Module"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Help us improve the learning experience"}),e.jsxs("div",{className:"flex items-center space-x-1 mb-4",children:[[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>ee(s),className:`hover:text-yellow-500 ${Y>=s?"text-yellow-400":"text-gray-300"}`,children:e.jsx(nt,{className:"h-6 w-6 fill-current"})},s)),Y>0&&e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["Thanks for rating! (",Y,"/5)"]})]}),e.jsx(Xe,{to:"/lms/feedback",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Leave detailed feedback →"})]})]})]})]}),oe&&e.jsxs("div",{className:"fixed inset-0 z-40 flex items-end justify-center bg-black/40 backdrop-blur-sm md:hidden",role:"dialog","aria-modal":"true","aria-labelledby":"mobile-lesson-list-title",children:[e.jsx("div",{className:"absolute inset-0",onClick:tt,"aria-hidden":"true"}),e.jsxs("div",{className:"relative z-50 w-full max-h-[70vh] rounded-t-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 py-3",children:[e.jsx("h2",{id:"mobile-lesson-list-title",className:"text-sm font-semibold text-gray-900",children:"Lesson outline"}),e.jsx("button",{type:"button",onClick:tt,className:"rounded-full p-2 text-gray-500 transition hover:bg-gray-100 hover:text-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400","aria-label":"Close lesson outline",children:e.jsx(fs,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto px-4 py-2",children:(c.modules||[]).map((s,u)=>e.jsxs("div",{className:"py-2",children:[e.jsxs("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:["Module ",u+1,": ",s.title]}),e.jsx("ul",{className:"mt-2 space-y-1",children:s.lessons.map((i,P)=>{const S=u===l&&P===v,R=de[i.id];return e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>{L(u),A(P);const fe=j||s.id;T(`/lms/module/${fe}/lesson/${i.id}`),tt()},className:`flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 ${S?"bg-orange-50 text-orange-900 ring-1 ring-orange-200":"bg-white text-gray-700 hover:bg-gray-50"}`,"aria-current":S?"true":"false",children:[e.jsx("span",{className:"flex-1 truncate",children:i.title}),(R==null?void 0:R.completed)&&e.jsx(le,{className:"ml-2 h-4 w-4 text-green-500","aria-hidden":"true"})]})},i.id)})})]},s.id))})]})]}),e.jsx("nav",{className:"fixed inset-x-0 bottom-0 z-30 border-t border-gray-200 bg-white/95 shadow-lg backdrop-blur md:hidden","aria-label":"Lesson navigation",children:e.jsxs("div",{className:"mx-auto flex max-w-3xl items-center justify-between gap-3 px-4 py-3",children:[e.jsxs("button",{type:"button",onClick:At,"aria-expanded":oe,"aria-controls":"mobile-lesson-list-title",className:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400",children:[e.jsx(ps,{className:"h-4 w-4"}),"Lessons"]}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-2",children:[e.jsxs("button",{type:"button",onClick:Oe,disabled:l===0&&v===0,className:"flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-400 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Go to previous lesson",children:[e.jsx(st,{className:"h-4 w-4"}),"Prev"]}),e.jsxs("button",{type:"button",onClick:Re,disabled:!Je,className:Mt,"aria-label":"Go to next lesson",children:["Next",e.jsx(Ge,{className:"h-4 w-4"})]})]})]})})]})]})};export{Os as default};
