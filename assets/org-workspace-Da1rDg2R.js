import{r as x,j as t,u as U,L as D,O as M}from"./vendor-react-QCW_vqNX.js";const Y="modulepreload",Q=function(e){return"/"+e},W={},J=function(a,s,n){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));l=Promise.allSettled(s.map(c=>{if(c=Q(c),c in W)return;W[c]=!0;const f=c.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":Y,f||(u.as="script"),u.crossOrigin="",u.href=c,g&&u.setAttribute("nonce",g),document.head.appendChild(u),f)return new Promise((i,r)=>{u.addEventListener("load",i),u.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${c}`)))})}))}function p(d){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=d,window.dispatchEvent(g),!g.defaultPrevented)throw d}return l.then(d=>{for(const g of d||[])g.status==="rejected"&&p(g.reason);return a().catch(p)})};let N;{console.warn('Supabase environment variables not found. Please click "Connect to Supabase" in the top right to set up your database connection.');const e=()=>({select:()=>e(),insert:()=>e(),update:()=>e(),upsert:()=>e(),delete:()=>e(),eq:()=>e(),order:()=>e(),single:()=>Promise.resolve({data:null,error:{message:"Supabase not configured"}}),then:a=>a({data:[],error:null})});N={auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),getUser:()=>Promise.resolve({data:{user:null},error:null}),signUp:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signInWithPassword:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signOut:()=>Promise.resolve({error:null}),resetPasswordForEmail:()=>Promise.resolve({error:{message:"Password reset not available in demo mode"}}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},from:()=>e()}}const B=x.createContext(void 0),oe=({children:e})=>{const[a,s]=x.useState({lms:!1,admin:!1}),[n,l]=x.useState(null),[p,d]=x.useState(null);x.useEffect(()=>{N.auth.getSession().then(u=>{const i=u.data.session;if(i!=null&&i.user){d(i.user);const r=localStorage.getItem("huddle_lms_auth")==="true",o=localStorage.getItem("huddle_admin_auth")==="true",h=localStorage.getItem("huddle_user");if(s({lms:r,admin:o}),h)try{l(JSON.parse(h))}catch(y){console.error("Error parsing saved user data:",y),localStorage.removeItem("huddle_user")}}});const{data:m}=N.auth.onAuthStateChange(async(u,i)=>{i!=null&&i.user?d(i.user):(d(null),s({lms:!1,admin:!1}),l(null),localStorage.removeItem("huddle_lms_auth"),localStorage.removeItem("huddle_admin_auth"),localStorage.removeItem("huddle_user"))});return()=>m.subscription.unsubscribe()},[]);const g=async(m,u,i)=>{var r,o;try{const h={email:m,password:u};if(!""||!""){if(console.log("Running in demo mode - Supabase not configured"),![{email:"admin@thehuddleco.com",password:"admin123",type:"admin"},{email:"demo@thehuddleco.com",password:"demo123",type:"lms"},{email:"user@pacificcoast.edu",password:"user123",type:"lms"}].some(C=>C.email===m&&C.password===u&&C.type===i))return console.error("Invalid demo credentials:",{email:m,type:i}),{success:!1,error:"Invalid credentials. For demo mode, use: user@pacificcoast.edu / user123 for LMS or demo@thehuddleco.com / demo123",errorType:"invalid_credentials"};localStorage.setItem(`huddle_${i}_auth`,"true");const w={name:i==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:i==="admin"?"admin":"user",id:`demo-${i}-${Date.now()}`};return localStorage.setItem("huddle_user",JSON.stringify(w)),s(C=>({...C,[i]:!0})),l(w),console.log("Demo login successful for:",m),{success:!0}}console.log("Attempting Supabase authentication for:",m);const{data:v,error:_}=await N.auth.signInWithPassword(h);let S=v==null?void 0:v.user;if(_||!S){console.log("Initial sign-in failed, attempting sign-up for development:",_==null?void 0:_.message);const{error:j}=await N.auth.signUp(h);j&&console.warn("Sign-up attempt failed (may require confirmation):",j.message||j);const{data:I,error:w}=await N.auth.signInWithPassword(h);if(w||!(I!=null&&I.user))return console.error("Authentication error during sign-in retry:",w),(r=w==null?void 0:w.message)!=null&&r.includes("Invalid login credentials")?{success:!1,error:"Invalid email or password. Please check your credentials and try again.",errorType:"invalid_credentials"}:(o=w==null?void 0:w.message)!=null&&o.includes("Email not confirmed")?{success:!1,error:"Please check your email and click the confirmation link before signing in.",errorType:"invalid_credentials"}:{success:!1,error:`Authentication failed: ${(w==null?void 0:w.message)||"Unknown error"}`,errorType:"unknown_error"};S=I.user}S&&d(S),localStorage.setItem(`huddle_${i}_auth`,"true");const A={name:i==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:i==="admin"?"admin":"user",id:(S==null?void 0:S.id)||""};if(localStorage.setItem("huddle_user",JSON.stringify(A)),s(j=>({...j,[i]:!0})),l(A),S)try{await N.from("user_profiles").upsert({user_id:S.id,name:A.name,email:A.email,role:A.role})}catch(j){console.warn("Failed to update user profile:",j)}return console.log("Supabase login successful for:",m),{success:!0}}catch(h){return console.error("Login error:",h),h instanceof Error&&h.message.includes("fetch")?{success:!1,error:"Network error. Please check your internet connection and try again.",errorType:"network_error"}:{success:!1,error:`Login failed: ${h instanceof Error?h.message:"Unknown error"}`,errorType:"unknown_error"}}},c=async m=>{try{if(!""||!"")return console.log("Forgot password requested in demo mode for:",m),!1;const{error:r}=await N.auth.resetPasswordForEmail(m,{redirectTo:window.location.origin});return r?(console.error("Forgot password error:",r),!1):!0}catch(u){return console.error("Forgot password exception:",u),!1}},f=async m=>{try{await N.auth.signOut(),localStorage.removeItem(`huddle_${m}_auth`),localStorage.removeItem("huddle_user"),s(u=>({...u,[m]:!1})),l(null),d(null)}catch(u){console.error("Logout error:",u)}};return t.jsx(B.Provider,{value:{isAuthenticated:a,login:g,logout:f,forgotPassword:c,user:n,supabaseUser:p},children:e})},G=()=>{const e=x.useContext(B);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},T=e=>`huddle_org_workspace_${e}`,b=async e=>{const a=localStorage.getItem(T(e));if(a)return JSON.parse(a);const s={orgId:e,strategicPlans:[],sessionNotes:[],actionItems:[]};return localStorage.setItem(T(e),JSON.stringify(s)),s},P=async e=>{localStorage.setItem(T(e.orgId),JSON.stringify(e))},V=async(e,a,s="Huddle Co.")=>{const n=await b(e),l={id:`sp-${Date.now()}`,content:a,createdAt:new Date().toISOString(),createdBy:s};return n.strategicPlans.push(l),await P(n),l},k=async e=>(await b(e)).strategicPlans.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt)),X=async(e,a)=>{const s=await b(e);s.strategicPlans=s.strategicPlans.filter(n=>n.id!==a),await P(s)},Z=async(e,a)=>(await b(e)).strategicPlans.find(n=>n.id===a)||null,L=async(e,a,s="Huddle Co.")=>{const n=await b(e),l={id:`note-${Date.now()}`,createdBy:s,...a};return n.sessionNotes.push(l),await P(n),l},O=async e=>(await b(e)).sessionNotes.slice().sort((s,n)=>+new Date(n.date)-+new Date(s.date)),R=async(e,a)=>{const s=await b(e),n={id:`action-${Date.now()}`,...a};return s.actionItems.push(n),await P(s),n},F=async(e,a)=>{const s=await b(e);return s.actionItems=s.actionItems.map(n=>n.id===a.id?a:n),await P(s),a},E=async e=>(await b(e)).actionItems.slice().sort((s,n)=>{const l={"Not Started":0,"In Progress":1,Completed:2};return l[s.status]-l[n.status]}),ee={getWorkspace:b,saveWorkspace:P,addStrategicPlanVersion:V,listStrategicPlans:k,addSessionNote:L,listSessionNotes:O,addActionItem:R,listActionItems:E,updateActionItem:F},q=Object.freeze(Object.defineProperty({__proto__:null,addActionItem:R,addSessionNote:L,addStrategicPlanVersion:V,default:ee,deleteStrategicPlanVersion:X,getStrategicPlanVersion:Z,getWorkspace:b,listActionItems:E,listSessionNotes:O,listStrategicPlans:k,saveWorkspace:P,updateActionItem:F},Symbol.toStringTag,{value:"Module"})),H="huddle_notifications_v1",K=()=>{const e=localStorage.getItem(H);if(!e)return[];try{return JSON.parse(e)}catch{return[]}},z=e=>localStorage.setItem(H,JSON.stringify(e)),te=async e=>{let a=K();return e!=null&&e.orgId&&(a=a.filter(s=>s.orgId===e.orgId||!s.orgId)),e!=null&&e.userId&&(a=a.filter(s=>s.userId===e.userId||!s.userId)),a.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt))},se=async e=>{const a=K(),s={id:`note-${Date.now()}`,createdAt:new Date().toISOString(),...e};return a.push(s),z(a),s},ae=async()=>{z([])},re={listNotifications:te,addNotification:se,clearNotifications:ae},ce=()=>{const{orgId:e}=U(),{isAuthenticated:a}=G(),[s]=x.useState(`Organization ${e}`),[n,l]=x.useState(!1),[p,d]=x.useState([]);return x.useEffect(()=>{const g=e?localStorage.getItem(`huddle_org_${e}_member`)==="true":!1,c=a.admin;l(g||c),(async()=>{if(e){const m=await re.listNotifications({orgId:e});d(m.slice(0,5))}})()},[e]),t.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:"/logo192.png",alt:"The Huddle Co.",className:"h-12 w-12 rounded"}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-orange-600",children:[s," Workspace"]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Private workspace for your organization"})]})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx(D,{to:"/client-portal",className:"text-sm text-gray-700",children:"Back to Portal"})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[!n&&t.jsxs("div",{className:"md:col-span-4 bg-white rounded-lg p-8 border text-center",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Restricted"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You must be a member of this organization or a Huddle Co. admin to view this workspace."}),t.jsx("div",{className:"space-x-2",children:t.jsx("button",{onClick:()=>alert("Request access (mock)"),className:"px-4 py-2 bg-orange-500 text-white rounded",children:"Request Access"})})]}),t.jsx("nav",{className:"md:col-span-1 bg-white rounded-lg p-4 border",children:t.jsxs("ul",{className:"space-y-2",children:[t.jsx("li",{children:t.jsx(D,{to:"strategic-plans",className:"block p-2 rounded hover:bg-gray-50",children:"Strategic Plan Drafts"})}),t.jsx("li",{children:t.jsx(D,{to:"session-notes",className:"block p-2 rounded hover:bg-gray-50",children:"Session Notes & Follow-Ups"})}),t.jsx("li",{children:t.jsx(D,{to:"action-tracker",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Action Tracker"})}),t.jsx("li",{children:t.jsx(D,{to:"documents",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Documents"})})]})}),t.jsxs("div",{className:"md:col-span-3",children:[p.length>0&&t.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3",children:[t.jsx("h4",{className:"font-semibold",children:"Recent Workspace Notifications"}),t.jsx("ul",{className:"text-sm mt-2 space-y-1",children:p.map(g=>t.jsxs("li",{children:[g.title," — ",t.jsx("span",{className:"text-gray-600",children:new Date(g.createdAt).toLocaleString()})]},g.id))})]}),t.jsx(M,{})]})]})]})},ie=()=>{const{orgId:e}=U(),[a,s]=x.useState([]),[n,l]=x.useState("");x.useEffect(()=>{e&&k(e).then(s)},[e]);const p=async()=>{if(!e)return;await V(e,n,"Huddle Co.");const c=await k(e);s(c),l("")},d=async c=>{e&&(await(await J(async()=>{const{deleteStrategicPlanVersion:f}=await Promise.resolve().then(()=>q);return{deleteStrategicPlanVersion:f}},void 0)).deleteStrategicPlanVersion(e,c),s(await k(e)))},g=async c=>{if(!e)return;const{getStrategicPlanVersion:f,addStrategicPlanVersion:m}=await J(async()=>{const{getStrategicPlanVersion:i,addStrategicPlanVersion:r}=await Promise.resolve().then(()=>q);return{getStrategicPlanVersion:i,addStrategicPlanVersion:r}},void 0),u=await f(e,c);u&&(await m(e,u.content,"Restored Version"),s(await k(e)))};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Strategic Plan Drafts"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("textarea",{className:"w-full p-3 border rounded",rows:8,value:n,onChange:c=>l(c.target.value),placeholder:"Paste or write your strategic plan draft here (markdown supported)"}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:p,className:"bg-orange-500 text-white px-4 py-2 rounded",children:"Save Version"})})]}),t.jsxs("div",{className:"bg-white rounded shadow p-4",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Versions"}),a.length===0&&t.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}),t.jsx("ul",{className:"space-y-3",children:a.map(c=>t.jsxs("li",{className:"border p-3 rounded",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(c.createdAt).toLocaleString()," • ",c.createdBy]}),t.jsxs("div",{className:"space-x-2",children:[t.jsx("button",{onClick:()=>g(c.id),className:"text-sm text-blue-600",children:"Restore"}),t.jsx("button",{onClick:()=>d(c.id),className:"text-sm text-red-600",children:"Delete"})]})]}),t.jsx("div",{className:"mt-2 prose max-w-none",dangerouslySetInnerHTML:{__html:c.content}})]},c.id))})]})]})},le=()=>{const{orgId:e}=U(),[a,s]=x.useState([]),[n,l]=x.useState(""),[p,d]=x.useState(""),[g,c]=x.useState(new Date().toISOString().slice(0,10)),[f,m]=x.useState("");x.useEffect(()=>{e&&O(e).then(s)},[e]);const u=async()=>{if(!e)return;const o=[];await L(e,{title:n,body:p,date:g,tags:f.split(",").map(y=>y.trim()),attachments:o});const h=await O(e);s(h),l(""),d(""),m("")},i=o=>{if(!o)return;const h=new FileReader;h.onload=()=>{d(y=>y+`

[Attachment: ${o.name}]`)},h.readAsDataURL(o)},r=async o=>{console.log(`Notify client contacts about note ${o}`)};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Session Notes & Follow-Ups"}),t.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[t.jsx("input",{className:"w-full border p-2 mb-2 rounded",placeholder:"Title",value:n,onChange:o=>l(o.target.value)}),t.jsx("textarea",{className:"w-full border p-2 mb-2 rounded",rows:4,placeholder:"Notes",value:p,onChange:o=>d(o.target.value)}),t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"date",value:g,onChange:o=>c(o.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"tags (comma separated)",className:"flex-1 border p-2 rounded",value:f,onChange:o=>m(o.target.value)}),t.jsx("input",{type:"file",onChange:o=>{var h;return i((h=o.target.files)==null?void 0:h[0])},className:"border p-2 rounded"}),t.jsx("button",{onClick:u,className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Save Note"})]})]}),t.jsx("div",{className:"space-y-3",children:a.map(o=>t.jsxs("div",{className:"bg-white p-4 rounded border",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[o.date," • ",o.createdBy]}),t.jsx("div",{children:t.jsx("button",{onClick:()=>r(o.id),className:"text-sm text-blue-600 mr-3",children:"Notify"})})]}),t.jsx("div",{className:"font-semibold mt-1",children:o.title}),t.jsx("div",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:o.body}),t.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Tags: ",o.tags.join(", ")]})]},o.id))})]})},de=()=>{const{orgId:e}=U(),[a,s]=x.useState([]),[n,l]=x.useState(""),[p,d]=x.useState(""),[g,c]=x.useState("");x.useEffect(()=>{e&&E(e).then(s)},[e]);const f=async()=>{if(!e||!n)return;await R(e,{title:n,assignee:p,dueDate:g,status:"Not Started"});const r=await E(e);s(r),l(""),d(""),c("")},m=async r=>{console.log(`Notify about action ${r.id} -> assignee: ${r.assignee||"unassigned"}`),alert(`Notification sent to ${r.assignee||"client contacts"} (mock)`)},u=()=>{const o=[["Title","Assignee","Due Date","Status"]].concat(a.map(v=>[v.title,v.assignee||"",v.dueDate||"",v.status])).map(v=>v.map(_=>`"${String(_).replace(/"/g,'""')}"`).join(",")).join(`
`),h=new Blob([o],{type:"text/csv"}),y=URL.createObjectURL(h),$=document.createElement("a");$.href=y,$.download=`action-tracker-${e||"org"}.csv`,$.click(),URL.revokeObjectURL(y)},i=async r=>{const o=r.status==="Completed"?"Not Started":r.status==="Not Started"?"In Progress":"Completed",h={...r,status:o};await F(e,h),s(await E(e))};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shared Action Tracker"}),t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx("button",{onClick:u,className:"text-sm px-3 py-1 border rounded",children:"Export CSV"})}),t.jsxs("div",{className:"bg-white rounded p-4 mb-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("input",{placeholder:"Action title",className:"border p-2 rounded",value:n,onChange:r=>l(r.target.value)}),t.jsx("input",{placeholder:"Assignee",className:"border p-2 rounded",value:p,onChange:r=>d(r.target.value)}),t.jsx("input",{type:"date",className:"border p-2 rounded",value:g,onChange:r=>c(r.target.value)})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{className:"bg-orange-500 text-white px-4 py-2 rounded",onClick:f,children:"Add Action"})})]}),t.jsx("div",{className:"space-y-3",children:a.map(r=>t.jsxs("div",{className:"bg-white p-3 rounded border flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:r.title}),t.jsxs("div",{className:"text-sm text-gray-600",children:[r.assignee||"Unassigned"," • Due: ",r.dueDate||"—"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${r.status==="Completed"?"bg-green-100 text-green-800":r.status==="In Progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.status}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>i(r),children:"Toggle"}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>m(r),children:"Notify"})]})]},r.id))})]})};export{oe as A,ce as O,ie as S,le as a,de as b,ee as c,re as n,N as s,G as u};
