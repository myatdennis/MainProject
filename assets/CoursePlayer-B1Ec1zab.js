import{d as me,u as ue,r,j as e,a2 as Q,ap as he,bc as ge,bl as pe,bi as je,p as Ne,m as fe,n as be,t as ve,ao as we,c as ye,b3 as Ce,ak as ke,ab as Se,b4 as Pe,b5 as Me,b6 as Le,h as Te,b9 as Ie,aP as $e}from"./vendor-react-GSJsE769.js";import{c as j}from"./admin-courses-8eYVdzC7.js";import"./supabase-CqkleIqs.js";import"./vendor-BQbvXGuC.js";import"./vendor-react-dom-CAPOXzwn.js";const qe=()=>{const{courseId:a,lessonId:c}=me(),o=ue(),[i,b]=r.useState(null),[t,y]=r.useState(null),[m,C]=r.useState(null),[l,x]=r.useState(!0),n=r.useRef(null),[N,g]=r.useState(!1),[p,v]=r.useState(0),[u,P]=r.useState(0),[M,R]=r.useState(1),[L,B]=r.useState(!1),[F,E]=r.useState(1),[V,Fe]=r.useState(!0),[D,_]=r.useState(!1),[z,G]=r.useState(!1),[U,q]=r.useState(!1),[H,O]=r.useState(!1),[k,X]=r.useState(!1),[J,K]=r.useState(!1),[T,A]=r.useState(""),[W,Y]=r.useState([]),[Z,ee]=r.useState([]);r.useEffect(()=>{if(a){const s=j.getCourse(a);if(s){b(s);const d=j.getLearnerProgress("user-123",a);if(C(d),c){const h=se(s,c);y(h)}else{const h=te(s);h&&(y(h),o(`/lms/course/${a}/lesson/${h.id}`,{replace:!0}))}I()}x(!1)}},[a,c,o]);const se=(s,d)=>{for(const h of s.chapters||[]){const f=h.lessons.find(w=>w.id===d);if(f)return f}return null},te=s=>{var d;return((d=(s.chapters||[])[0])==null?void 0:d.lessons[0])||null},I=()=>{if(!a)return;const s=j.getUserNotes("user-123",a),d=j.getUserBookmarks("user-123",a);Y(s),ee(d)},ae=()=>{n.current&&(N?n.current.pause():n.current.play(),g(!N))},ne=()=>{if(n.current&&(v(n.current.currentTime),t&&a)){const s=n.current.currentTime/n.current.duration*100;j.updateLessonProgress("user-123",a,t.id,{progress:s})}},S=s=>{n.current&&(n.current.currentTime=s,v(s))},re=s=>{n.current&&(n.current.volume=s,R(s),B(s===0))},oe=()=>{n.current&&(n.current.muted=!L,B(!L))},le=s=>{n.current&&(n.current.playbackRate=s,E(s))},ie=s=>{if(n.current){const d=Math.max(0,Math.min(u,p+s));S(d)}},$=s=>{if(!i||!t)return;const d=(i.chapters||[]).flatMap(w=>w.lessons),h=d.findIndex(w=>w.id===t.id);let f;if(s==="next"?f=h+1:f=h-1,f>=0&&f<d.length){const w=d[f];o(`/lms/course/${a}/lesson/${w.id}`)}},ce=()=>{if(t&&a){j.markLessonComplete("user-123",a,t.id);const s=j.getLearnerProgress("user-123",a);C(s),$("next")}},de=()=>{if(t&&a){const s=Math.floor(p);j.addBookmark("user-123",a,{lessonId:t.id,position:s,note:"Video bookmark"}),I()}},xe=()=>{if(T.trim()&&t&&a){const s=Math.floor(p);j.addNote("user-123",a,{lessonId:t.id,content:T,position:s}),A(""),I()}};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):!i||!t?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Course not found"}),e.jsx("button",{onClick:()=>o("/lms/courses"),className:"text-orange-600 hover:text-orange-800",children:"Return to courses"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white flex",children:[e.jsxs("div",{className:`${k?"w-16":"w-80"} bg-gray-800 transition-all duration-300 flex flex-col`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>o("/lms/courses"),className:"flex items-center text-gray-300 hover:text-white",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),!k&&"Back to Courses"]}),e.jsx("button",{onClick:()=>X(!k),className:"text-gray-300 hover:text-white",children:k?e.jsx(he,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]}),!k&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h1",{className:"font-semibold text-white",children:i.title}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-300 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[Math.round(((m==null?void 0:m.overallProgress)||0)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:`${((m==null?void 0:m.overallProgress)||0)*100}%`}})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Be,{course:i,currentLesson:t,progress:m,collapsed:k,onLessonSelect:s=>o(`/lms/course/${a}/lesson/${s.id}`)})})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[t.type==="video"&&e.jsxs("div",{className:"relative bg-black",children:[e.jsx("video",{ref:n,src:t.content.videoUrl,className:"w-full h-auto max-h-96",onTimeUpdate:ne,onLoadedMetadata:()=>{var s;return P(((s=n.current)==null?void 0:s.duration)||0)},onPlay:()=>g(!0),onPause:()=>g(!1)}),e.jsx(ze,{isPlaying:N,currentTime:p,duration:u,volume:M,isMuted:L,playbackSpeed:F,showControls:V,onPlayPause:ae,onSeek:S,onVolumeChange:re,onToggleMute:oe,onSpeedChange:le,onSkip:ie,onFullscreen:()=>_(!D),onSettings:()=>O(!H)})]}),e.jsx("div",{className:"flex-1 bg-white text-gray-900",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:de,className:"p-2 text-gray-600 hover:text-orange-600",title:"Add bookmark",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>q(!U),className:"p-2 text-gray-600 hover:text-orange-600",title:"Toggle notes",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>G(!z),className:"p-2 text-gray-600 hover:text-orange-600",title:"Toggle transcript",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(Ue,{lesson:t,onComplete:ce,showQuizModal:J,onShowQuizModal:K}),z&&t.content.transcript&&e.jsx(Ae,{transcript:t.content.transcript,currentTime:p,onSeek:S})]}),e.jsxs("div",{className:"space-y-6",children:[U&&e.jsx(Qe,{notes:W.filter(s=>s.lessonId===t.id),bookmarks:Z.filter(s=>s.lessonId===t.id),noteText:T,onNoteTextChange:A,onAddNote:xe,onSeek:S}),e.jsx(Re,{onPrevious:()=>$("prev"),onNext:()=>$("next"),canGoPrevious:!0,canGoNext:!0})]})]})]})})]})]})},Be=({course:a,currentLesson:c,progress:o,collapsed:i,onLessonSelect:b})=>{const[t,y]=r.useState(new Set),m=l=>{const x=new Set(t);x.has(l)?x.delete(l):x.add(l),y(x)},C=l=>o==null?void 0:o.lessonProgress.find(x=>x.lessonId===l);return i?e.jsx("div",{className:"p-2",children:(a.chapters||[]).map(l=>e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"w-3 h-3 bg-gray-600 rounded-full mx-auto"})},l.id))}):e.jsx("div",{className:"p-4 space-y-2",children:(a.chapters||[]).map((l,x)=>e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>m(l.id),className:"w-full flex items-center justify-between p-2 text-left text-gray-300 hover:text-white hover:bg-gray-700 rounded",children:[e.jsxs("span",{className:"font-medium",children:[x+1,". ",l.title]}),t.has(l.id)?e.jsx(fe,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})]}),t.has(l.id)&&e.jsx("div",{className:"ml-4 mt-2 space-y-1",children:l.lessons.map((n,N)=>{const g=C(n.id),p=(g==null?void 0:g.isCompleted)||!1,v=n.id===c.id;return e.jsxs("button",{onClick:()=>b(n),className:`w-full flex items-center p-2 text-left text-sm rounded transition-colors ${v?"bg-orange-600 text-white":"text-gray-400 hover:text-gray-200 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"mr-3",children:p?e.jsx(ve,{className:"w-4 h-4 text-green-400"}):e.jsx(we,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[N+1,". ",n.title]}),e.jsxs("div",{className:"flex items-center text-xs opacity-75",children:[e.jsx(ye,{className:"w-3 h-3 mr-1"}),n.estimatedDuration," min"]})]})]},n.id)})})]},l.id))})},ze=({isPlaying:a,currentTime:c,duration:o,volume:i,isMuted:b,playbackSpeed:t,showControls:y,onPlayPause:m,onSeek:C,onVolumeChange:l,onToggleMute:x,onSpeedChange:n,onSkip:N,onFullscreen:g,onSettings:p})=>{const v=u=>{const P=Math.floor(u/60),M=Math.floor(u%60);return`${P}:${M.toString().padStart(2,"0")}`};return y?e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"range",min:"0",max:o,value:c,onChange:u=>C(Number(u.target.value)),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>N(-10),className:"text-white hover:text-orange-400",children:e.jsx(Ce,{className:"w-5 h-5"})}),e.jsx("button",{onClick:m,className:"text-white hover:text-orange-400",children:a?e.jsx(ke,{className:"w-6 h-6"}):e.jsx(Se,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>N(10),className:"text-white hover:text-orange-400",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:x,className:"text-white hover:text-orange-400",children:b?e.jsx(Me,{className:"w-5 h-5"}):e.jsx(Le,{className:"w-5 h-5"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:i,onChange:u=>l(Number(u.target.value)),className:"w-16 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})]}),e.jsxs("div",{className:"text-white text-sm",children:[v(c)," / ",v(o)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:t,onChange:u=>n(Number(u.target.value)),className:"bg-transparent text-white text-sm",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:.75,children:"0.75x"}),e.jsx("option",{value:1,children:"1x"}),e.jsx("option",{value:1.25,children:"1.25x"}),e.jsx("option",{value:1.5,children:"1.5x"}),e.jsx("option",{value:2,children:"2x"})]}),e.jsx("button",{onClick:p,className:"text-white hover:text-orange-400",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("button",{onClick:g,className:"text-white hover:text-orange-400",children:e.jsx(Ie,{className:"w-5 h-5"})})]})]})]}):null},Ue=({lesson:a,onComplete:c,showQuizModal:o,onShowQuizModal:i})=>a.type==="text"?e.jsxs("div",{className:"prose max-w-none",children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:a.content.textContent||""}}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsx("button",{onClick:c,className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:"Mark as Complete"})})]}):a.type==="quiz"?e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Quiz: ",a.title]}),e.jsx("p",{className:"text-gray-600 mb-6",children:a.description}),e.jsx("button",{onClick:()=>i(!0),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors",children:"Start Quiz"})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Interactive content will be displayed here."})}),Ae=({transcript:a})=>e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Transcript"}),e.jsx("div",{className:"prose text-sm",children:a})]}),Qe=({notes:a,bookmarks:c,noteText:o,onNoteTextChange:i,onAddNote:b})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Notes & Bookmarks"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsx("textarea",{value:o,onChange:t=>i(t.target.value),placeholder:"Add a note...",className:"w-full p-2 border border-gray-300 rounded resize-none",rows:3}),e.jsx("button",{onClick:b,className:"bg-orange-600 text-white px-4 py-1 rounded text-sm hover:bg-orange-700",children:"Add Note"})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[c.map(t=>e.jsxs("div",{className:"p-2 bg-white rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Bookmark"}),e.jsxs("span",{className:"text-gray-500",children:[Math.floor(t.position/60),":",(t.position%60).toString().padStart(2,"0")]})]}),e.jsx("p",{className:"text-gray-600",children:t.note||"No note"})]},t.id)),a.map(t=>e.jsxs("div",{className:"p-2 bg-white rounded border text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:"Note"}),e.jsx("span",{className:"text-gray-500",children:t.position?`${Math.floor(t.position/60)}:${(t.position%60).toString().padStart(2,"0")}`:""})]}),e.jsx("p",{className:"text-gray-700",children:t.content})]},t.id))]})]}),Re=({onPrevious:a,onNext:c,canGoPrevious:o,canGoNext:i})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Navigation"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:a,disabled:!o,className:"flex-1 flex items-center justify-center px-4 py-2 border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Previous"]}),e.jsxs("button",{onClick:c,disabled:!i,className:"flex-1 flex items-center justify-center px-4 py-2 bg-orange-600 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700",children:["Next",e.jsx($e,{className:"w-4 h-4 ml-2"})]})]})]});export{qe as default};
