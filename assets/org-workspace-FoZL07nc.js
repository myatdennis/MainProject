import{r as x,j as t,u as T,L as O,O as M}from"./vendor-react-WmctGFNS.js";const Y="modulepreload",Q=function(e){return"/"+e},V={},S=function(a,s,n){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));l=Promise.allSettled(s.map(i=>{if(i=Q(i),i in V)return;V[i]=!0;const f=i.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":Y,f||(u.as="script"),u.crossOrigin="",u.href=i,h&&u.setAttribute("nonce",h),document.head.appendChild(u),f)return new Promise((c,r)=>{u.addEventListener("load",c),u.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${i}`)))})}))}function p(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return l.then(d=>{for(const h of d||[])h.status==="rejected"&&p(h.reason);return a().catch(p)})};let _;{console.warn('Supabase environment variables not found. Please click "Connect to Supabase" in the top right to set up your database connection.');const e=()=>({select:()=>e(),insert:()=>e(),update:()=>e(),upsert:()=>e(),delete:()=>e(),eq:()=>e(),order:()=>e(),single:()=>Promise.resolve({data:null,error:{message:"Supabase not configured"}}),then:a=>a({data:[],error:null})});_={auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),getUser:()=>Promise.resolve({data:{user:null},error:null}),signUp:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signInWithPassword:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signOut:()=>Promise.resolve({error:null}),resetPasswordForEmail:()=>Promise.resolve({error:{message:"Password reset not available in demo mode"}}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},from:()=>e()}}const R=x.createContext(void 0),ne=({children:e})=>{const[a,s]=x.useState({lms:!1,admin:!1}),[n,l]=x.useState(null),[p,d]=x.useState(null);x.useEffect(()=>{_.auth.getSession().then(u=>{const c=u.data.session;if(c!=null&&c.user){d(c.user);const r=localStorage.getItem("huddle_lms_auth")==="true",o=localStorage.getItem("huddle_admin_auth")==="true",g=localStorage.getItem("huddle_user");if(s({lms:r,admin:o}),g)try{l(JSON.parse(g))}catch(v){console.error("Error parsing saved user data:",v),localStorage.removeItem("huddle_user")}}});const{data:m}=_.auth.onAuthStateChange(async(u,c)=>{c!=null&&c.user?d(c.user):(d(null),s({lms:!1,admin:!1}),l(null),localStorage.removeItem("huddle_lms_auth"),localStorage.removeItem("huddle_admin_auth"),localStorage.removeItem("huddle_user"))});return()=>m.subscription.unsubscribe()},[]);const h=async(m,u,c)=>{var r,o;try{const g={email:m,password:u};if(!""||!""){if(console.log("Running in demo mode - Supabase not configured"),![{email:"admin@thehuddleco.com",password:"admin123",type:"admin"},{email:"demo@thehuddleco.com",password:"demo123",type:"lms"},{email:"user@pacificcoast.edu",password:"user123",type:"lms"}].some(E=>E.email===m&&E.password===u&&E.type===c))return console.error("Invalid demo credentials:",{email:m,type:c}),{success:!1,error:"Invalid credentials. For demo mode, use: user@pacificcoast.edu / user123 for LMS or demo@thehuddleco.com / demo123",errorType:"invalid_credentials"};localStorage.setItem(`huddle_${c}_auth`,"true");const w={name:c==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:c==="admin"?"admin":"user",id:`demo-${c}-${Date.now()}`};return localStorage.setItem("huddle_user",JSON.stringify(w)),s(E=>({...E,[c]:!0})),l(w),console.log("Demo login successful for:",m),{success:!0}}console.log("Attempting Supabase authentication for:",m);const{data:y,error:k}=await _.auth.signInWithPassword(g);let j=y==null?void 0:y.user;if(k||!j){console.log("Initial sign-in failed, attempting sign-up for development:",k==null?void 0:k.message);const{error:P}=await _.auth.signUp(g);P&&console.warn("Sign-up attempt failed (may require confirmation):",P.message||P);const{data:D,error:w}=await _.auth.signInWithPassword(g);if(w||!(D!=null&&D.user))return console.error("Authentication error during sign-in retry:",w),(r=w==null?void 0:w.message)!=null&&r.includes("Invalid login credentials")?{success:!1,error:"Invalid email or password. Please check your credentials and try again.",errorType:"invalid_credentials"}:(o=w==null?void 0:w.message)!=null&&o.includes("Email not confirmed")?{success:!1,error:"Please check your email and click the confirmation link before signing in.",errorType:"invalid_credentials"}:{success:!1,error:`Authentication failed: ${(w==null?void 0:w.message)||"Unknown error"}`,errorType:"unknown_error"};j=D.user}j&&d(j),localStorage.setItem(`huddle_${c}_auth`,"true");const C={name:c==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:c==="admin"?"admin":"user",id:(j==null?void 0:j.id)||""};if(localStorage.setItem("huddle_user",JSON.stringify(C)),s(P=>({...P,[c]:!0})),l(C),j)try{await _.from("user_profiles").upsert({user_id:j.id,name:C.name,email:C.email,role:C.role})}catch(P){console.warn("Failed to update user profile:",P)}return console.log("Supabase login successful for:",m),{success:!0}}catch(g){return console.error("Login error:",g),g instanceof Error&&g.message.includes("fetch")?{success:!1,error:"Network error. Please check your internet connection and try again.",errorType:"network_error"}:{success:!1,error:`Login failed: ${g instanceof Error?g.message:"Unknown error"}`,errorType:"unknown_error"}}},i=async m=>{try{if(!""||!"")return console.log("Forgot password requested in demo mode for:",m),!1;const{error:r}=await _.auth.resetPasswordForEmail(m,{redirectTo:window.location.origin});return r?(console.error("Forgot password error:",r),!1):!0}catch(u){return console.error("Forgot password exception:",u),!1}},f=async m=>{try{await _.auth.signOut(),localStorage.removeItem(`huddle_${m}_auth`),localStorage.removeItem("huddle_user"),s(u=>({...u,[m]:!1})),l(null),d(null)}catch(u){console.error("Logout error:",u)}};return t.jsx(R.Provider,{value:{isAuthenticated:a,login:h,logout:f,forgotPassword:i,user:n,supabaseUser:p},children:e})},G=()=>{const e=x.useContext(R);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},$="huddle_notifications_v1",U=()=>{const e=localStorage.getItem($);if(!e)return[];try{return JSON.parse(e)}catch{return[]}},F=e=>localStorage.setItem($,JSON.stringify(e)),X=async e=>{let a=U();return e!=null&&e.orgId&&(a=a.filter(s=>s.orgId===e.orgId||!s.orgId)),e!=null&&e.userId&&(a=a.filter(s=>s.userId===e.userId||!s.userId)),a.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt))},Z=async e=>{const a=U(),s={id:`note-${Date.now()}`,createdAt:new Date().toISOString(),...e};return a.push(s),F(a),s},ee=async()=>{F([])},te={listNotifications:X,addNotification:Z,clearNotifications:ee},ie=()=>{const{orgId:e}=T(),{isAuthenticated:a}=G(),[s]=x.useState(`Organization ${e}`),[n,l]=x.useState(!1),[p,d]=x.useState([]);return x.useEffect(()=>{const h=e?localStorage.getItem(`huddle_org_${e}_member`)==="true":!1,i=a.admin;l(h||i),(async()=>{if(e){const m=await te.listNotifications({orgId:e});d(m.slice(0,5))}})()},[e]),t.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:"/logo192.png",alt:"The Huddle Co.",className:"h-12 w-12 rounded"}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-orange-600",children:[s," Workspace"]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Private workspace for your organization"})]})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx(O,{to:"/client-portal",className:"text-sm text-gray-700",children:"Back to Portal"})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[!n&&t.jsxs("div",{className:"md:col-span-4 bg-white rounded-lg p-8 border text-center",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Restricted"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You must be a member of this organization or a Huddle Co. admin to view this workspace."}),t.jsx("div",{className:"space-x-2",children:t.jsx("button",{onClick:()=>alert("Request access (mock)"),className:"px-4 py-2 bg-orange-500 text-white rounded",children:"Request Access"})})]}),t.jsx("nav",{className:"md:col-span-1 bg-white rounded-lg p-4 border",children:t.jsxs("ul",{className:"space-y-2",children:[t.jsx("li",{children:t.jsx(O,{to:"strategic-plans",className:"block p-2 rounded hover:bg-gray-50",children:"Strategic Plan Drafts"})}),t.jsx("li",{children:t.jsx(O,{to:"session-notes",className:"block p-2 rounded hover:bg-gray-50",children:"Session Notes & Follow-Ups"})}),t.jsx("li",{children:t.jsx(O,{to:"action-tracker",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Action Tracker"})}),t.jsx("li",{children:t.jsx(O,{to:"documents",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Documents"})})]})}),t.jsxs("div",{className:"md:col-span-3",children:[p.length>0&&t.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3",children:[t.jsx("h4",{className:"font-semibold",children:"Recent Workspace Notifications"}),t.jsx("ul",{className:"text-sm mt-2 space-y-1",children:p.map(h=>t.jsxs("li",{children:[h.title," â€” ",t.jsx("span",{className:"text-gray-600",children:new Date(h.createdAt).toLocaleString()})]},h.id))})]}),t.jsx(M,{})]})]})]})},ce=()=>{const{orgId:e}=T(),[a,s]=x.useState([]),[n,l]=x.useState("");x.useEffect(()=>{e&&(async()=>{const f=await(await S(()=>Promise.resolve().then(()=>N),void 0)).listStrategicPlans(e);s(f)})()},[e]);const p=async()=>{if(!e)return;const i=await S(()=>Promise.resolve().then(()=>N),void 0);await i.addStrategicPlanVersion(e,n,"Huddle Co.");const f=await i.listStrategicPlans(e);s(f),l("")},d=async i=>{if(!e)return;const f=await S(()=>Promise.resolve().then(()=>N),void 0);await f.deleteStrategicPlanVersion(e,i),s(await f.listStrategicPlans(e))},h=async i=>{if(!e)return;const{getStrategicPlanVersion:f,addStrategicPlanVersion:m}=await S(async()=>{const{getStrategicPlanVersion:c,addStrategicPlanVersion:r}=await Promise.resolve().then(()=>N);return{getStrategicPlanVersion:c,addStrategicPlanVersion:r}},void 0),u=await f(e,i);if(u){await m(e,u.content,"Restored Version");const c=await S(()=>Promise.resolve().then(()=>N),void 0);s(await c.listStrategicPlans(e))}};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Strategic Plan Drafts"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("textarea",{className:"w-full p-3 border rounded",rows:8,value:n,onChange:i=>l(i.target.value),placeholder:"Paste or write your strategic plan draft here (markdown supported)"}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:p,className:"bg-orange-500 text-white px-4 py-2 rounded",children:"Save Version"})})]}),t.jsxs("div",{className:"bg-white rounded shadow p-4",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Versions"}),a.length===0&&t.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}),t.jsx("ul",{className:"space-y-3",children:a.map(i=>t.jsxs("li",{className:"border p-3 rounded",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(i.createdAt).toLocaleString()," â€¢ ",i.createdBy]}),t.jsxs("div",{className:"space-x-2",children:[t.jsx("button",{onClick:()=>h(i.id),className:"text-sm text-blue-600",children:"Restore"}),t.jsx("button",{onClick:()=>d(i.id),className:"text-sm text-red-600",children:"Delete"})]})]}),t.jsx("div",{className:"mt-2 prose max-w-none",dangerouslySetInnerHTML:{__html:i.content}})]},i.id))})]})]})},le=()=>{const{orgId:e}=T(),[a,s]=x.useState([]),[n,l]=x.useState(""),[p,d]=x.useState(""),[h,i]=x.useState(new Date().toISOString().slice(0,10)),[f,m]=x.useState("");x.useEffect(()=>{e&&(async()=>{const g=await(await S(()=>Promise.resolve().then(()=>N),void 0)).listSessionNotes(e);s(g)})()},[e]);const u=async()=>{if(!e)return;const o=[],g=await S(()=>Promise.resolve().then(()=>N),void 0);await g.addSessionNote(e,{title:n,body:p,date:h,tags:f.split(",").map(I=>I.trim()),attachments:o});const v=await g.listSessionNotes(e);s(v),l(""),d(""),m("")},c=o=>{if(!o)return;const g=new FileReader;g.onload=()=>{d(v=>v+`

[Attachment: ${o.name}]`)},g.readAsDataURL(o)},r=async o=>{console.log(`Notify client contacts about note ${o}`)};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Session Notes & Follow-Ups"}),t.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[t.jsx("input",{className:"w-full border p-2 mb-2 rounded",placeholder:"Title",value:n,onChange:o=>l(o.target.value)}),t.jsx("textarea",{className:"w-full border p-2 mb-2 rounded",rows:4,placeholder:"Notes",value:p,onChange:o=>d(o.target.value)}),t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"date",value:h,onChange:o=>i(o.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"tags (comma separated)",className:"flex-1 border p-2 rounded",value:f,onChange:o=>m(o.target.value)}),t.jsx("input",{type:"file",onChange:o=>{var g;return c((g=o.target.files)==null?void 0:g[0])},className:"border p-2 rounded"}),t.jsx("button",{onClick:u,className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Save Note"})]})]}),t.jsx("div",{className:"space-y-3",children:a.map(o=>t.jsxs("div",{className:"bg-white p-4 rounded border",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[o.date," â€¢ ",o.createdBy]}),t.jsx("div",{children:t.jsx("button",{onClick:()=>r(o.id),className:"text-sm text-blue-600 mr-3",children:"Notify"})})]}),t.jsx("div",{className:"font-semibold mt-1",children:o.title}),t.jsx("div",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:o.body}),t.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Tags: ",o.tags.join(", ")]})]},o.id))})]})},de=()=>{const{orgId:e}=T(),[a,s]=x.useState([]),[n,l]=x.useState(""),[p,d]=x.useState(""),[h,i]=x.useState("");x.useEffect(()=>{e&&(async()=>{const o=await(await S(()=>Promise.resolve().then(()=>N),void 0)).listActionItems(e);s(o)})()},[e]);const f=async()=>{if(!e||!n)return;const r=await S(()=>Promise.resolve().then(()=>N),void 0);await r.addActionItem(e,{title:n,assignee:p,dueDate:h,status:"Not Started"});const o=await r.listActionItems(e);s(o),l(""),d(""),i("")},m=async r=>{console.log(`Notify about action ${r.id} -> assignee: ${r.assignee||"unassigned"}`),alert(`Notification sent to ${r.assignee||"client contacts"} (mock)`)},u=()=>{const o=[["Title","Assignee","Due Date","Status"]].concat(a.map(y=>[y.title,y.assignee||"",y.dueDate||"",y.status])).map(y=>y.map(k=>`"${String(k).replace(/"/g,'""')}"`).join(",")).join(`
`),g=new Blob([o],{type:"text/csv"}),v=URL.createObjectURL(g),I=document.createElement("a");I.href=v,I.download=`action-tracker-${e||"org"}.csv`,I.click(),URL.revokeObjectURL(v)},c=async r=>{const o=r.status==="Completed"?"Not Started":r.status==="Not Started"?"In Progress":"Completed",g={...r,status:o},v=await S(()=>Promise.resolve().then(()=>N),void 0);await v.updateActionItem(e,g),s(await v.listActionItems(e))};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shared Action Tracker"}),t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx("button",{onClick:u,className:"text-sm px-3 py-1 border rounded",children:"Export CSV"})}),t.jsxs("div",{className:"bg-white rounded p-4 mb-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("input",{placeholder:"Action title",className:"border p-2 rounded",value:n,onChange:r=>l(r.target.value)}),t.jsx("input",{placeholder:"Assignee",className:"border p-2 rounded",value:p,onChange:r=>d(r.target.value)}),t.jsx("input",{type:"date",className:"border p-2 rounded",value:h,onChange:r=>i(r.target.value)})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{className:"bg-orange-500 text-white px-4 py-2 rounded",onClick:f,children:"Add Action"})})]}),t.jsx("div",{className:"space-y-3",children:a.map(r=>t.jsxs("div",{className:"bg-white p-3 rounded border flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:r.title}),t.jsxs("div",{className:"text-sm text-gray-600",children:[r.assignee||"Unassigned"," â€¢ Due: ",r.dueDate||"â€”"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${r.status==="Completed"?"bg-green-100 text-green-800":r.status==="In Progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.status}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>c(r),children:"Toggle"}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>m(r),children:"Notify"})]})]},r.id))})]})},L=e=>`huddle_org_workspace_${e}`,b=async e=>{const a=localStorage.getItem(L(e));if(a)return JSON.parse(a);const s={orgId:e,strategicPlans:[],sessionNotes:[],actionItems:[]};return localStorage.setItem(L(e),JSON.stringify(s)),s},A=async e=>{localStorage.setItem(L(e.orgId),JSON.stringify(e))},W=async(e,a,s="Huddle Co.")=>{const n=await b(e),l={id:`sp-${Date.now()}`,content:a,createdAt:new Date().toISOString(),createdBy:s};return n.strategicPlans.push(l),await A(n),l},J=async e=>(await b(e)).strategicPlans.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt)),se=async(e,a)=>{const s=await b(e);s.strategicPlans=s.strategicPlans.filter(n=>n.id!==a),await A(s)},ae=async(e,a)=>(await b(e)).strategicPlans.find(n=>n.id===a)||null,q=async(e,a,s="Huddle Co.")=>{const n=await b(e),l={id:`note-${Date.now()}`,createdBy:s,...a};return n.sessionNotes.push(l),await A(n),l},B=async e=>(await b(e)).sessionNotes.slice().sort((s,n)=>+new Date(n.date)-+new Date(s.date)),H=async(e,a)=>{const s=await b(e),n={id:`action-${Date.now()}`,...a};return s.actionItems.push(n),await A(s),n},K=async(e,a)=>{const s=await b(e);return s.actionItems=s.actionItems.map(n=>n.id===a.id?a:n),await A(s),a},z=async e=>(await b(e)).actionItems.slice().sort((s,n)=>{const l={"Not Started":0,"In Progress":1,Completed:2};return l[s.status]-l[n.status]}),re={getWorkspace:b,saveWorkspace:A,addStrategicPlanVersion:W,listStrategicPlans:J,addSessionNote:q,listSessionNotes:B,addActionItem:H,listActionItems:z,updateActionItem:K},N=Object.freeze(Object.defineProperty({__proto__:null,addActionItem:H,addSessionNote:q,addStrategicPlanVersion:W,default:re,deleteStrategicPlanVersion:se,getStrategicPlanVersion:ae,getWorkspace:b,listActionItems:z,listSessionNotes:B,listStrategicPlans:J,saveWorkspace:A,updateActionItem:K},Symbol.toStringTag,{value:"Module"}));export{ne as A,ie as O,ce as S,S as _,le as a,de as b,N as c,te as n,_ as s,G as u};
