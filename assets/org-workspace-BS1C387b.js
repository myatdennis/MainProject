import{r as h,j as s,u as D,L as E,O as H}from"./vendor-react-M1H5pfoT.js";const K="modulepreload",z=function(e){return"/"+e},T={},y=function(r,t,n){let l=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=g?.nonce||g?.getAttribute("nonce");l=Promise.allSettled(t.map(i=>{if(i=z(i),i in T)return;T[i]=!0;const p=i.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${u}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":K,p||(d.as="script"),d.crossOrigin="",d.href=i,m&&d.setAttribute("nonce",m),document.head.appendChild(d),p)return new Promise((c,a)=>{d.addEventListener("load",c),d.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${i}`)))})}))}function x(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return l.then(g=>{for(const m of g||[])m.status==="rejected"&&x(m.reason);return r().catch(x)})};let S;{console.warn('Supabase environment variables not found. Please click "Connect to Supabase" in the top right to set up your database connection.');const e=()=>({select:()=>e(),insert:()=>e(),update:()=>e(),upsert:()=>e(),delete:()=>e(),eq:()=>e(),order:()=>e(),single:()=>Promise.resolve({data:null,error:{message:"Supabase not configured"}}),then:r=>r({data:[],error:null})});S={auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),getUser:()=>Promise.resolve({data:{user:null},error:null}),signUp:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signInWithPassword:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signOut:()=>Promise.resolve({error:null}),resetPasswordForEmail:()=>Promise.resolve({error:{message:"Password reset not available in demo mode"}}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},from:()=>e()}}const L=h.createContext(void 0),re=({children:e})=>{const[r,t]=h.useState({lms:!1,admin:!1}),[n,l]=h.useState(null),[x,g]=h.useState(null);h.useEffect(()=>{S.auth.getSession().then(d=>{const c=d.data.session;if(c?.user){g(c.user);const a=localStorage.getItem("huddle_lms_auth")==="true",o=localStorage.getItem("huddle_admin_auth")==="true",f=localStorage.getItem("huddle_user");if(t({lms:a,admin:o}),f)try{l(JSON.parse(f))}catch(v){console.error("Error parsing saved user data:",v),localStorage.removeItem("huddle_user")}}});const{data:u}=S.auth.onAuthStateChange(async(d,c)=>{console.log("AuthContext auth state change, has session:",!!c),c?.user?g(c.user):(g(null),t({lms:!1,admin:!1}),l(null),localStorage.removeItem("huddle_lms_auth"),localStorage.removeItem("huddle_admin_auth"),localStorage.removeItem("huddle_user"))});return()=>u.subscription.unsubscribe()},[]);const m=async(u,d,c)=>{try{const a={email:u,password:d};if(!""||!""){if(console.log("Running in demo mode - Supabase not configured"),![{email:"admin@thehuddleco.com",password:"admin123",type:"admin"},{email:"demo@thehuddleco.com",password:"demo123",type:"lms"},{email:"user@pacificcoast.edu",password:"user123",type:"lms"}].some(k=>k.email===u&&k.password===d&&k.type===c))return console.error("Invalid demo credentials:",{email:u,type:c}),{success:!1,error:"Invalid credentials. For demo mode, use: user@pacificcoast.edu / user123 for LMS or demo@thehuddleco.com / demo123",errorType:"invalid_credentials"};localStorage.setItem(`huddle_${c}_auth`,"true");const P={name:c==="admin"?"Mya Dennis":"Sarah Chen",email:u,role:c==="admin"?"admin":"user",id:`demo-${c}-${Date.now()}`};return localStorage.setItem("huddle_user",JSON.stringify(P)),t(k=>({...k,[c]:!0})),l(P),console.log("Demo login successful for:",u),{success:!0}}console.log("Attempting Supabase authentication for:",u);const{data:v,error:j}=await S.auth.signInWithPassword(a);let w=v?.user;if(j||!w){console.log("Initial sign-in failed, attempting sign-up for development:",j?.message);const{error:_}=await S.auth.signUp(a);_&&console.warn("Sign-up attempt failed (may require confirmation):",_.message||_);const{data:C,error:P}=await S.auth.signInWithPassword(a);if(P||!C?.user)return console.error("Authentication error during sign-in retry:",P),P?.message?.includes("Invalid login credentials")?{success:!1,error:"Invalid email or password. Please check your credentials and try again.",errorType:"invalid_credentials"}:P?.message?.includes("Email not confirmed")?{success:!1,error:"Please check your email and click the confirmation link before signing in.",errorType:"invalid_credentials"}:{success:!1,error:`Authentication failed: ${P?.message||"Unknown error"}`,errorType:"unknown_error"};w=C.user}w&&g(w),localStorage.setItem(`huddle_${c}_auth`,"true");const I={name:c==="admin"?"Mya Dennis":"Sarah Chen",email:u,role:c==="admin"?"admin":"user",id:w?.id||""};if(localStorage.setItem("huddle_user",JSON.stringify(I)),t(_=>({..._,[c]:!0})),l(I),w)try{await S.from("user_profiles").upsert({user_id:w.id,name:I.name,email:I.email,role:I.role})}catch(_){console.warn("Failed to update user profile:",_)}return console.log("Supabase login successful for:",u),{success:!0}}catch(a){return console.error("Login error:",a),a instanceof Error&&a.message.includes("fetch")?{success:!1,error:"Network error. Please check your internet connection and try again.",errorType:"network_error"}:{success:!1,error:`Login failed: ${a instanceof Error?a.message:"Unknown error"}`,errorType:"unknown_error"}}},i=async u=>{try{if(!""||!"")return console.log("Forgot password requested in demo mode for:",u),!1;const{error:a}=await S.auth.resetPasswordForEmail(u,{redirectTo:window.location.origin});return a?(console.error("Forgot password error:",a),!1):!0}catch(d){return console.error("Forgot password exception:",d),!1}},p=async u=>{try{await S.auth.signOut(),localStorage.removeItem(`huddle_${u}_auth`),localStorage.removeItem("huddle_user"),t(d=>({...d,[u]:!1})),l(null),g(null)}catch(d){console.error("Logout error:",d)}};return s.jsx(L.Provider,{value:{isAuthenticated:r,login:m,logout:p,forgotPassword:i,user:n,supabaseUser:x},children:e})},Y=()=>{const e=h.useContext(L);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},V="huddle_notifications_v1",R=()=>{const e=localStorage.getItem(V);if(!e)return[];try{return JSON.parse(e)}catch{return[]}},U=e=>localStorage.setItem(V,JSON.stringify(e)),Q=async e=>{let r=R();return e?.orgId&&(r=r.filter(t=>t.orgId===e.orgId||!t.orgId)),e?.userId&&(r=r.filter(t=>t.userId===e.userId||!t.userId)),r.slice().sort((t,n)=>+new Date(n.createdAt)-+new Date(t.createdAt))},G=async e=>{const r=R(),t={id:`note-${Date.now()}`,createdAt:new Date().toISOString(),...e};return r.push(t),U(r),t},X=async()=>{U([])},Z={listNotifications:Q,addNotification:G,clearNotifications:X},ne=()=>{const{orgId:e}=D(),{isAuthenticated:r}=Y(),[t]=h.useState(`Organization ${e}`),[n,l]=h.useState(!1),[x,g]=h.useState([]);return h.useEffect(()=>{const m=e?localStorage.getItem(`huddle_org_${e}_member`)==="true":!1,i=r.admin;l(m||i),(async()=>{if(e){const u=await Z.listNotifications({orgId:e});g(u.slice(0,5))}})()},[e]),s.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("img",{src:"/logo192.png",alt:"The Huddle Co.",className:"h-12 w-12 rounded"}),s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-orange-600",children:[t," Workspace"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Private workspace for your organization"})]})]}),s.jsx("div",{className:"flex items-center space-x-3",children:s.jsx(E,{to:"/client-portal",className:"text-sm text-gray-700",children:"Back to Portal"})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[!n&&s.jsxs("div",{className:"md:col-span-4 bg-white rounded-lg p-8 border text-center",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Restricted"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You must be a member of this organization or a Huddle Co. admin to view this workspace."}),s.jsx("div",{className:"space-x-2",children:s.jsx("button",{onClick:()=>alert("Request access (mock)"),className:"px-4 py-2 bg-orange-500 text-white rounded",children:"Request Access"})})]}),s.jsx("nav",{className:"md:col-span-1 bg-white rounded-lg p-4 border",children:s.jsxs("ul",{className:"space-y-2",children:[s.jsx("li",{children:s.jsx(E,{to:"strategic-plans",className:"block p-2 rounded hover:bg-gray-50",children:"Strategic Plan Drafts"})}),s.jsx("li",{children:s.jsx(E,{to:"session-notes",className:"block p-2 rounded hover:bg-gray-50",children:"Session Notes & Follow-Ups"})}),s.jsx("li",{children:s.jsx(E,{to:"action-tracker",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Action Tracker"})}),s.jsx("li",{children:s.jsx(E,{to:"documents",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Documents"})})]})}),s.jsxs("div",{className:"md:col-span-3",children:[x.length>0&&s.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3",children:[s.jsx("h4",{className:"font-semibold",children:"Recent Workspace Notifications"}),s.jsx("ul",{className:"text-sm mt-2 space-y-1",children:x.map(m=>s.jsxs("li",{children:[m.title," â€” ",s.jsx("span",{className:"text-gray-600",children:new Date(m.createdAt).toLocaleString()})]},m.id))})]}),s.jsx(H,{})]})]})]})},oe=()=>{const{orgId:e}=D(),[r,t]=h.useState([]),[n,l]=h.useState("");h.useEffect(()=>{e&&(async()=>{const p=await(await y(()=>Promise.resolve().then(()=>N),void 0)).listStrategicPlans(e);t(p)})()},[e]);const x=async()=>{if(!e)return;const i=await y(()=>Promise.resolve().then(()=>N),void 0);await i.addStrategicPlanVersion(e,n,"Huddle Co.");const p=await i.listStrategicPlans(e);t(p),l("")},g=async i=>{if(!e)return;const p=await y(()=>Promise.resolve().then(()=>N),void 0);await p.deleteStrategicPlanVersion(e,i),t(await p.listStrategicPlans(e))},m=async i=>{if(!e)return;const{getStrategicPlanVersion:p,addStrategicPlanVersion:u}=await y(async()=>{const{getStrategicPlanVersion:c,addStrategicPlanVersion:a}=await Promise.resolve().then(()=>N);return{getStrategicPlanVersion:c,addStrategicPlanVersion:a}},void 0),d=await p(e,i);if(d){await u(e,d.content,"Restored Version");const c=await y(()=>Promise.resolve().then(()=>N),void 0);t(await c.listStrategicPlans(e))}};return s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Strategic Plan Drafts"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("textarea",{className:"w-full p-3 border rounded",rows:8,value:n,onChange:i=>l(i.target.value),placeholder:"Paste or write your strategic plan draft here (markdown supported)"}),s.jsx("div",{className:"flex justify-end mt-2",children:s.jsx("button",{onClick:x,className:"bg-orange-500 text-white px-4 py-2 rounded",children:"Save Version"})})]}),s.jsxs("div",{className:"bg-white rounded shadow p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Versions"}),r.length===0&&s.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}),s.jsx("ul",{className:"space-y-3",children:r.map(i=>s.jsxs("li",{className:"border p-3 rounded",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(i.createdAt).toLocaleString()," â€¢ ",i.createdBy]}),s.jsxs("div",{className:"space-x-2",children:[s.jsx("button",{onClick:()=>m(i.id),className:"text-sm text-blue-600",children:"Restore"}),s.jsx("button",{onClick:()=>g(i.id),className:"text-sm text-red-600",children:"Delete"})]})]}),s.jsx("div",{className:"mt-2 prose max-w-none",dangerouslySetInnerHTML:{__html:i.content}})]},i.id))})]})]})},ie=()=>{const{orgId:e}=D(),[r,t]=h.useState([]),[n,l]=h.useState(""),[x,g]=h.useState(""),[m,i]=h.useState(new Date().toISOString().slice(0,10)),[p,u]=h.useState("");h.useEffect(()=>{e&&(async()=>{const f=await(await y(()=>Promise.resolve().then(()=>N),void 0)).listSessionNotes(e);t(f)})()},[e]);const d=async()=>{if(!e)return;const o=[],f=await y(()=>Promise.resolve().then(()=>N),void 0);await f.addSessionNote(e,{title:n,body:x,date:m,tags:p.split(",").map(j=>j.trim()),attachments:o});const v=await f.listSessionNotes(e);t(v),l(""),g(""),u("")},c=o=>{if(!o)return;const f=new FileReader;f.onload=()=>{g(v=>v+`

[Attachment: ${o.name}]`)},f.readAsDataURL(o)},a=async o=>{console.log(`Notify client contacts about note ${o}`)};return s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Session Notes & Follow-Ups"}),s.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[s.jsx("input",{className:"w-full border p-2 mb-2 rounded",placeholder:"Title",value:n,onChange:o=>l(o.target.value)}),s.jsx("textarea",{className:"w-full border p-2 mb-2 rounded",rows:4,placeholder:"Notes",value:x,onChange:o=>g(o.target.value)}),s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("input",{type:"date",value:m,onChange:o=>i(o.target.value),className:"border p-2 rounded"}),s.jsx("input",{placeholder:"tags (comma separated)",className:"flex-1 border p-2 rounded",value:p,onChange:o=>u(o.target.value)}),s.jsx("input",{type:"file",onChange:o=>c(o.target.files?.[0]),className:"border p-2 rounded"}),s.jsx("button",{onClick:d,className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Save Note"})]})]}),s.jsx("div",{className:"space-y-3",children:r.map(o=>s.jsxs("div",{className:"bg-white p-4 rounded border",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:[o.date," â€¢ ",o.createdBy]}),s.jsx("div",{children:s.jsx("button",{onClick:()=>a(o.id),className:"text-sm text-blue-600 mr-3",children:"Notify"})})]}),s.jsx("div",{className:"font-semibold mt-1",children:o.title}),s.jsx("div",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:o.body}),s.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Tags: ",o.tags.join(", ")]})]},o.id))})]})},ce=()=>{const{orgId:e}=D(),[r,t]=h.useState([]),[n,l]=h.useState(""),[x,g]=h.useState(""),[m,i]=h.useState("");h.useEffect(()=>{e&&(async()=>{const o=await(await y(()=>Promise.resolve().then(()=>N),void 0)).listActionItems(e);t(o)})()},[e]);const p=async()=>{if(!e||!n)return;const a=await y(()=>Promise.resolve().then(()=>N),void 0);await a.addActionItem(e,{title:n,assignee:x,dueDate:m,status:"Not Started"});const o=await a.listActionItems(e);t(o),l(""),g(""),i("")},u=async a=>{console.log(`Notify about action ${a.id} -> assignee: ${a.assignee||"unassigned"}`),alert(`Notification sent to ${a.assignee||"client contacts"} (mock)`)},d=()=>{const o=[["Title","Assignee","Due Date","Status"]].concat(r.map(w=>[w.title,w.assignee||"",w.dueDate||"",w.status])).map(w=>w.map(I=>`"${String(I).replace(/"/g,'""')}"`).join(",")).join(`
`),f=new Blob([o],{type:"text/csv"}),v=URL.createObjectURL(f),j=document.createElement("a");j.href=v,j.download=`action-tracker-${e||"org"}.csv`,j.click(),URL.revokeObjectURL(v)},c=async a=>{const o=a.status==="Completed"?"Not Started":a.status==="Not Started"?"In Progress":"Completed",f={...a,status:o},v=await y(()=>Promise.resolve().then(()=>N),void 0);await v.updateActionItem(e,f),t(await v.listActionItems(e))};return s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shared Action Tracker"}),s.jsx("div",{className:"flex justify-end mb-2",children:s.jsx("button",{onClick:d,className:"text-sm px-3 py-1 border rounded",children:"Export CSV"})}),s.jsxs("div",{className:"bg-white rounded p-4 mb-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[s.jsx("input",{placeholder:"Action title",className:"border p-2 rounded",value:n,onChange:a=>l(a.target.value)}),s.jsx("input",{placeholder:"Assignee",className:"border p-2 rounded",value:x,onChange:a=>g(a.target.value)}),s.jsx("input",{type:"date",className:"border p-2 rounded",value:m,onChange:a=>i(a.target.value)})]}),s.jsx("div",{className:"flex justify-end mt-2",children:s.jsx("button",{className:"bg-orange-500 text-white px-4 py-2 rounded",onClick:p,children:"Add Action"})})]}),s.jsx("div",{className:"space-y-3",children:r.map(a=>s.jsxs("div",{className:"bg-white p-3 rounded border flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",children:a.title}),s.jsxs("div",{className:"text-sm text-gray-600",children:[a.assignee||"Unassigned"," â€¢ Due: ",a.dueDate||"â€”"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${a.status==="Completed"?"bg-green-100 text-green-800":a.status==="In Progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:a.status}),s.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>c(a),children:"Toggle"}),s.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>u(a),children:"Notify"})]})]},a.id))})]})},O=e=>`huddle_org_workspace_${e}`,b=async e=>{const r=localStorage.getItem(O(e));if(r)return JSON.parse(r);const t={orgId:e,strategicPlans:[],sessionNotes:[],actionItems:[]};return localStorage.setItem(O(e),JSON.stringify(t)),t},A=async e=>{localStorage.setItem(O(e.orgId),JSON.stringify(e))},$=async(e,r,t="Huddle Co.")=>{const n=await b(e),l={id:`sp-${Date.now()}`,content:r,createdAt:new Date().toISOString(),createdBy:t};return n.strategicPlans.push(l),await A(n),l},F=async e=>(await b(e)).strategicPlans.slice().sort((t,n)=>+new Date(n.createdAt)-+new Date(t.createdAt)),ee=async(e,r)=>{const t=await b(e);t.strategicPlans=t.strategicPlans.filter(n=>n.id!==r),await A(t)},se=async(e,r)=>(await b(e)).strategicPlans.find(n=>n.id===r)||null,W=async(e,r,t="Huddle Co.")=>{const n=await b(e),l={id:`note-${Date.now()}`,createdBy:t,...r};return n.sessionNotes.push(l),await A(n),l},J=async e=>(await b(e)).sessionNotes.slice().sort((t,n)=>+new Date(n.date)-+new Date(t.date)),q=async(e,r)=>{const t=await b(e),n={id:`action-${Date.now()}`,...r};return t.actionItems.push(n),await A(t),n},M=async(e,r)=>{const t=await b(e);return t.actionItems=t.actionItems.map(n=>n.id===r.id?r:n),await A(t),r},B=async e=>(await b(e)).actionItems.slice().sort((t,n)=>{const l={"Not Started":0,"In Progress":1,Completed:2};return l[t.status]-l[n.status]}),te={getWorkspace:b,saveWorkspace:A,addStrategicPlanVersion:$,listStrategicPlans:F,addSessionNote:W,listSessionNotes:J,addActionItem:q,listActionItems:B,updateActionItem:M},N=Object.freeze(Object.defineProperty({__proto__:null,addActionItem:q,addSessionNote:W,addStrategicPlanVersion:$,default:te,deleteStrategicPlanVersion:ee,getStrategicPlanVersion:se,getWorkspace:b,listActionItems:B,listSessionNotes:J,listStrategicPlans:F,saveWorkspace:A,updateActionItem:M},Symbol.toStringTag,{value:"Module"}));export{re as A,ne as O,oe as S,y as _,ie as a,ce as b,N as c,Z as n,S as s,Y as u};
