import{r as g,j as t,u as O,L as k,O as z}from"./vendor-react-Bc4KbPG0.js";const K="modulepreload",M=function(e){return"/"+e},T={},W=function(a,s,n){let l=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),m=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));l=Promise.allSettled(s.map(o=>{if(o=M(o),o in T)return;T[o]=!0;const x=o.endsWith(".css"),h=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${h}`))return;const i=document.createElement("link");if(i.rel=x?"stylesheet":K,x||(i.as="script"),i.crossOrigin="",i.href=o,m&&i.setAttribute("nonce",m),document.head.appendChild(i),x)return new Promise((u,r)=>{i.addEventListener("load",u),i.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${o}`)))})}))}function f(d){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=d,window.dispatchEvent(m),!m.defaultPrevented)throw d}return l.then(d=>{for(const m of d||[])m.status==="rejected"&&f(m.reason);return a().catch(f)})};let N;{console.warn('Supabase environment variables not found. Please click "Connect to Supabase" in the top right to set up your database connection.');const e=()=>({select:()=>e(),insert:()=>e(),update:()=>e(),upsert:()=>e(),delete:()=>e(),eq:()=>e(),order:()=>e(),single:()=>Promise.resolve({data:null,error:{message:"Supabase not configured"}}),then:a=>a({data:[],error:null})});N={auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),getUser:()=>Promise.resolve({data:{user:null},error:null}),signUp:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signInWithPassword:()=>Promise.resolve({data:{user:null},error:{message:"Supabase not configured"}}),signOut:()=>Promise.resolve({error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},from:()=>e()}}const J=g.createContext(void 0),re=({children:e})=>{const[a,s]=g.useState({lms:!1,admin:!1}),[n,l]=g.useState(null),[f,d]=g.useState(null);g.useEffect(()=>{N.auth.getSession().then(i=>{const u=i.data.session;if(u!=null&&u.user){d(u.user);const r=localStorage.getItem("huddle_lms_auth")==="true",c=localStorage.getItem("huddle_admin_auth")==="true",w=localStorage.getItem("huddle_user");if(s({lms:r,admin:c}),w)try{l(JSON.parse(w))}catch(b){console.error("Error parsing saved user data:",b),localStorage.removeItem("huddle_user")}}});const{data:h}=N.auth.onAuthStateChange(async(i,u)=>{u!=null&&u.user?d(u.user):(d(null),s({lms:!1,admin:!1}),l(null),localStorage.removeItem("huddle_lms_auth"),localStorage.removeItem("huddle_admin_auth"),localStorage.removeItem("huddle_user"))});return()=>h.subscription.unsubscribe()},[]);const m=async(h,i,u)=>{try{const r={email:h,password:i};if(!""||!""){if(![{email:"admin@thehuddleco.com",password:"admin123",type:"admin"},{email:"demo@thehuddleco.com",password:"demo123",type:"lms"}].some(C=>C.email===h&&C.password===i&&C.type===u))return console.error("Invalid demo credentials"),!1;localStorage.setItem(`huddle_${u}_auth`,"true");const A={name:u==="admin"?"Mya Dennis":"Sarah Chen",email:h,role:u==="admin"?"admin":"user",id:`demo-${u}-${Date.now()}`};return localStorage.setItem("huddle_user",JSON.stringify(A)),s(C=>({...C,[u]:!0})),l(A),!0}const{data:b,error:I}=await N.auth.signInWithPassword(r);let p=b==null?void 0:b.user;if(I||!p){const{error:j}=await N.auth.signUp(r);j&&console.warn("Sign-up attempt failed (may require confirmation):",j.message||j);const{data:_,error:A}=await N.auth.signInWithPassword(r);if(A||!(_!=null&&_.user))return console.error("Authentication error during sign-in:",A||"no user returned"),!1;p=_.user}p&&d(p),localStorage.setItem(`huddle_${u}_auth`,"true");const S={name:u==="admin"?"Mya Dennis":"Sarah Chen",email:h,role:u==="admin"?"admin":"user",id:(p==null?void 0:p.id)||""};return localStorage.setItem("huddle_user",JSON.stringify(S)),s(j=>({...j,[u]:!0})),l(S),p&&await N.from("user_profiles").upsert({user_id:p.id,name:S.name,email:S.email,role:S.role}),!0}catch(r){return console.error("Login error:",r),!1}},o=async h=>{try{const{error:i}=await N.auth.resetPasswordForEmail(h,{redirectTo:window.location.origin});return i?(console.error("Forgot password error:",i),!1):!0}catch(i){return console.error("Forgot password exception:",i),!1}},x=async h=>{try{await N.auth.signOut(),localStorage.removeItem(`huddle_${h}_auth`),localStorage.removeItem("huddle_user"),s(i=>({...i,[h]:!1})),l(null),d(null)}catch(i){console.error("Logout error:",i)}};return t.jsx(J.Provider,{value:{isAuthenticated:a,login:m,logout:x,forgotPassword:o,user:n,supabaseUser:f},children:e})},Y=()=>{const e=g.useContext(J);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},$=e=>`huddle_org_workspace_${e}`,v=async e=>{const a=localStorage.getItem($(e));if(a)return JSON.parse(a);const s={orgId:e,strategicPlans:[],sessionNotes:[],actionItems:[]};return localStorage.setItem($(e),JSON.stringify(s)),s},y=async e=>{localStorage.setItem($(e.orgId),JSON.stringify(e))},V=async(e,a,s="Huddle Co.")=>{const n=await v(e),l={id:`sp-${Date.now()}`,content:a,createdAt:new Date().toISOString(),createdBy:s};return n.strategicPlans.push(l),await y(n),l},P=async e=>(await v(e)).strategicPlans.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt)),Q=async(e,a)=>{const s=await v(e);s.strategicPlans=s.strategicPlans.filter(n=>n.id!==a),await y(s)},G=async(e,a)=>(await v(e)).strategicPlans.find(n=>n.id===a)||null,U=async(e,a,s="Huddle Co.")=>{const n=await v(e),l={id:`note-${Date.now()}`,createdBy:s,...a};return n.sessionNotes.push(l),await y(n),l},E=async e=>(await v(e)).sessionNotes.slice().sort((s,n)=>+new Date(n.date)-+new Date(s.date)),L=async(e,a)=>{const s=await v(e),n={id:`action-${Date.now()}`,...a};return s.actionItems.push(n),await y(s),n},R=async(e,a)=>{const s=await v(e);return s.actionItems=s.actionItems.map(n=>n.id===a.id?a:n),await y(s),a},D=async e=>(await v(e)).actionItems.slice().sort((s,n)=>{const l={"Not Started":0,"In Progress":1,Completed:2};return l[s.status]-l[n.status]}),X={getWorkspace:v,saveWorkspace:y,addStrategicPlanVersion:V,listStrategicPlans:P,addSessionNote:U,listSessionNotes:E,addActionItem:L,listActionItems:D,updateActionItem:R},F=Object.freeze(Object.defineProperty({__proto__:null,addActionItem:L,addSessionNote:U,addStrategicPlanVersion:V,default:X,deleteStrategicPlanVersion:Q,getStrategicPlanVersion:G,getWorkspace:v,listActionItems:D,listSessionNotes:E,listStrategicPlans:P,saveWorkspace:y,updateActionItem:R},Symbol.toStringTag,{value:"Module"})),q="huddle_notifications_v1",B=()=>{const e=localStorage.getItem(q);if(!e)return[];try{return JSON.parse(e)}catch{return[]}},H=e=>localStorage.setItem(q,JSON.stringify(e)),Z=async e=>{let a=B();return e!=null&&e.orgId&&(a=a.filter(s=>s.orgId===e.orgId||!s.orgId)),e!=null&&e.userId&&(a=a.filter(s=>s.userId===e.userId||!s.userId)),a.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt))},ee=async e=>{const a=B(),s={id:`note-${Date.now()}`,createdAt:new Date().toISOString(),...e};return a.push(s),H(a),s},te=async()=>{H([])},se={listNotifications:Z,addNotification:ee,clearNotifications:te},ne=()=>{const{orgId:e}=O(),{isAuthenticated:a}=Y(),[s]=g.useState(`Organization ${e}`),[n,l]=g.useState(!1),[f,d]=g.useState([]);return g.useEffect(()=>{const m=e?localStorage.getItem(`huddle_org_${e}_member`)==="true":!1,o=a.admin;l(m||o),(async()=>{if(e){const h=await se.listNotifications({orgId:e});d(h.slice(0,5))}})()},[e]),t.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:"/logo192.png",alt:"The Huddle Co.",className:"h-12 w-12 rounded"}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-orange-600",children:[s," Workspace"]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Private workspace for your organization"})]})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx(k,{to:"/client-portal",className:"text-sm text-gray-700",children:"Back to Portal"})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[!n&&t.jsxs("div",{className:"md:col-span-4 bg-white rounded-lg p-8 border text-center",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Restricted"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You must be a member of this organization or a Huddle Co. admin to view this workspace."}),t.jsx("div",{className:"space-x-2",children:t.jsx("button",{onClick:()=>alert("Request access (mock)"),className:"px-4 py-2 bg-orange-500 text-white rounded",children:"Request Access"})})]}),t.jsx("nav",{className:"md:col-span-1 bg-white rounded-lg p-4 border",children:t.jsxs("ul",{className:"space-y-2",children:[t.jsx("li",{children:t.jsx(k,{to:"strategic-plans",className:"block p-2 rounded hover:bg-gray-50",children:"Strategic Plan Drafts"})}),t.jsx("li",{children:t.jsx(k,{to:"session-notes",className:"block p-2 rounded hover:bg-gray-50",children:"Session Notes & Follow-Ups"})}),t.jsx("li",{children:t.jsx(k,{to:"action-tracker",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Action Tracker"})}),t.jsx("li",{children:t.jsx(k,{to:"documents",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Documents"})})]})}),t.jsxs("div",{className:"md:col-span-3",children:[f.length>0&&t.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3",children:[t.jsx("h4",{className:"font-semibold",children:"Recent Workspace Notifications"}),t.jsx("ul",{className:"text-sm mt-2 space-y-1",children:f.map(m=>t.jsxs("li",{children:[m.title," â€” ",t.jsx("span",{className:"text-gray-600",children:new Date(m.createdAt).toLocaleString()})]},m.id))})]}),t.jsx(z,{})]})]})]})},oe=()=>{const{orgId:e}=O(),[a,s]=g.useState([]),[n,l]=g.useState("");g.useEffect(()=>{e&&P(e).then(s)},[e]);const f=async()=>{if(!e)return;await V(e,n,"Huddle Co.");const o=await P(e);s(o),l("")},d=async o=>{e&&(await(await W(async()=>{const{deleteStrategicPlanVersion:x}=await Promise.resolve().then(()=>F);return{deleteStrategicPlanVersion:x}},void 0)).deleteStrategicPlanVersion(e,o),s(await P(e)))},m=async o=>{if(!e)return;const{getStrategicPlanVersion:x,addStrategicPlanVersion:h}=await W(async()=>{const{getStrategicPlanVersion:u,addStrategicPlanVersion:r}=await Promise.resolve().then(()=>F);return{getStrategicPlanVersion:u,addStrategicPlanVersion:r}},void 0),i=await x(e,o);i&&(await h(e,i.content,"Restored Version"),s(await P(e)))};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Strategic Plan Drafts"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("textarea",{className:"w-full p-3 border rounded",rows:8,value:n,onChange:o=>l(o.target.value),placeholder:"Paste or write your strategic plan draft here (markdown supported)"}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:f,className:"bg-orange-500 text-white px-4 py-2 rounded",children:"Save Version"})})]}),t.jsxs("div",{className:"bg-white rounded shadow p-4",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Versions"}),a.length===0&&t.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}),t.jsx("ul",{className:"space-y-3",children:a.map(o=>t.jsxs("li",{className:"border p-3 rounded",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(o.createdAt).toLocaleString()," â€¢ ",o.createdBy]}),t.jsxs("div",{className:"space-x-2",children:[t.jsx("button",{onClick:()=>m(o.id),className:"text-sm text-blue-600",children:"Restore"}),t.jsx("button",{onClick:()=>d(o.id),className:"text-sm text-red-600",children:"Delete"})]})]}),t.jsx("div",{className:"mt-2 prose max-w-none",dangerouslySetInnerHTML:{__html:o.content}})]},o.id))})]})]})},ce=()=>{const{orgId:e}=O(),[a,s]=g.useState([]),[n,l]=g.useState(""),[f,d]=g.useState(""),[m,o]=g.useState(new Date().toISOString().slice(0,10)),[x,h]=g.useState("");g.useEffect(()=>{e&&E(e).then(s)},[e]);const i=async()=>{if(!e)return;const c=[];await U(e,{title:n,body:f,date:m,tags:x.split(",").map(b=>b.trim()),attachments:c});const w=await E(e);s(w),l(""),d(""),h("")},u=c=>{if(!c)return;const w=new FileReader;w.onload=()=>{d(b=>b+`

[Attachment: ${c.name}]`)},w.readAsDataURL(c)},r=async c=>{console.log(`Notify client contacts about note ${c}`)};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Session Notes & Follow-Ups"}),t.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[t.jsx("input",{className:"w-full border p-2 mb-2 rounded",placeholder:"Title",value:n,onChange:c=>l(c.target.value)}),t.jsx("textarea",{className:"w-full border p-2 mb-2 rounded",rows:4,placeholder:"Notes",value:f,onChange:c=>d(c.target.value)}),t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("input",{type:"date",value:m,onChange:c=>o(c.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"tags (comma separated)",className:"flex-1 border p-2 rounded",value:x,onChange:c=>h(c.target.value)}),t.jsx("input",{type:"file",onChange:c=>{var w;return u((w=c.target.files)==null?void 0:w[0])},className:"border p-2 rounded"}),t.jsx("button",{onClick:i,className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Save Note"})]})]}),t.jsx("div",{className:"space-y-3",children:a.map(c=>t.jsxs("div",{className:"bg-white p-4 rounded border",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600",children:[c.date," â€¢ ",c.createdBy]}),t.jsx("div",{children:t.jsx("button",{onClick:()=>r(c.id),className:"text-sm text-blue-600 mr-3",children:"Notify"})})]}),t.jsx("div",{className:"font-semibold mt-1",children:c.title}),t.jsx("div",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:c.body}),t.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Tags: ",c.tags.join(", ")]})]},c.id))})]})},ie=()=>{const{orgId:e}=O(),[a,s]=g.useState([]),[n,l]=g.useState(""),[f,d]=g.useState(""),[m,o]=g.useState("");g.useEffect(()=>{e&&D(e).then(s)},[e]);const x=async()=>{if(!e||!n)return;await L(e,{title:n,assignee:f,dueDate:m,status:"Not Started"});const r=await D(e);s(r),l(""),d(""),o("")},h=async r=>{console.log(`Notify about action ${r.id} -> assignee: ${r.assignee||"unassigned"}`),alert(`Notification sent to ${r.assignee||"client contacts"} (mock)`)},i=()=>{const c=[["Title","Assignee","Due Date","Status"]].concat(a.map(p=>[p.title,p.assignee||"",p.dueDate||"",p.status])).map(p=>p.map(S=>`"${String(S).replace(/"/g,'""')}"`).join(",")).join(`
`),w=new Blob([c],{type:"text/csv"}),b=URL.createObjectURL(w),I=document.createElement("a");I.href=b,I.download=`action-tracker-${e||"org"}.csv`,I.click(),URL.revokeObjectURL(b)},u=async r=>{const c=r.status==="Completed"?"Not Started":r.status==="Not Started"?"In Progress":"Completed",w={...r,status:c};await R(e,w),s(await D(e))};return t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shared Action Tracker"}),t.jsx("div",{className:"flex justify-end mb-2",children:t.jsx("button",{onClick:i,className:"text-sm px-3 py-1 border rounded",children:"Export CSV"})}),t.jsxs("div",{className:"bg-white rounded p-4 mb-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsx("input",{placeholder:"Action title",className:"border p-2 rounded",value:n,onChange:r=>l(r.target.value)}),t.jsx("input",{placeholder:"Assignee",className:"border p-2 rounded",value:f,onChange:r=>d(r.target.value)}),t.jsx("input",{type:"date",className:"border p-2 rounded",value:m,onChange:r=>o(r.target.value)})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{className:"bg-orange-500 text-white px-4 py-2 rounded",onClick:x,children:"Add Action"})})]}),t.jsx("div",{className:"space-y-3",children:a.map(r=>t.jsxs("div",{className:"bg-white p-3 rounded border flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:r.title}),t.jsxs("div",{className:"text-sm text-gray-600",children:[r.assignee||"Unassigned"," â€¢ Due: ",r.dueDate||"â€”"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${r.status==="Completed"?"bg-green-100 text-green-800":r.status==="In Progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.status}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>u(r),children:"Toggle"}),t.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>h(r),children:"Notify"})]})]},r.id))})]})};export{re as A,ne as O,oe as S,ce as a,ie as b,X as c,se as n,N as s,Y as u};
