var Y=Object.defineProperty,G=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var F=(t,a,s)=>a in t?Y(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,I=(t,a)=>{for(var s in a||(a={}))X.call(a,s)&&F(t,s,a[s]);if(U)for(var s of U(a))Z.call(a,s)&&F(t,s,a[s]);return t},V=(t,a)=>G(t,Q(a));var l=(t,a,s)=>new Promise((n,d)=>{var v=c=>{try{x(s.next(c))}catch(h){d(h)}},f=c=>{try{x(s.throw(c))}catch(h){d(h)}},x=c=>c.done?n(c.value):Promise.resolve(c.value).then(v,f);x((s=s.apply(t,a)).next())});import{r as g,j as e,d as L,J as $,av as ee}from"./vendor-react-BzqoynUn.js";import{s as A,n as te}from"./admin-secondary-Bhr4EVHo.js";import{_ as j}from"./admin-surveys-jYOOvi8E.js";const W=g.createContext(void 0),he=({children:t})=>{const[a,s]=g.useState({lms:!1,admin:!1}),[n,d]=g.useState(null),[v,f]=g.useState(null);g.useEffect(()=>{A.auth.getSession().then(p=>{const i=p.data.session;if(i!=null&&i.user){f(i.user);const r=localStorage.getItem("huddle_lms_auth")==="true",o=localStorage.getItem("huddle_admin_auth")==="true",u=localStorage.getItem("huddle_user");if(s({lms:r,admin:o}),u)try{d(JSON.parse(u))}catch(b){console.error("Error parsing saved user data:",b),localStorage.removeItem("huddle_user")}}});const{data:m}=A.auth.onAuthStateChange((p,i)=>l(void 0,null,function*(){console.log("AuthContext auth state change, has session:",!!i),i!=null&&i.user?f(i.user):(f(null),s({lms:!1,admin:!1}),d(null),localStorage.removeItem("huddle_lms_auth"),localStorage.removeItem("huddle_admin_auth"),localStorage.removeItem("huddle_user"))}));return()=>m.subscription.unsubscribe()},[]);const x=(m,p,i)=>l(void 0,null,function*(){var r,o;try{const u={email:m,password:p};if(!""||!""){if(console.log("Running in demo mode - Supabase not configured"),![{email:"admin@thehuddleco.com",password:"admin123",type:"admin"},{email:"demo@thehuddleco.com",password:"demo123",type:"lms"},{email:"user@pacificcoast.edu",password:"user123",type:"lms"}].some(E=>E.email===m&&E.password===p&&E.type===i))return console.error("Invalid demo credentials:",{email:m,type:i}),{success:!1,error:"Invalid credentials. For demo mode, use: user@pacificcoast.edu / user123 for LMS or demo@thehuddleco.com / demo123",errorType:"invalid_credentials"};localStorage.setItem(`huddle_${i}_auth`,"true");const w={name:i==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:i==="admin"?"admin":"user",id:`demo-${i}-${Date.now()}`};return localStorage.setItem("huddle_user",JSON.stringify(w)),s(E=>V(I({},E),{[i]:!0})),d(w),console.log("Demo login successful for:",m),{success:!0}}console.log("Attempting Supabase authentication for:",m);const{data:N,error:D}=yield A.auth.signInWithPassword(u);let _=N==null?void 0:N.user;if(D||!_){console.log("Initial sign-in failed, attempting sign-up for development:",D==null?void 0:D.message);const{error:P}=yield A.auth.signUp(u);P&&console.warn("Sign-up attempt failed (may require confirmation):",P.message||P);const{data:T,error:w}=yield A.auth.signInWithPassword(u);if(w||!(T!=null&&T.user))return console.error("Authentication error during sign-in retry:",w),(r=w==null?void 0:w.message)!=null&&r.includes("Invalid login credentials")?{success:!1,error:"Invalid email or password. Please check your credentials and try again.",errorType:"invalid_credentials"}:(o=w==null?void 0:w.message)!=null&&o.includes("Email not confirmed")?{success:!1,error:"Please check your email and click the confirmation link before signing in.",errorType:"invalid_credentials"}:{success:!1,error:`Authentication failed: ${(w==null?void 0:w.message)||"Unknown error"}`,errorType:"unknown_error"};_=T.user}_&&f(_),localStorage.setItem(`huddle_${i}_auth`,"true");const O={name:i==="admin"?"Mya Dennis":"Sarah Chen",email:m,role:i==="admin"?"admin":"user",id:(_==null?void 0:_.id)||""};if(localStorage.setItem("huddle_user",JSON.stringify(O)),s(P=>V(I({},P),{[i]:!0})),d(O),_)try{yield A.from("user_profiles").upsert({user_id:_.id,name:O.name,email:O.email,role:O.role})}catch(P){console.warn("Failed to update user profile:",P)}return console.log("Supabase login successful for:",m),{success:!0}}catch(u){return console.error("Login error:",u),u instanceof Error&&u.message.includes("fetch")?{success:!1,error:"Network error. Please check your internet connection and try again.",errorType:"network_error"}:{success:!1,error:`Login failed: ${u instanceof Error?u.message:"Unknown error"}`,errorType:"unknown_error"}}}),c=m=>l(void 0,null,function*(){try{if(!""||!"")return console.log("Forgot password requested in demo mode for:",m),!1;const{error:r}=yield A.auth.resetPasswordForEmail(m,{redirectTo:window.location.origin});return r?(console.error("Forgot password error:",r),!1):!0}catch(p){return console.error("Forgot password exception:",p),!1}}),h=m=>l(void 0,null,function*(){try{yield A.auth.signOut(),localStorage.removeItem(`huddle_${m}_auth`),localStorage.removeItem("huddle_user"),s(p=>V(I({},p),{[m]:!1})),d(null),f(null)}catch(p){console.error("Logout error:",p)}});return e.jsx(W.Provider,{value:{isAuthenticated:a,login:x,logout:h,forgotPassword:c,user:n,supabaseUser:v},children:t})},se=()=>{const t=g.useContext(W);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ae=()=>{const{orgId:t}=L(),{isAuthenticated:a}=se(),[s]=g.useState(`Organization ${t}`),[n,d]=g.useState(!1),[v,f]=g.useState([]);return g.useEffect(()=>{const x=t?localStorage.getItem(`huddle_org_${t}_member`)==="true":!1,c=a.admin;d(x||c),l(void 0,null,function*(){if(t){const m=yield te.listNotifications({orgId:t});f(m.slice(0,5))}})},[t]),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:"/logo192.png",alt:"The Huddle Co.",className:"h-12 w-12 rounded"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-orange-600",children:[s," Workspace"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Private workspace for your organization"})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx($,{to:"/client-portal",className:"text-sm text-gray-700",children:"Back to Portal"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[!n&&e.jsxs("div",{className:"md:col-span-4 bg-white rounded-lg p-8 border text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You must be a member of this organization or a Huddle Co. admin to view this workspace."}),e.jsx("div",{className:"space-x-2",children:e.jsx("button",{onClick:()=>alert("Request access (mock)"),className:"px-4 py-2 bg-orange-500 text-white rounded",children:"Request Access"})})]}),e.jsx("nav",{className:"md:col-span-1 bg-white rounded-lg p-4 border",children:e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx($,{to:"strategic-plans",className:"block p-2 rounded hover:bg-gray-50",children:"Strategic Plan Drafts"})}),e.jsx("li",{children:e.jsx($,{to:"session-notes",className:"block p-2 rounded hover:bg-gray-50",children:"Session Notes & Follow-Ups"})}),e.jsx("li",{children:e.jsx($,{to:"action-tracker",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Action Tracker"})}),e.jsx("li",{children:e.jsx($,{to:"documents",className:"block p-2 rounded hover:bg-gray-50",children:"Shared Documents"})})]})}),e.jsxs("div",{className:"md:col-span-3",children:[v.length>0&&e.jsxs("div",{className:"mb-4 bg-yellow-50 border border-yellow-100 rounded-lg p-3",children:[e.jsx("h4",{className:"font-semibold",children:"Recent Workspace Notifications"}),e.jsx("ul",{className:"text-sm mt-2 space-y-1",children:v.map(x=>e.jsxs("li",{children:[x.title," â€” ",e.jsx("span",{className:"text-gray-600",children:new Date(x.createdAt).toLocaleString()})]},x.id))})]}),e.jsx(ee,{})]})]})]})},xe=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),re=()=>{const{orgId:t}=L(),[a,s]=g.useState([]),[n,d]=g.useState("");g.useEffect(()=>{t&&l(void 0,null,function*(){const h=yield(yield j(()=>Promise.resolve().then(()=>S),void 0)).listStrategicPlans(t);s(h)})},[t]);const v=()=>l(void 0,null,function*(){if(!t)return;const c=yield j(()=>Promise.resolve().then(()=>S),void 0);yield c.addStrategicPlanVersion(t,n,"Huddle Co.");const h=yield c.listStrategicPlans(t);s(h),d("")}),f=c=>l(void 0,null,function*(){if(!t)return;const h=yield j(()=>Promise.resolve().then(()=>S),void 0);yield h.deleteStrategicPlanVersion(t,c),s(yield h.listStrategicPlans(t))}),x=c=>l(void 0,null,function*(){if(!t)return;const{getStrategicPlanVersion:h,addStrategicPlanVersion:m}=yield j(()=>l(void 0,null,function*(){const{getStrategicPlanVersion:i,addStrategicPlanVersion:r}=yield Promise.resolve().then(()=>S);return{getStrategicPlanVersion:i,addStrategicPlanVersion:r}}),void 0),p=yield h(t,c);if(p){yield m(t,p.content,"Restored Version");const i=yield j(()=>Promise.resolve().then(()=>S),void 0);s(yield i.listStrategicPlans(t))}});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Strategic Plan Drafts"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("textarea",{className:"w-full p-3 border rounded",rows:8,value:n,onChange:c=>d(c.target.value),placeholder:"Paste or write your strategic plan draft here (markdown supported)"}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{onClick:v,className:"bg-orange-500 text-white px-4 py-2 rounded",children:"Save Version"})})]}),e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Versions"}),a.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No versions yet."}),e.jsx("ul",{className:"space-y-3",children:a.map(c=>e.jsxs("li",{className:"border p-3 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[new Date(c.createdAt).toLocaleString()," â€¢ ",c.createdBy]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>x(c.id),className:"text-sm text-blue-600",children:"Restore"}),e.jsx("button",{onClick:()=>f(c.id),className:"text-sm text-red-600",children:"Delete"})]})]}),e.jsx("div",{className:"mt-2 prose max-w-none",dangerouslySetInnerHTML:{__html:c.content}})]},c.id))})]})]})},pe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"})),oe=()=>{const{orgId:t}=L(),[a,s]=g.useState([]),[n,d]=g.useState(""),[v,f]=g.useState(""),[x,c]=g.useState(new Date().toISOString().slice(0,10)),[h,m]=g.useState("");g.useEffect(()=>{t&&l(void 0,null,function*(){const u=yield(yield j(()=>Promise.resolve().then(()=>S),void 0)).listSessionNotes(t);s(u)})},[t]);const p=()=>l(void 0,null,function*(){if(!t)return;const o=[],u=yield j(()=>Promise.resolve().then(()=>S),void 0);yield u.addSessionNote(t,{title:n,body:v,date:x,tags:h.split(",").map(C=>C.trim()),attachments:o});const b=yield u.listSessionNotes(t);s(b),d(""),f(""),m("")}),i=o=>{if(!o)return;const u=new FileReader;u.onload=()=>{f(b=>b+`

[Attachment: ${o.name}]`)},u.readAsDataURL(o)},r=o=>l(void 0,null,function*(){console.log(`Notify client contacts about note ${o}`)});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Session Notes & Follow-Ups"}),e.jsxs("div",{className:"bg-white rounded shadow p-4 mb-4",children:[e.jsx("input",{className:"w-full border p-2 mb-2 rounded",placeholder:"Title",value:n,onChange:o=>d(o.target.value)}),e.jsx("textarea",{className:"w-full border p-2 mb-2 rounded",rows:4,placeholder:"Notes",value:v,onChange:o=>f(o.target.value)}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"date",value:x,onChange:o=>c(o.target.value),className:"border p-2 rounded"}),e.jsx("input",{placeholder:"tags (comma separated)",className:"flex-1 border p-2 rounded",value:h,onChange:o=>m(o.target.value)}),e.jsx("input",{type:"file",onChange:o=>{var u;return i((u=o.target.files)==null?void 0:u[0])},className:"border p-2 rounded"}),e.jsx("button",{onClick:p,className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Save Note"})]})]}),e.jsx("div",{className:"space-y-3",children:a.map(o=>e.jsxs("div",{className:"bg-white p-4 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[o.date," â€¢ ",o.createdBy]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>r(o.id),className:"text-sm text-blue-600 mr-3",children:"Notify"})})]}),e.jsx("div",{className:"font-semibold mt-1",children:o.title}),e.jsx("div",{className:"mt-2 text-gray-700 whitespace-pre-wrap",children:o.body}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Tags: ",o.tags.join(", ")]})]},o.id))})]})},fe=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"})),ne=()=>{const{orgId:t}=L(),[a,s]=g.useState([]),[n,d]=g.useState(""),[v,f]=g.useState(""),[x,c]=g.useState("");g.useEffect(()=>{t&&l(void 0,null,function*(){const o=yield(yield j(()=>Promise.resolve().then(()=>S),void 0)).listActionItems(t);s(o)})},[t]);const h=()=>l(void 0,null,function*(){if(!t||!n)return;const r=yield j(()=>Promise.resolve().then(()=>S),void 0);yield r.addActionItem(t,{title:n,assignee:v,dueDate:x,status:"Not Started"});const o=yield r.listActionItems(t);s(o),d(""),f(""),c("")}),m=r=>l(void 0,null,function*(){console.log(`Notify about action ${r.id} -> assignee: ${r.assignee||"unassigned"}`),alert(`Notification sent to ${r.assignee||"client contacts"} (mock)`)}),p=()=>{const o=[["Title","Assignee","Due Date","Status"]].concat(a.map(N=>[N.title,N.assignee||"",N.dueDate||"",N.status])).map(N=>N.map(D=>`"${String(D).replace(/"/g,'""')}"`).join(",")).join(`
`),u=new Blob([o],{type:"text/csv"}),b=URL.createObjectURL(u),C=document.createElement("a");C.href=b,C.download=`action-tracker-${t||"org"}.csv`,C.click(),URL.revokeObjectURL(b)},i=r=>l(void 0,null,function*(){const o=r.status==="Completed"?"Not Started":r.status==="Not Started"?"In Progress":"Completed",u=V(I({},r),{status:o}),b=yield j(()=>Promise.resolve().then(()=>S),void 0);yield b.updateActionItem(t,u),s(yield b.listActionItems(t))});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Shared Action Tracker"}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:p,className:"text-sm px-3 py-1 border rounded",children:"Export CSV"})}),e.jsxs("div",{className:"bg-white rounded p-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx("input",{placeholder:"Action title",className:"border p-2 rounded",value:n,onChange:r=>d(r.target.value)}),e.jsx("input",{placeholder:"Assignee",className:"border p-2 rounded",value:v,onChange:r=>f(r.target.value)}),e.jsx("input",{type:"date",className:"border p-2 rounded",value:x,onChange:r=>c(r.target.value)})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{className:"bg-orange-500 text-white px-4 py-2 rounded",onClick:h,children:"Add Action"})})]}),e.jsx("div",{className:"space-y-3",children:a.map(r=>e.jsxs("div",{className:"bg-white p-3 rounded border flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:r.title}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r.assignee||"Unassigned"," â€¢ Due: ",r.dueDate||"â€”"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${r.status==="Completed"?"bg-green-100 text-green-800":r.status==="In Progress"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.status}),e.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>i(r),children:"Toggle"}),e.jsx("button",{className:"px-3 py-1 border rounded",onClick:()=>m(r),children:"Notify"})]})]},r.id))})]})},ve=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),R=t=>`huddle_org_workspace_${t}`,y=t=>l(void 0,null,function*(){const a=localStorage.getItem(R(t));if(a)return JSON.parse(a);const s={orgId:t,strategicPlans:[],sessionNotes:[],actionItems:[]};return localStorage.setItem(R(t),JSON.stringify(s)),s}),k=t=>l(void 0,null,function*(){localStorage.setItem(R(t.orgId),JSON.stringify(t))}),M=(t,a,s="Huddle Co.")=>l(void 0,null,function*(){const n=yield y(t),d={id:`sp-${Date.now()}`,content:a,createdAt:new Date().toISOString(),createdBy:s};return n.strategicPlans.push(d),yield k(n),d}),z=t=>l(void 0,null,function*(){return(yield y(t)).strategicPlans.slice().sort((s,n)=>+new Date(n.createdAt)-+new Date(s.createdAt))}),ce=(t,a)=>l(void 0,null,function*(){const s=yield y(t);s.strategicPlans=s.strategicPlans.filter(n=>n.id!==a),yield k(s)}),ie=(t,a)=>l(void 0,null,function*(){return(yield y(t)).strategicPlans.find(n=>n.id===a)||null}),J=(t,a,s="Huddle Co.")=>l(void 0,null,function*(){const n=yield y(t),d=I({id:`note-${Date.now()}`,createdBy:s},a);return n.sessionNotes.push(d),yield k(n),d}),H=t=>l(void 0,null,function*(){return(yield y(t)).sessionNotes.slice().sort((s,n)=>+new Date(n.date)-+new Date(s.date))}),B=(t,a)=>l(void 0,null,function*(){const s=yield y(t),n=I({id:`action-${Date.now()}`},a);return s.actionItems.push(n),yield k(s),n}),K=(t,a)=>l(void 0,null,function*(){const s=yield y(t);return s.actionItems=s.actionItems.map(n=>n.id===a.id?a:n),yield k(s),a}),q=t=>l(void 0,null,function*(){return(yield y(t)).actionItems.slice().sort((s,n)=>{const d={"Not Started":0,"In Progress":1,Completed:2};return d[s.status]-d[n.status]})}),le={getWorkspace:y,saveWorkspace:k,addStrategicPlanVersion:M,listStrategicPlans:z,addSessionNote:J,listSessionNotes:H,addActionItem:B,listActionItems:q,updateActionItem:K},S=Object.freeze(Object.defineProperty({__proto__:null,addActionItem:B,addSessionNote:J,addStrategicPlanVersion:M,default:le,deleteStrategicPlanVersion:ce,getStrategicPlanVersion:ie,getWorkspace:y,listActionItems:q,listSessionNotes:H,listStrategicPlans:z,saveWorkspace:k,updateActionItem:K},Symbol.toStringTag,{value:"Module"}));export{he as A,xe as O,pe as S,fe as a,ve as b,se as u};
