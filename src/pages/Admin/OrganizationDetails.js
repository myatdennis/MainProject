import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect, useCallback } from 'react';
import { useParams, Link } from 'react-router-dom';
import { ArrowLeft, Edit, X, Building2, Users, TrendingUp, Calendar, Mail, Phone, Globe, MapPin, CreditCard, Settings, BarChart3, Activity, Award, Clock, Target, Download, Share, AlertCircle, CheckCircle, Zap, UserPlus, Trash2 } from 'lucide-react';
import { getOrg, getOrgStats, listOrgMembers, addOrgMember, removeOrgMember, } from '../../dal/orgs';
import LoadingButton from '../../components/LoadingButton';
import EditOrganizationModal from '../../components/EditOrganizationModal';
import { useToast } from '../../context/ToastContext';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar, PieChart, Pie, Cell } from 'recharts';
const OrganizationDetails = () => {
    const { id } = useParams();
    const { showToast } = useToast();
    const [organization, setOrganization] = useState(null);
    const [orgStats, setOrgStats] = useState(null);
    const [loading, setLoading] = useState(true);
    const [showEditModal, setShowEditModal] = useState(false);
    const [activeTab, setActiveTab] = useState('overview');
    const [members, setMembers] = useState([]);
    const [membersLoading, setMembersLoading] = useState(false);
    const [memberForm, setMemberForm] = useState({ userId: '', role: 'member' });
    const [memberSubmitting, setMemberSubmitting] = useState(false);
    const loadMembers = useCallback(async () => {
        if (!id)
            return;
        setMembersLoading(true);
        try {
            const data = await listOrgMembers(id);
            setMembers(data);
        }
        catch (error) {
            console.error('Failed to load organization members:', error);
            showToast('Failed to load organization members', 'error');
        }
        finally {
            setMembersLoading(false);
        }
    }, [id, showToast]);
    useEffect(() => {
        const fetchData = async () => {
            if (!id)
                return;
            setLoading(true);
            try {
                const [orgData, statsData] = await Promise.all([
                    getOrg(id),
                    getOrgStats(id)
                ]);
                setOrganization(orgData);
                setOrgStats(statsData);
            }
            catch (error) {
                showToast('Failed to load organization details', 'error');
            }
            finally {
                setLoading(false);
            }
        };
        fetchData();
    }, [id, showToast]);
    useEffect(() => {
        loadMembers();
    }, [loadMembers]);
    const handleOrganizationUpdated = (updatedOrg) => {
        setOrganization(updatedOrg);
        showToast('Organization updated successfully!', 'success');
    };
    const handleAddMember = async () => {
        if (!id)
            return;
        const userId = memberForm.userId.trim();
        if (!userId) {
            showToast('User ID is required', 'error');
            return;
        }
        setMemberSubmitting(true);
        try {
            const member = await addOrgMember(id, { userId, role: memberForm.role });
            setMembers((prev) => {
                const exists = prev.find((m) => m.id === member.id);
                if (exists) {
                    return prev.map((m) => (m.id === member.id ? member : m));
                }
                return [member, ...prev];
            });
            setMemberForm((form) => ({ ...form, userId: '' }));
            showToast('Member added successfully', 'success');
        }
        catch (error) {
            console.error('Failed to add organization member:', error);
            showToast('Failed to add organization member', 'error');
        }
        finally {
            setMemberSubmitting(false);
        }
    };
    const handleRemoveMember = async (membershipId) => {
        if (!id)
            return;
        try {
            await removeOrgMember(id, membershipId);
            setMembers((prev) => prev.filter((member) => member.id !== membershipId));
            showToast('Member removed successfully', 'success');
        }
        catch (error) {
            console.error('Failed to remove organization member:', error);
            showToast('Failed to remove organization member', 'error');
        }
    };
    if (loading) {
        return (_jsx("div", { className: "flex items-center justify-center h-64", children: _jsx("div", { className: "w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin" }) }));
    }
    if (!organization) {
        return (_jsxs("div", { className: "text-center py-12", children: [_jsx(AlertCircle, { className: "w-12 h-12 text-gray-400 mx-auto mb-4" }), _jsx("h3", { className: "text-lg font-medium text-gray-900 mb-2", children: "Organization Not Found" }), _jsx("p", { className: "text-gray-600 mb-4", children: "The organization you're looking for doesn't exist." }), _jsxs(Link, { to: "/admin/organizations", className: "inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600", children: [_jsx(ArrowLeft, { className: "w-4 h-4 mr-2" }), "Back to Organizations"] })] }));
    }
    const getStatusColor = (status) => {
        switch (status) {
            case 'active': return 'bg-green-100 text-green-800';
            case 'trial': return 'bg-blue-100 text-blue-800';
            case 'inactive': return 'bg-yellow-100 text-yellow-800';
            case 'suspended': return 'bg-red-100 text-red-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };
    const getStatusIcon = (status) => {
        switch (status) {
            case 'active': return _jsx(CheckCircle, { className: "w-4 h-4 text-green-500" });
            case 'trial': return _jsx(Clock, { className: "w-4 h-4 text-blue-500" });
            case 'inactive': return _jsx(AlertCircle, { className: "w-4 h-4 text-yellow-500" });
            case 'suspended': return _jsx(X, { className: "w-4 h-4 text-red-500" });
            default: return _jsx(AlertCircle, { className: "w-4 h-4 text-gray-500" });
        }
    };
    const COLORS = ['#3A7DFF', '#228B22', '#F6C87B', '#D72638', '#de7b12'];
    const tabs = [
        { id: 'overview', label: 'Overview', icon: BarChart3 },
        { id: 'users', label: 'Users & Learners', icon: Users },
        { id: 'analytics', label: 'Analytics', icon: TrendingUp },
        { id: 'settings', label: 'Settings', icon: Settings },
        { id: 'billing', label: 'Billing', icon: CreditCard },
    ];
    return (_jsxs("div", { className: "max-w-7xl mx-auto space-y-6", children: [_jsxs("div", { className: "bg-white rounded-lg shadow-sm border border-gray-200 p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center space-x-4", children: [_jsx(Link, { to: "/admin/organizations", className: "p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors", children: _jsx(ArrowLeft, { className: "w-5 h-5" }) }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("div", { className: "bg-blue-100 p-3 rounded-lg", children: organization.logo ? (_jsx("img", { src: organization.logo, alt: "Logo", className: "w-8 h-8 rounded" })) : (_jsx(Building2, { className: "w-8 h-8 text-blue-600" })) }), _jsxs("div", { children: [_jsx("h1", { className: "text-2xl font-bold text-gray-900", children: organization.name }), _jsxs("div", { className: "flex items-center space-x-3 mt-1", children: [_jsx("span", { className: "text-sm text-gray-600", children: organization.type }), _jsx("span", { className: "text-gray-300", children: "\u2022" }), _jsxs("div", { className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(organization.status)}`, children: [getStatusIcon(organization.status), _jsx("span", { className: "ml-1 capitalize", children: organization.status })] }), organization.tags && organization.tags.map((tag) => (_jsx("span", { className: "inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800", children: tag }, tag)))] })] })] })] }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsxs("button", { className: "flex items-center space-x-2 px-3 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50", children: [_jsx(Share, { className: "w-4 h-4" }), _jsx("span", { children: "Share" })] }), _jsxs("button", { className: "flex items-center space-x-2 px-3 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50", children: [_jsx(Download, { className: "w-4 h-4" }), _jsx("span", { children: "Export" })] }), _jsxs(LoadingButton, { onClick: () => setShowEditModal(true), variant: "primary", children: [_jsx(Edit, { className: "w-4 h-4" }), "Edit Organization"] })] })] }), _jsxs("div", { className: "grid grid-cols-4 gap-4 mt-6", children: [_jsx("div", { className: "bg-blue-50 rounded-lg p-4", children: _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Users, { className: "w-8 h-8 text-blue-600" }), _jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-blue-900", children: organization.totalLearners }), _jsx("div", { className: "text-sm text-blue-700", children: "Total Learners" })] })] }) }), _jsx("div", { className: "bg-green-50 rounded-lg p-4", children: _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Activity, { className: "w-8 h-8 text-green-600" }), _jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-green-900", children: organization.activeLearners }), _jsx("div", { className: "text-sm text-green-700", children: "Active Learners" })] })] }) }), _jsx("div", { className: "bg-yellow-50 rounded-lg p-4", children: _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Target, { className: "w-8 h-8 text-yellow-600" }), _jsxs("div", { children: [_jsxs("div", { className: "text-2xl font-bold text-yellow-900", children: [organization.completionRate, "%"] }), _jsx("div", { className: "text-sm text-yellow-700", children: "Completion Rate" })] })] }) }), _jsx("div", { className: "bg-purple-50 rounded-lg p-4", children: _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Award, { className: "w-8 h-8 text-purple-600" }), _jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-purple-900", children: organization.cohorts.length }), _jsx("div", { className: "text-sm text-purple-700", children: "Active Cohorts" })] })] }) })] })] }), _jsxs("div", { className: "bg-white rounded-lg shadow-sm border border-gray-200", children: [_jsx("div", { className: "border-b border-gray-200", children: _jsx("nav", { className: "flex space-x-8 px-6", children: tabs.map((tab) => (_jsxs("button", { onClick: () => setActiveTab(tab.id), className: `py-3 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${activeTab === tab.id
                                    ? 'border-blue-500 text-blue-600'
                                    : 'border-transparent text-gray-500 hover:text-gray-700'}`, children: [_jsx(tab.icon, { className: "w-4 h-4" }), _jsx("span", { children: tab.label })] }, tab.id))) }) }), _jsxs("div", { className: "p-6", children: [activeTab === 'overview' && (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "Organization Information" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Mail, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Primary Contact" }), _jsx("div", { className: "text-gray-600", children: organization.contactPerson }), _jsx("div", { className: "text-sm text-gray-500", children: organization.contactEmail })] })] }), organization.contactPhone && (_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Phone, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Phone" }), _jsx("div", { className: "text-gray-600", children: organization.contactPhone })] })] })), organization.website && (_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Globe, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Website" }), _jsx("a", { href: organization.website, target: "_blank", rel: "noopener noreferrer", className: "text-blue-600 hover:underline", children: organization.website })] })] })), organization.address && (_jsxs("div", { className: "flex items-start space-x-3", children: [_jsx(MapPin, { className: "w-5 h-5 text-gray-400 mt-0.5" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Address" }), _jsxs("div", { className: "text-gray-600", children: [organization.address, _jsx("br", {}), organization.city && `${organization.city}, `, organization.state, " ", organization.postalCode, _jsx("br", {}), organization.country] })] })] }))] })] }), _jsxs("div", { className: "space-y-4", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "Subscription Details" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(CreditCard, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Plan" }), _jsx("div", { className: "text-gray-600", children: organization.subscription }), _jsx("div", { className: "text-sm text-gray-500", children: organization.billingCycle && `Billed ${organization.billingCycle}` })] })] }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Calendar, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Contract Period" }), _jsxs("div", { className: "text-gray-600", children: [organization.contractStart ? new Date(organization.contractStart).toLocaleDateString() : 'Not set', organization.contractEnd && ` - ${new Date(organization.contractEnd).toLocaleDateString()}`] })] })] }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(Zap, { className: "w-5 h-5 text-gray-400" }), _jsxs("div", { children: [_jsx("div", { className: "font-medium text-gray-900", children: "Limits" }), _jsxs("div", { className: "text-sm text-gray-600 space-y-1", children: [_jsxs("div", { children: ["Max Learners: ", organization.maxLearners || 'Unlimited'] }), _jsxs("div", { children: ["Max Courses: ", organization.maxCourses || 'Unlimited'] }), _jsxs("div", { children: ["Storage: ", organization.maxStorage || 'Unlimited', " GB"] })] })] })] })] })] })] }), orgStats && (_jsxs("div", { children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 mb-4", children: "Performance Overview" }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "User Growth (12 months)" }), _jsx("div", { className: "h-40", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(LineChart, { data: orgStats.trends.userGrowth, children: [_jsx(XAxis, { dataKey: "month", fontSize: 12 }), _jsx(YAxis, { fontSize: 12 }), _jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(Tooltip, {}), _jsx(Line, { type: "monotone", dataKey: "users", stroke: "#3A7DFF", strokeWidth: 2 })] }) }) })] }), _jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Module Progress" }), _jsx("div", { className: "space-y-2", children: Object.entries(organization.modules).map(([module, progress]) => (_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm font-medium text-gray-700 capitalize", children: module }), _jsxs("div", { className: "flex items-center space-x-2", children: [_jsx("div", { className: "w-16 h-2 bg-gray-200 rounded-full", children: _jsx("div", { className: "h-2 bg-blue-500 rounded-full", style: { width: `${Number(progress)}%` } }) }), _jsxs("span", { className: "text-sm text-gray-600", children: [Number(progress), "%"] })] })] }, module))) })] })] })] })), (organization.description || organization.notes) && (_jsxs("div", { className: "space-y-4", children: [organization.description && (_jsxs("div", { children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 mb-2", children: "Description" }), _jsx("p", { className: "text-gray-600", children: organization.description })] })), organization.notes && (_jsxs("div", { children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 mb-2", children: "Internal Notes" }), _jsx("p", { className: "text-gray-600 bg-yellow-50 border border-yellow-200 rounded-lg p-3", children: organization.notes })] }))] }))] })), activeTab === 'users' && (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "bg-white rounded-lg border border-gray-200 shadow-sm", children: [_jsxs("div", { className: "flex flex-col md:flex-row md:items-center md:justify-between gap-4 p-4 border-b border-gray-200", children: [_jsxs("div", { children: [_jsxs("h3", { className: "text-lg font-semibold text-gray-900 flex items-center space-x-2", children: [_jsx("span", { children: "Organization Members" }), _jsx(Users, { className: "w-4 h-4 text-gray-500" })] }), _jsx("p", { className: "text-sm text-gray-600", children: "Manage member access for this organization workspace." })] }), _jsxs("div", { className: "flex flex-col md:flex-row md:items-center gap-2", children: [_jsx("input", { type: "text", value: memberForm.userId, onChange: (e) => setMemberForm((form) => ({ ...form, userId: e.target.value })), placeholder: "Supabase User ID", className: "w-full md:w-64 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" }), _jsxs("select", { value: memberForm.role, onChange: (e) => setMemberForm((form) => ({ ...form, role: e.target.value })), className: "border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500", children: [_jsx("option", { value: "member", children: "Member" }), _jsx("option", { value: "editor", children: "Editor" }), _jsx("option", { value: "manager", children: "Manager" }), _jsx("option", { value: "admin", children: "Admin" }), _jsx("option", { value: "owner", children: "Owner" })] }), _jsxs("button", { onClick: handleAddMember, disabled: memberSubmitting, className: "inline-flex items-center justify-center px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-60", children: [_jsx(UserPlus, { className: "w-4 h-4 mr-2" }), memberSubmitting ? 'Adding…' : 'Add Member'] })] })] }), _jsx("div", { className: "overflow-hidden", children: membersLoading ? (_jsx("div", { className: "p-6 flex items-center justify-center text-sm text-gray-500", children: "Loading members\u2026" })) : members.length === 0 ? (_jsx("div", { className: "p-6 text-sm text-gray-500", children: "No members found for this organization." })) : (_jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { className: "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "User ID" }), _jsx("th", { className: "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Role" }), _jsx("th", { className: "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Invited By" }), _jsx("th", { className: "px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Added" }), _jsx("th", { className: "px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider", children: "Actions" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: members.map((member) => (_jsxs("tr", { children: [_jsx("td", { className: "px-4 py-3 text-sm text-gray-900 font-mono", children: member.userId }), _jsx("td", { className: "px-4 py-3 text-sm text-gray-700 capitalize", children: member.role }), _jsx("td", { className: "px-4 py-3 text-sm text-gray-500 font-mono", children: member.invitedBy ?? '—' }), _jsx("td", { className: "px-4 py-3 text-sm text-gray-500", children: new Date(member.createdAt).toLocaleString() }), _jsx("td", { className: "px-4 py-3 text-right", children: _jsxs("button", { onClick: () => handleRemoveMember(member.id), className: "inline-flex items-center px-2.5 py-1.5 border border-red-200 text-sm text-red-600 rounded-lg hover:bg-red-50", children: [_jsx(Trash2, { className: "w-4 h-4 mr-1" }), "Remove"] }) })] }, member.id))) })] }) })) })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "User Engagement Insights" }), _jsxs("div", { className: "flex space-x-2", children: [_jsx("button", { className: "px-3 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50", children: "Import Users" }), _jsx("button", { className: "px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600", children: "Add User" })] })] }), orgStats && (_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "User Engagement" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Daily Active" }), _jsx("span", { className: "font-medium", children: orgStats.engagement.dailyActiveUsers })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Weekly Active" }), _jsx("span", { className: "font-medium", children: orgStats.engagement.weeklyActiveUsers })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Monthly Active" }), _jsx("span", { className: "font-medium", children: orgStats.engagement.monthlyActiveUsers })] })] })] }), _jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Learning Performance" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Courses Completed" }), _jsx("span", { className: "font-medium", children: orgStats.performance.coursesCompleted })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Certificates Issued" }), _jsx("span", { className: "font-medium", children: orgStats.performance.certificatesIssued })] }), _jsxs("div", { className: "flex justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Avg Session Time" }), _jsxs("span", { className: "font-medium", children: [orgStats.overview.avgSessionTime, "min"] })] })] })] }), _jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Average Scores" }), _jsx("div", { className: "space-y-2", children: Object.entries(orgStats.performance.avgScores || {}).map(([module, score]) => (_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600 capitalize", children: module }), _jsxs("span", { className: "font-medium", children: [score, "%"] })] }, module))) })] })] })), _jsxs("div", { children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Active Cohorts" }), _jsx("div", { className: "space-y-2", children: organization.cohorts.map((cohort, index) => (_jsxs("div", { className: "flex items-center justify-between p-3 border border-gray-200 rounded-lg", children: [_jsx("span", { className: "font-medium text-gray-900", children: cohort }), _jsx("span", { className: "text-sm text-gray-600", children: "Active" })] }, index))) })] })] })), activeTab === 'analytics' && orgStats && (_jsxs("div", { className: "space-y-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "Analytics Dashboard" }), _jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Daily Completions (30 days)" }), _jsx("div", { className: "h-64", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(BarChart, { data: orgStats.trends.completionTrends, children: [_jsx(XAxis, { dataKey: "date", fontSize: 12 }), _jsx(YAxis, { fontSize: 12 }), _jsx(CartesianGrid, { strokeDasharray: "3 3" }), _jsx(Tooltip, {}), _jsx(Bar, { dataKey: "completions", fill: "#228B22" })] }) }) })] }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Module Progress Distribution" }), _jsx("div", { className: "h-48", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(PieChart, { children: [_jsx(Pie, { data: Object.entries(organization.modules).map(([name, value]) => ({ name, value })), cx: "50%", cy: "50%", outerRadius: 60, dataKey: "value", label: true, children: Object.entries(organization.modules).map((_, index) => (_jsx(Cell, { fill: COLORS[index % COLORS.length] }, `cell-${index}`))) }), _jsx(Tooltip, {})] }) }) })] }), _jsxs("div", { className: "bg-gray-50 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Key Metrics" }), _jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "User Retention Rate" }), _jsxs("span", { className: "font-semibold text-green-600", children: [Math.round((orgStats.engagement.weeklyActiveUsers / orgStats.overview.totalUsers) * 100), "%"] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Course Completion Rate" }), _jsxs("span", { className: "font-semibold text-blue-600", children: [organization.completionRate, "%"] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Average Score" }), _jsxs("span", { className: "font-semibold text-purple-600", children: [orgStats.performance.avgScores && Object.keys(orgStats.performance.avgScores).length > 0
                                                                                ? Math.round(Object.values(orgStats.performance.avgScores).reduce((a, b) => a + b, 0) / Object.values(orgStats.performance.avgScores).length)
                                                                                : 0, "%"] })] })] })] })] })] })), activeTab === 'settings' && (_jsxs("div", { className: "space-y-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "Organization Settings" }), organization.features && (_jsxs("div", { children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Enabled Features" }), _jsx("div", { className: "grid grid-cols-2 gap-4", children: Object.entries(organization.features).map(([feature, enabled]) => (_jsx("div", { className: `p-3 border rounded-lg ${enabled ? 'border-green-200 bg-green-50' : 'border-gray-200 bg-gray-50'}`, children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "font-medium capitalize", children: feature.replace(/([A-Z])/g, ' $1').trim() }), _jsx("div", { className: `w-2 h-2 rounded-full ${enabled ? 'bg-green-500' : 'bg-gray-400'}` })] }) }, feature))) })] })), organization.settings && (_jsxs("div", { children: [_jsx("h4", { className: "font-medium text-gray-900 mb-3", children: "Configuration" }), _jsx("div", { className: "space-y-3", children: Object.entries(organization.settings).map(([setting, value]) => (_jsxs("div", { className: "flex items-center justify-between p-3 border border-gray-200 rounded-lg", children: [_jsx("span", { className: "font-medium capitalize", children: setting.replace(/([A-Z])/g, ' $1').trim() }), _jsx("span", { className: "text-gray-600", children: typeof value === 'boolean' ? (value ? 'Enabled' : 'Disabled') : String(value) })] }, setting))) })] }))] })), activeTab === 'billing' && (_jsxs("div", { className: "space-y-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900", children: "Billing & Subscription" }), _jsxs("div", { className: "grid grid-cols-2 gap-6", children: [_jsxs("div", { className: "space-y-4", children: [_jsx("h4", { className: "font-medium text-gray-900", children: "Current Plan" }), _jsxs("div", { className: "bg-blue-50 border border-blue-200 rounded-lg p-4", children: [_jsxs("div", { className: "flex items-center justify-between mb-2", children: [_jsx("span", { className: "font-semibold text-blue-900", children: organization.subscription }), _jsx("span", { className: "text-sm text-blue-700", children: organization.billingCycle })] }), organization.customPricing && organization.customPricing > 0 ? (_jsxs("div", { className: "text-2xl font-bold text-blue-900", children: ["$", organization.customPricing, "/month"] })) : (_jsx("div", { className: "text-sm text-blue-700", children: "Custom pricing" }))] })] }), _jsxs("div", { className: "space-y-4", children: [_jsx("h4", { className: "font-medium text-gray-900", children: "Billing Contact" }), _jsxs("div", { className: "space-y-2", children: [_jsxs("div", { className: "text-sm", children: [_jsx("span", { className: "text-gray-600", children: "Email:" }), _jsx("span", { className: "ml-2 font-medium", children: organization.billingEmail || organization.contactEmail })] }), _jsxs("div", { className: "text-sm", children: [_jsx("span", { className: "text-gray-600", children: "Next billing:" }), _jsx("span", { className: "ml-2 font-medium", children: organization.contractEnd ? new Date(organization.contractEnd).toLocaleDateString() : 'Not set' })] })] })] })] }), _jsxs("div", { className: "bg-yellow-50 border border-yellow-200 rounded-lg p-4", children: [_jsx("h4", { className: "font-medium text-yellow-900 mb-2", children: "Usage & Limits" }), _jsxs("div", { className: "grid grid-cols-3 gap-4", children: [_jsxs("div", { children: [_jsx("div", { className: "text-sm text-yellow-700", children: "Learners" }), _jsxs("div", { className: "font-semibold text-yellow-900", children: [organization.totalLearners, " / ", organization.maxLearners || '∞'] })] }), _jsxs("div", { children: [_jsx("div", { className: "text-sm text-yellow-700", children: "Courses" }), _jsxs("div", { className: "font-semibold text-yellow-900", children: [organization.cohorts.length, " / ", organization.maxCourses || '∞'] })] }), _jsxs("div", { children: [_jsx("div", { className: "text-sm text-yellow-700", children: "Storage" }), _jsxs("div", { className: "font-semibold text-yellow-900", children: ["2.3 GB / ", organization.maxStorage || '∞', " GB"] })] })] })] })] }))] })] }), _jsx(EditOrganizationModal, { isOpen: showEditModal, onClose: () => setShowEditModal(false), organization: organization, onOrganizationUpdated: handleOrganizationUpdated })] }));
};
export default OrganizationDetails;
